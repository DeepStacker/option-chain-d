import{r as c,j as e}from"./animations-CCQynVHD.js";import{e as S,f as le,u as ce,b as ie,o as ne,H as de}from"./index-DUqnRfh4.js";import{u as w}from"./redux-CHwIDTp6.js";import{B as oe,C as x}from"./Card-wJW6FCvb.js";import{a5 as W,K as xe,i as he,ae as me,af as ge,ag as pe,ah as ye,a as be}from"./icons-1ld_-Ybk.js";import"./network-htDwveLI.js";import"./firebase-UuSzqDeJ.js";const F="/historical",ue=async h=>(await S.get(`${F}/dates/${h}`)).data,je=async(h,g)=>(await S.get(`${F}/times/${h}/${g}`)).data,fe=async({symbol:h,expiry:g,date:i,time:m})=>(await S.get(`${F}/snapshot/${h}/${g}`,{params:{date:i,time:m}})).data,Te=()=>{var O,R,E,L;const h=w(le),g=ce(),i=w(ie),m=w(ne),[I,X]=c.useState([]),[r,Y]=c.useState([]),[n,T]=c.useState(""),[p,y]=c.useState(""),[l,Z]=c.useState(null),[b,$]=c.useState(!1),[f,N]=c.useState(null),[u,C]=c.useState(!1),[v,ee]=c.useState(1),[d,j]=c.useState(0);c.useEffect(()=>{(async()=>{var s;try{const a=await ue(i);X(a.dates||[]),((s=a.dates)==null?void 0:s.length)>0&&T(a.dates[0])}catch(a){console.error("Failed to fetch dates:",a),N("Failed to load available dates")}})()},[i]),c.useEffect(()=>{if(!n)return;(async()=>{var s;try{const a=await je(i,n);Y(a.times||[]),((s=a.times)==null?void 0:s.length)>0&&(y(a.times[0]),j(0))}catch(a){console.error("Failed to fetch times:",a)}})()},[i,n]);const k=c.useCallback(async()=>{if(!(!n||!p||!m)){$(!0),N(null);try{const t=await fe({symbol:i,expiry:m,date:n,time:p});Z(t)}catch(t){console.error("Failed to fetch snapshot:",t),N(t.message||"Failed to load historical data")}finally{$(!1)}}},[i,m,n,p]);c.useEffect(()=>{n&&p&&m&&k()},[n,p,m,k]),c.useEffect(()=>{if(!u||r.length===0)return;const t=setInterval(()=>{j(s=>{const a=s+1;return a>=r.length?(C(!1),s):(y(r[a]),a)})},1e3/v);return()=>clearInterval(t)},[u,v,r]);const te=()=>{if(d>0){const t=d-1;j(t),y(r[t])}},se=()=>{if(d<r.length-1){const t=d+1;j(t),y(r[t])}};if(!h)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view historical data."}),e.jsx(oe,{onClick:()=>g("/login"),children:"Login Now"})]});const ae=Object.values((l==null?void 0:l.option_chain)||{}).reduce((t,s)=>{var a,o;return t+(((a=s.ce)==null?void 0:a.OI)||((o=s.ce)==null?void 0:o.oi)||0)},0),re=Object.values((l==null?void 0:l.option_chain)||{}).reduce((t,s)=>{var a,o;return t+(((a=s.pe)==null?void 0:a.OI)||((o=s.pe)==null?void 0:o.oi)||0)},0);return e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx("title",{children:"Historical Data | Stockify"}),e.jsx("meta",{name:"description",content:"View and replay historical option chain data"})]}),e.jsxs("div",{className:"w-full px-4 py-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Historical Option Chain"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Replay historical option chain data for any date"})]}),e.jsx("button",{onClick:k,disabled:b,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:e.jsx(W,{className:`w-5 h-5 text-gray-600 dark:text-gray-400 ${b?"animate-spin":""}`})})]}),e.jsxs(x,{variant:"glass",className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:"Symbol"}),e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white font-medium",children:i})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 inline mr-1"}),"Date"]}),e.jsx("select",{value:n,onChange:t=>T(t.target.value),className:"w-full bg-gray-100 dark:bg-gray-800 border-0 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:I.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:[e.jsx(he,{className:"w-4 h-4 inline mr-1"}),"Time"]}),e.jsx("select",{value:p,onChange:t=>{y(t.target.value),j(r.indexOf(t.target.value))},className:"w-full bg-gray-100 dark:bg-gray-800 border-0 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:r.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:"Speed"}),e.jsxs("select",{value:v,onChange:t=>ee(Number(t.target.value)),className:"w-full bg-gray-100 dark:bg-gray-800 border-0 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:.5,children:"0.5x"}),e.jsx("option",{value:1,children:"1x"}),e.jsx("option",{value:2,children:"2x"}),e.jsx("option",{value:5,children:"5x"}),e.jsx("option",{value:10,children:"10x"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:te,disabled:d===0,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors",children:e.jsx(me,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsx("button",{onClick:()=>C(!u),className:`p-3 rounded-xl transition-all ${u?"bg-red-100 dark:bg-red-900/30 text-red-600":"bg-blue-100 dark:bg-blue-900/30 text-blue-600"}`,children:u?e.jsx(ge,{className:"w-6 h-6"}):e.jsx(pe,{className:"w-6 h-6"})}),e.jsx("button",{onClick:se,disabled:d>=r.length-1,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors",children:e.jsx(ye,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),e.jsxs("div",{className:"ml-4 text-sm text-gray-500",children:[d+1," / ",r.length," snapshots"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${r.length>0?(d+1)/r.length*100:0}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[e.jsx("span",{children:r[0]||"09:15"}),e.jsx("span",{children:r[r.length-1]||"15:30"})]})]})]}),f&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 text-red-700 dark:text-red-400",children:f}),b&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(W,{className:"w-8 h-8 animate-spin text-blue-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading historical data..."})]}),l&&!b&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"Spot Price"}),e.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:(O=l.spot)==null?void 0:O.toLocaleString()})]}),e.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"ATM Strike"}),e.jsx("div",{className:"text-xl font-bold text-yellow-600",children:(R=l.atm_strike)==null?void 0:R.toLocaleString()})]}),e.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"PCR"}),e.jsx("div",{className:`text-xl font-bold ${l.pcr>1?"text-green-600":"text-red-600"}`,children:(E=l.pcr)==null?void 0:E.toFixed(3)})]}),e.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"Max Pain"}),e.jsx("div",{className:"text-xl font-bold text-purple-600",children:(L=l.max_pain)==null?void 0:L.toLocaleString()})]}),e.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[e.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"Total OI"}),e.jsxs("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:[e.jsxs("span",{className:"text-green-600",children:[(ae/1e5).toFixed(1),"L CE"]})," / ",e.jsxs("span",{className:"text-red-600",children:[(re/1e5).toFixed(1),"L PE"]})]})]})]}),e.jsx(x,{variant:"glass",className:"overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto max-h-[500px]",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsxs("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:[e.jsxs("tr",{children:[e.jsx("th",{colSpan:"4",className:"py-2 px-4 text-green-600 font-semibold border-r border-gray-200 dark:border-gray-700",children:"CALLS"}),e.jsx("th",{className:"py-2 px-4 text-yellow-600 font-semibold border-r border-gray-200 dark:border-gray-700",children:"STRIKE"}),e.jsx("th",{colSpan:"4",className:"py-2 px-4 text-red-600 font-semibold",children:"PUTS"})]}),e.jsxs("tr",{className:"text-xs text-gray-500",children:[e.jsx("th",{className:"py-2 px-2",children:"OI"}),e.jsx("th",{className:"py-2 px-2",children:"Volume"}),e.jsx("th",{className:"py-2 px-2",children:"IV"}),e.jsx("th",{className:"py-2 px-2 border-r border-gray-200 dark:border-gray-700",children:"LTP"}),e.jsx("th",{className:"py-2 px-2 border-r border-gray-200 dark:border-gray-700"}),e.jsx("th",{className:"py-2 px-2",children:"LTP"}),e.jsx("th",{className:"py-2 px-2",children:"IV"}),e.jsx("th",{className:"py-2 px-2",children:"Volume"}),e.jsx("th",{className:"py-2 px-2",children:"OI"})]})]}),e.jsx("tbody",{children:Object.entries(l.option_chain||{}).sort((t,s)=>parseFloat(t[0])-parseFloat(s[0])).slice(0,30).map(([t,s])=>{var o,A,P,D,H,_,K,V,B,M,q,U,z,G,J,Q;const a=parseFloat(t)===l.atm_strike;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-800 ${a?"bg-yellow-50 dark:bg-yellow-900/20":""}`,children:[e.jsxs("td",{className:"py-2 px-2 text-center text-green-600",children:[((((o=s.ce)==null?void 0:o.OI)||((A=s.ce)==null?void 0:A.oi)||0)/1e3).toFixed(0),"K"]}),e.jsxs("td",{className:"py-2 px-2 text-center text-gray-600 dark:text-gray-400",children:[((((P=s.ce)==null?void 0:P.volume)||((D=s.ce)==null?void 0:D.vol)||0)/1e3).toFixed(0),"K"]}),e.jsx("td",{className:"py-2 px-2 text-center text-blue-600",children:((_=(H=s.ce)==null?void 0:H.iv)==null?void 0:_.toFixed(1))||"-"}),e.jsx("td",{className:"py-2 px-2 text-center font-medium border-r border-gray-200 dark:border-gray-700",children:((V=(K=s.ce)==null?void 0:K.ltp)==null?void 0:V.toFixed(2))||"-"}),e.jsx("td",{className:`py-2 px-4 text-center font-bold border-r border-gray-200 dark:border-gray-700 ${a?"text-yellow-600":"text-gray-900 dark:text-white"}`,children:parseFloat(t).toFixed(0)}),e.jsx("td",{className:"py-2 px-2 text-center font-medium",children:((M=(B=s.pe)==null?void 0:B.ltp)==null?void 0:M.toFixed(2))||"-"}),e.jsx("td",{className:"py-2 px-2 text-center text-blue-600",children:((U=(q=s.pe)==null?void 0:q.iv)==null?void 0:U.toFixed(1))||"-"}),e.jsxs("td",{className:"py-2 px-2 text-center text-gray-600 dark:text-gray-400",children:[((((z=s.pe)==null?void 0:z.volume)||((G=s.pe)==null?void 0:G.vol)||0)/1e3).toFixed(0),"K"]}),e.jsxs("td",{className:"py-2 px-2 text-center text-red-600",children:[((((J=s.pe)==null?void 0:J.OI)||((Q=s.pe)==null?void 0:Q.oi)||0)/1e3).toFixed(0),"K"]})]},t)})})]})})})]}),!l&&!b&&!f&&e.jsxs(x,{variant:"glass",className:"p-12 text-center",children:[e.jsx(be,{className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"No Historical Data"}),e.jsx("p",{className:"text-gray-500",children:"Select a date and time to view historical option chain data"})]})]})]})};export{Te as default};
//# sourceMappingURL=Historical-YyxKE7XX.js.map
