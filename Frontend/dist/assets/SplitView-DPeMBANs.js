import{r as o,j as e}from"./animations-CCQynVHD.js";import{f as $,u as L,H as A}from"./index-DUqnRfh4.js";import{u as N}from"./redux-CHwIDTp6.js";import{B as M,C as F}from"./Card-wJW6FCvb.js";import{d as v,e as E,b as V,c as B}from"./analyticsApi-D381RQui.js";import{j as H,g as w,ab as C,a as D,a5 as k,x as K}from"./icons-1ld_-Ybk.js";import"./network-htDwveLI.js";import"./firebase-UuSzqDeJ.js";const S=o.memo(({id:d,symbol:c,expiry:i,chartType:l,onChangeType:x,onRemove:h,isFullScreen:m=!1})=>{const[a,u]=o.useState(null),[n,g]=o.useState(!1),[p,y]=o.useState(null),b=[{id:"coi",label:"Change in OI",color:"blue"},{id:"oi",label:"Open Interest",color:"green"},{id:"pcr",label:"PCR",color:"purple"},{id:"distribution",label:"OI Distribution",color:"orange"}],j=o.useCallback(async()=>{if(!(!c||!i)){g(!0),y(null);try{let s;switch(l){case"coi":s=await v({symbol:c,expiry:i});break;case"oi":s=await B({symbol:c,expiry:i});break;case"pcr":s=await V({symbol:c,expiry:i});break;case"distribution":s=await E({symbol:c,expiry:i});break;default:s=await v({symbol:c,expiry:i})}u(s)}catch(s){console.error(`Failed to fetch ${l} data:`,s),y(s.message||"Failed to load data")}finally{g(!1)}}},[c,i,l]);o.useEffect(()=>{j()},[j]);const t=()=>{if(!(a!=null&&a.data)||a.data.length===0)return e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No data available"});const s=a.data.slice(0,15),f=Math.max(...s.map(r=>Math.abs(r.ce_coi||r.ce_oi||r.pcr_oi||0)),...s.map(r=>Math.abs(r.pe_coi||r.pe_oi||0)),1);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("div",{className:"flex-1 flex flex-col justify-center gap-1 px-2",children:s.map((r,I)=>{const O=r.ce_coi||r.ce_oi||0,T=r.pe_coi||r.pe_oi||0,P=Math.min(90,Math.abs(O/f)*90),R=Math.min(90,Math.abs(T/f)*90);return e.jsxs("div",{className:"flex items-center gap-1 h-4",children:[e.jsx("div",{className:"flex-1 flex justify-end",children:e.jsx("div",{className:"h-3 bg-green-500 rounded-l",style:{width:`${P}%`}})}),e.jsx("div",{className:`w-12 text-center text-[9px] font-medium ${r.is_atm?"text-yellow-500":"text-gray-400"}`,children:r.strike}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-3 bg-red-500 rounded-r",style:{width:`${R}%`}})})]},I)})}),a.summary&&e.jsxs("div",{className:"flex justify-between text-[10px] px-2 py-1 border-t border-gray-700",children:[e.jsxs("span",{className:"text-green-500",children:["CE: ",((a.summary.total_ce_coi||a.summary.total_ce_oi||0)/1e5).toFixed(1),"L"]}),e.jsx("span",{className:a.summary.signal==="BULLISH"?"text-green-500":"text-red-500",children:a.summary.signal||(a.summary.pcr>1?"BULLISH":"BEARISH")}),e.jsxs("span",{className:"text-red-500",children:["PE: ",((a.summary.total_pe_coi||a.summary.total_pe_oi||0)/1e5).toFixed(1),"L"]})]})]})};return e.jsxs(F,{variant:"glass",className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-4 h-4 text-gray-400"}),e.jsx("select",{value:l,onChange:s=>x(d,s.target.value),className:"bg-transparent text-xs font-medium text-gray-300 border-0 focus:ring-0 cursor-pointer",children:b.map(s=>e.jsx("option",{value:s.id,className:"bg-gray-800",children:s.label},s.id))})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:j,disabled:n,className:"p-1 rounded hover:bg-gray-700 transition-colors",children:e.jsx(k,{className:`w-3.5 h-3.5 text-gray-400 ${n?"animate-spin":""}`})}),e.jsx("button",{onClick:()=>h(d),className:"p-1 rounded hover:bg-gray-700 transition-colors",children:e.jsx(K,{className:"w-3.5 h-3.5 text-gray-400"})})]})]}),e.jsx("div",{className:"flex-1 min-h-0",children:n?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 animate-spin text-blue-500"})}):p?e.jsx("div",{className:"h-full flex items-center justify-center text-red-500 text-sm",children:p}):t()})]})});S.displayName="ChartPanel";const _=o.memo(({data:d})=>{if(!d||Object.keys(d).length===0)return e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"Loading option chain..."});const c=Object.entries(d).sort((i,l)=>parseFloat(i[0])-parseFloat(l[0])).slice(0,20);return e.jsx("div",{className:"overflow-auto h-full",children:e.jsxs("table",{className:"w-full text-[10px]",children:[e.jsx("thead",{className:"bg-gray-800 sticky top-0",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1 px-1 text-green-500",children:"OI"}),e.jsx("th",{className:"py-1 px-1 text-green-500",children:"LTP"}),e.jsx("th",{className:"py-1 px-1 text-yellow-500",children:"Strike"}),e.jsx("th",{className:"py-1 px-1 text-red-500",children:"LTP"}),e.jsx("th",{className:"py-1 px-1 text-red-500",children:"OI"})]})}),e.jsx("tbody",{children:c.map(([i,l])=>{var x,h,m,a,u,n,g,p;return e.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/50",children:[e.jsxs("td",{className:"py-0.5 px-1 text-center text-green-400",children:[((((x=l.ce)==null?void 0:x.OI)||((h=l.ce)==null?void 0:h.oi)||0)/1e3).toFixed(0),"K"]}),e.jsx("td",{className:"py-0.5 px-1 text-center",children:((a=(m=l.ce)==null?void 0:m.ltp)==null?void 0:a.toFixed(1))||"-"}),e.jsx("td",{className:"py-0.5 px-1 text-center font-medium text-gray-300",children:parseFloat(i).toFixed(0)}),e.jsx("td",{className:"py-0.5 px-1 text-center",children:((n=(u=l.pe)==null?void 0:u.ltp)==null?void 0:n.toFixed(1))||"-"}),e.jsxs("td",{className:"py-0.5 px-1 text-center text-red-400",children:[((((g=l.pe)==null?void 0:g.OI)||((p=l.pe)==null?void 0:p.oi)||0)/1e3).toFixed(0),"K"]})]},i)})})]})})});_.displayName="MiniOptionChain";const X=()=>{const d=N($),c=L(),i=N(t=>t.optionChain.selectedSymbol)||"NIFTY",l=N(t=>t.optionChain.selectedExpiry),x=N(t=>t.optionChain.data),[h,m]=o.useState([{id:1,chartType:"coi"},{id:2,chartType:"oi"},{id:3,chartType:"pcr"},{id:4,chartType:"distribution"}]),[a,u]=o.useState("2x2"),[n,g]=o.useState(!0),p=(t,s)=>{m(f=>f.map(r=>r.id===t?{...r,chartType:s}:r))},y=t=>{m(s=>s.filter(f=>f.id!==t))},b=()=>{const t=Math.max(...h.map(s=>s.id),0)+1;m(s=>[...s,{id:t,chartType:"coi"}])};if(!d)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Authentication Required"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to use Split View."}),e.jsx(M,{onClick:()=>c("/login"),children:"Login Now"})]});const j={"2x2":"grid-cols-2 grid-rows-2","1x2":"grid-cols-1 grid-rows-2","3x1":"grid-cols-3 grid-rows-1"}[a]||"grid-cols-2 grid-rows-2";return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx("title",{children:"Split View | Stockify"}),e.jsx("meta",{name:"description",content:"Split view with option chain and multiple charts"})]}),e.jsxs("div",{className:"w-full h-[calc(100vh-64px)] flex flex-col p-2 gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between px-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("h1",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Split View"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[i," â€¢ ",l]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-0.5",children:["2x2","1x2","3x1"].map(t=>e.jsx("button",{onClick:()=>u(t),className:`px-2 py-1 text-xs font-medium rounded transition-colors ${a===t?"bg-blue-500 text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400"}`,children:t},t))}),e.jsx("button",{onClick:()=>g(!n),className:`p-2 rounded-lg transition-colors ${n?"bg-blue-100 text-blue-600 dark:bg-blue-900/30":"bg-gray-100 text-gray-500 dark:bg-gray-800"}`,title:"Toggle Option Chain Table",children:e.jsx(w,{className:"w-4 h-4"})}),e.jsx("button",{onClick:b,className:"p-2 rounded-lg bg-green-100 text-green-600 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",title:"Add Chart Panel",children:e.jsx(C,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 flex gap-2 min-h-0",children:[n&&e.jsxs(F,{variant:"glass",className:"w-64 flex-shrink-0 flex flex-col",children:[e.jsxs("div",{className:"px-3 py-2 border-b border-gray-700 flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-xs font-medium text-gray-300",children:"Option Chain"})]}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsx(_,{data:x==null?void 0:x.oc})})]}),e.jsxs("div",{className:`flex-1 grid ${j} gap-2 min-h-0`,children:[h.slice(0,a==="3x1"?3:4).map(t=>e.jsx(S,{id:t.id,symbol:i,expiry:l,chartType:t.chartType,onChangeType:p,onRemove:y},t.id)),h.length===0&&e.jsx("div",{className:"col-span-full flex items-center justify-center",children:e.jsxs("button",{onClick:b,className:"flex flex-col items-center gap-2 p-8 rounded-xl border-2 border-dashed border-gray-600 hover:border-gray-500 transition-colors",children:[e.jsx(C,{className:"w-8 h-8 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-500",children:"Add Chart Panel"})]})})]})]})]})]})};export{X as default};
//# sourceMappingURL=SplitView-DPeMBANs.js.map
