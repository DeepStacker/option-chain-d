import{r as e,j as t,ax as a,af as r,aa as s,ay as l,az as i,aA as n,aB as o,aC as d,aD as c,a3 as x,a8 as g,at as m}from"./vendor-61R5RNdl.js";import{n as h,b as u,o as p,p as b,q as y,c as v,r as f,t as k,u as j,v as N,w,x as _,y as C,z as S,d as I,A as F,B as V,C as M,D as L,E as O,F as P,G as T,H as R,I as E,J as $,f as D}from"./index-DpMGw747.js";import{x as B,a as A,a7 as G,a8 as W,a9 as U,aa as z,ab as H,g as q,q as K,ac as Y,N as J,F as Z,b as X,C as Q,e as ee,ad as te,ae,y as re,i as se,af as le,a4 as ie,a5 as ne}from"./ui-icons-BuGoXOaE.js";import{a as oe}from"./analyticsService-BzsekLUT.js";import{C as de,B as ce}from"./Card-DOfmhbZR.js";import{S as xe}from"./Skeleton-54bdQbPe.js";import{h as ge,W as me,g as he}from"./charts-BVf48S-_.js";import"./firebase-Dm1Xd1Ru.js";import"./animations-9kslzpSP.js";const ue="option_chain_table_settings",pe={sortOrder:"desc",highlightITM:!0,compactMode:!0,showStrikePanel:!1,selectedStrike:null,strikesPerPage:21},be=e.createContext(null);function ye({children:a}){const[r,s]=e.useState(()=>{try{const e=localStorage.getItem(ue);if(e)return{...pe,...JSON.parse(e)}}catch(e){}return pe}),l=e.useCallback((e,t)=>{s(a=>{const r={...a,[e]:t};return localStorage.setItem(ue,JSON.stringify(r)),r})},[]),i=e.useCallback(()=>{s(e=>{const t="asc"===e.sortOrder?"desc":"asc",a={...e,sortOrder:t};return localStorage.setItem(ue,JSON.stringify(a)),a})},[]),n=e.useCallback(()=>{s(e=>{const t={...e,highlightITM:!e.highlightITM};return localStorage.setItem(ue,JSON.stringify(t)),t})},[]),o=e.useCallback(()=>{s(e=>{const t={...e,compactMode:!e.compactMode};return localStorage.setItem(ue,JSON.stringify(t)),t})},[]),d=e.useCallback(e=>{s(t=>({...t,selectedStrike:e,showStrikePanel:null!==e}))},[]),c=e.useCallback(()=>{localStorage.setItem(ue,JSON.stringify(pe)),s(pe)},[]),x=e.useMemo(()=>({settings:r,updateSetting:l,toggleSortOrder:i,toggleITMHighlight:n,toggleCompactMode:o,selectStrike:d,resetSettings:c}),[r,l,i,n,o,d,c]);return t.jsx(be.Provider,{value:x,children:a})}function ve(){const t=e.useContext(be);if(!t)throw new Error("useTableSettings must be used within TableSettingsProvider");return t}const fe=(t,r={})=>{const s=e.useRef(null),l=e.useRef(null),i=e.useRef(null),[n,o]=e.useState(!1),[d,c]=e.useState(null),[x,g]=e.useState(null),[m,u]=e.useState("unknown"),{enabled:p=!0,autoReconnect:b=!0,baseReconnectInterval:y=1e3,maxReconnectInterval:v=3e4,maxReconnectAttempts:f=10,heartbeatInterval:k=3e4,socketUrl:j="ws://localhost:8000/ws/options"}=r,N=e.useRef(0),w=e.useRef(null),_=e.useCallback(()=>{const e=N.current,t=Math.min(y*Math.pow(2,e),v),a=.25*t*(Math.random()-.5)*2;return Math.round(t+a)},[y,v]),C=e.useRef(t);e.useEffect(()=>{C.current=t},[t]);const S=e.useCallback(()=>{i.current&&clearInterval(i.current),i.current=setInterval(()=>{if(s.current?.readyState===WebSocket.OPEN&&(s.current.send(JSON.stringify({type:"ping"})),w.current)){const e=Date.now()-w.current;u(e>2*k?"poor":e>1.5*k?"degraded":"good")}},k)},[k]),I=e.useCallback(()=>{i.current&&(clearInterval(i.current),i.current=null)},[]),F=e.useCallback(()=>{try{s.current&&s.current.close();const e=j.includes("/ws/")?j:`${j}/ws/options`;h.log("üîå Connecting to WebSocket:",e),s.current=new WebSocket(e),s.current.onopen=()=>{h.log("‚úÖ WebSocket Connected"),o(!0),c(null),u("good"),N.current=0,S(),s.current.readyState===WebSocket.OPEN&&s.current.send(JSON.stringify({type:"ping"}))},s.current.onmessage=async e=>{try{h.debug("üì© WebSocket raw message type:",typeof e.data,e.data instanceof Blob?"Blob":e.data instanceof ArrayBuffer?"ArrayBuffer":"String");const t=await(async e=>{try{if(e instanceof Blob){const t=await e.arrayBuffer();return a(new Uint8Array(t))}return e instanceof ArrayBuffer?a(new Uint8Array(e)):"string"==typeof e?JSON.parse(e):e}catch(t){throw t}})(e.data);h.debug("üì¶ WebSocket decoded data:",t?.type||"live_data",t?.oc?`(${Object.keys(t.oc).length} strikes)`:""),"connected"===t.type?(h.log("‚úÖ Connection confirmed, client_id:",t.client_id),c(null)):"subscribed"===t.type?(h.log("‚úÖ Subscribed to:",t.symbol,t.expiry),g({symbol:t.symbol,expiry:t.expiry}),c(null)):"unsubscribed"===t.type?(h.log("‚úÖ Unsubscribed"),g(null)):"pong"===t.type?w.current=Date.now():"error"===t.type?c(t.message):(d&&c(null),h.debug("üì° Passing live data to callback"),C.current&&C.current(t))}catch(t){}},s.current.onerror=()=>{c("WebSocket connection error"),o(!1),u("poor")},s.current.onclose=e=>{if(h.log("üîå WebSocket Disconnected:",e.code,e.reason),o(!1),g(null),u("unknown"),I(),b&&N.current<f&&!e.wasClean){N.current+=1;const e=_();h.log(`‚è≥ Reconnecting in ${e}ms... Attempt ${N.current}/${f}`),l.current=setTimeout(()=>{F()},e)}else N.current>=f&&c("WebSocket unavailable - using polling")}}catch(e){c(e.message)}},[j,b,f,_,S,I]),V=e.useCallback(()=>{l.current&&clearTimeout(l.current),s.current&&(s.current.close(1e3,"Client disconnect"),s.current=null),o(!1),g(null)},[]),M=e.useCallback(e=>{if(s.current&&s.current.readyState===WebSocket.OPEN){const t="string"==typeof e?e:JSON.stringify(e);return s.current.send(t),!0}return!1},[]),L=e.useCallback((e,t)=>!!n&&M({type:"subscribe",sid:e.toUpperCase(),exp_sid:t}),[n,M]),O=e.useCallback(()=>M({type:"unsubscribe"}),[M]);return e.useEffect(()=>(p?F():V(),()=>{V()}),[p,F,V]),{isConnected:n,error:d,subscription:x,sendMessage:M,subscribe:L,unsubscribe:O,disconnect:V,reconnect:F}},ke=()=>{const t=r(),a=s(u),l=s(p),i=s(b),n=s(y),o=s(v),d=s(f),c=s(k),[x,g]=e.useState(!1),[m,C]=e.useState(3e3),[S,I]=e.useState(null),[F,V]=e.useState(!0),[M,L]=e.useState(!0),O=e.useRef(null),P=e.useRef(null),T=e.useRef(null),R=e.useMemo(()=>!!(i&&i.oc&&Object.keys(i.oc).length>0),[i]);e.useMemo(()=>a&&l?`${a}:${l}`:null,[a,l]);const E=e.useMemo(()=>l&&"number"==typeof l&&l>0,[l]),$=e.useCallback(e=>{"error"!==e?.type&&e&&(e.oc||e.spot||e.futures)&&(t(j(e)),I(new Date),F&&V(!1))},[t,F]),{isConnected:D,error:B,subscribe:A,unsubscribe:G,subscription:W}=fe($,{enabled:M});e.useEffect(()=>{t(N(D&&!!W)),t(w(D?"websocket":"api"))},[D,W,t]),e.useEffect(()=>{if(!M||x||!D)return;if(!a||!E)return;const e=`${a}:${l}`;T.current!==e&&(T.current&&(h.log("üì° Unsubscribing from:",T.current),G()),A(a,String(l)),T.current=e)},[D,a,l,E,x,M,A,G]),e.useEffect(()=>()=>{T.current&&(G(),T.current=null)},[G]);const U=e.useCallback(async()=>{if(!a||x)return;const e=`${a}:${l||"auto"}`;try{await t(_({symbol:a,expiry:l?String(l):null})).unwrap(),I(new Date),P.current=e,F&&V(!1)}catch(r){F&&V(!1)}},[a,l,x,t,F]),z=e.useRef(l);e.useEffect(()=>{a&&E&&(null!==z.current&&z.current!==l&&U(),z.current=l)},[a,l,E,U]),e.useEffect(()=>{if(O.current&&(clearInterval(O.current),O.current=null),(!(D&&W&&M)||B)&&(!i?.error||!i.error.includes("404")&&!i.error.includes("Invalid"))&&!x&&a)return O.current=setInterval(U,m),()=>{O.current&&(clearInterval(O.current),O.current=null)}},[U,m,x,a,D,W,M,B,i?.error]);const H=e.useCallback(()=>{U()},[U]),q=e.useCallback(()=>{g(e=>!e)},[]),K=e.useCallback(e=>{C(e)},[]),Y=e.useCallback(()=>{L(e=>!e)},[]);return e.useMemo(()=>({data:i,spotData:n,futuresData:o,expiryList:d,symbol:a,expiry:l,isLoading:c,isInitialLoad:F,isPaused:x,lastUpdated:S,refreshInterval:m,hasData:R,isWebSocketConnected:D,isStreaming:D&&!!W,wsError:B,useWebSocket:M,refresh:H,togglePause:q,setRefreshInterval:K,toggleWebSocket:Y}),[i,n,o,d,a,l,c,F,x,S,m,R,D,W,B,M,H,q,K,Y])},je=["volume","oi","oichng"],Ne=["ce","pe"],we=(e,t,a,r,s)=>{const l={},i=[];e.forEach(e=>{const l=e.toString(),n=(t?.oc?.[l]||t?.oc?.[`${e}.000000`]||{})[s]||{};let o=0,d=0,c=!1;"volume"===r?(o=n.volume||0,d=o):"oi"===r?(o=n.OI||n.oi||0,d=o):"oichng"===r&&(d=n.oichng||0,c=d<0,o=d>0?d:0);const x=((e,t,a)=>t?"ce"===a?e<t?Math.round((t-e)/50):0:e>t?Math.round((e-t)/50):0:0)(e,a,s),g=x<=2;i.push({strike:e,value:o,rawValue:d,isNegative:c,itmDepth:x,isValidFor100:g})});const n=i.filter(e=>e.isValidFor100&&e.value>0),o=n.length>0?Math.max(...n.map(e=>e.value)):0;if(0===o)return e.forEach(e=>{l[e]={pct:0,rank:0,color:""}}),l;const d=i.map(e=>({...e,pct:"oichng"===r&&e.isNegative?Math.abs(e.rawValue)/o*100:e.value/o*100})),c=[...d].filter(e=>e.value>0).sort((e,t)=>t.value-e.value),x={};let g=0,m=null;return c.forEach((e,t)=>{e.value>0&&(e.value!==m&&(g=t+1,m=e.value),x[e.strike]=g)}),d.forEach(e=>{const t=x[e.strike]||0,a=e.value>0&&!e.isNegative?((e,t,a)=>e>100?"bg-blue-200 dark:bg-blue-800 text-blue-900 dark:text-blue-100 font-bold border border-blue-300 dark:border-blue-600":1===t?"ce"===a?"bg-rose-200 dark:bg-rose-800 text-rose-950 dark:text-white font-bold border border-rose-300 dark:border-rose-600 shadow-sm":"bg-emerald-200 dark:bg-emerald-800 text-emerald-950 dark:text-white font-bold border border-emerald-300 dark:border-emerald-600 shadow-sm":2===t?"bg-yellow-100 dark:bg-yellow-900/40 text-yellow-900 dark:text-yellow-100 font-semibold border border-yellow-200 dark:border-yellow-700/50":3===t?"ce"===a?"bg-rose-50/50 dark:bg-rose-900/10 text-rose-700 dark:text-rose-300/70":"bg-emerald-50/50 dark:bg-emerald-900/10 text-emerald-700 dark:text-emerald-300/70":"")(e.pct,t,s,e.itmDepth):"";l[e.strike]={pct:e.pct,rank:t,color:a}}),l},_e={ce_ltp:{id:"ce_ltp",label:"LTP",side:"ce",category:"price",defaultVisible:!0,width:"w-20"},ce_chng:{id:"ce_chng",label:"Chg",side:"ce",category:"price",defaultVisible:!1,width:"w-16"},ce_volume:{id:"ce_volume",label:"Volume",side:"ce",category:"volume",defaultVisible:!0,width:"w-20"},ce_oi:{id:"ce_oi",label:"OI",side:"ce",category:"oi",defaultVisible:!0,width:"w-24"},ce_oichng:{id:"ce_oichng",label:"OI Chg",side:"ce",category:"oi",defaultVisible:!0,width:"w-20"},ce_iv:{id:"ce_iv",label:"IV",side:"ce",category:"greeks",defaultVisible:!0,width:"w-16"},ce_delta:{id:"ce_delta",label:"Delta",side:"ce",category:"greeks",defaultVisible:!0,width:"w-16"},ce_gamma:{id:"ce_gamma",label:"Gamma",side:"ce",category:"greeks",defaultVisible:!1,width:"w-16"},ce_theta:{id:"ce_theta",label:"Theta",side:"ce",category:"greeks",defaultVisible:!1,width:"w-16"},ce_vega:{id:"ce_vega",label:"Vega",side:"ce",category:"greeks",defaultVisible:!1,width:"w-16"},ce_buildup:{id:"ce_buildup",label:"Buildup",side:"ce",category:"analysis",defaultVisible:!1,width:"w-16"},ce_bid:{id:"ce_bid",label:"Bid",side:"ce",category:"depth",defaultVisible:!1,width:"w-16"},ce_ask:{id:"ce_ask",label:"Ask",side:"ce",category:"depth",defaultVisible:!1,width:"w-16"},ce_pcr:{id:"ce_pcr",label:"PCR",side:"ce",category:"analysis",defaultVisible:!1,width:"w-16"},pe_ltp:{id:"pe_ltp",label:"LTP",side:"pe",category:"price",defaultVisible:!0,width:"w-20"},pe_chng:{id:"pe_chng",label:"Chg",side:"pe",category:"price",defaultVisible:!1,width:"w-16"},pe_volume:{id:"pe_volume",label:"Volume",side:"pe",category:"volume",defaultVisible:!0,width:"w-20"},pe_oi:{id:"pe_oi",label:"OI",side:"pe",category:"oi",defaultVisible:!0,width:"w-24"},pe_oichng:{id:"pe_oichng",label:"OI Chg",side:"pe",category:"oi",defaultVisible:!0,width:"w-20"},pe_iv:{id:"pe_iv",label:"IV",side:"pe",category:"greeks",defaultVisible:!0,width:"w-16"},pe_delta:{id:"pe_delta",label:"Delta",side:"pe",category:"greeks",defaultVisible:!0,width:"w-16"},pe_gamma:{id:"pe_gamma",label:"Gamma",side:"pe",category:"greeks",defaultVisible:!1,width:"w-16"},pe_theta:{id:"pe_theta",label:"Theta",side:"pe",category:"greeks",defaultVisible:!1,width:"w-16"},pe_vega:{id:"pe_vega",label:"Vega",side:"pe",category:"greeks",defaultVisible:!1,width:"w-16"},pe_buildup:{id:"pe_buildup",label:"Buildup",side:"pe",category:"analysis",defaultVisible:!1,width:"w-16"},pe_bid:{id:"pe_bid",label:"Bid",side:"pe",category:"depth",defaultVisible:!1,width:"w-16"},pe_ask:{id:"pe_ask",label:"Ask",side:"pe",category:"depth",defaultVisible:!1,width:"w-16"},pe_pcr:{id:"pe_pcr",label:"PCR",side:"pe",category:"analysis",defaultVisible:!1,width:"w-16"},strike_reversal:{id:"strike_reversal",label:"Reversal",side:"strike",category:"signals",defaultVisible:!1,width:"w-20"},strike_signals:{id:"strike_signals",label:"Signals",side:"strike",category:"signals",defaultVisible:!1,width:"w-24"}},Ce={oi:{label:"Open Interest",color:"bg-blue-500"},volume:{label:"Volume",color:"bg-purple-500"},price:{label:"Price",color:"bg-green-500"},greeks:{label:"Greeks",color:"bg-orange-500"},depth:{label:"Market Depth",color:"bg-cyan-500"},analysis:{label:"Analysis",color:"bg-pink-500"},signals:{label:"Signals",color:"bg-yellow-500"}},Se="option_chain_columns",Ie=["ce_iv","ce_delta","ce_oichng","ce_oi","ce_volume","ce_ltp"],Fe=["pe_ltp","pe_volume","pe_oi","pe_oichng","pe_delta","pe_iv"],Ve=e.createContext(null);function Me({children:a}){const[r,s]=e.useState(()=>{try{const e=localStorage.getItem(Se);if(e)return JSON.parse(e)}catch(t){}const e={};return Object.values(_e).forEach(t=>{e[t.id]=t.defaultVisible}),{visibility:e,ceOrder:Ie,peOrder:Fe}}),l=e.useCallback(e=>{s(t=>{const a={...t,visibility:{...t.visibility,[e]:!t.visibility[e]}};return localStorage.setItem(Se,JSON.stringify(a)),a})},[]),i=e.useCallback(e=>{s(t=>{const a={...t,visibility:{...t.visibility,...e}};return localStorage.setItem(Se,JSON.stringify(a)),a})},[]),n=e.useCallback(()=>{const e={};Object.values(_e).forEach(t=>{e[t.id]=t.defaultVisible});const t={visibility:e,ceOrder:Ie,peOrder:Fe};localStorage.setItem(Se,JSON.stringify(t)),s(t)},[]),o=e.useCallback(e=>("ce"===e?r.ceOrder:r.peOrder).filter(e=>r.visibility[e]).map(e=>_e[e]).filter(Boolean),[r]),d=e.useCallback(e=>r.visibility[e]??!1,[r.visibility]),c=e.useMemo(()=>({columnConfig:r,toggleColumn:l,setColumnsVisibility:i,resetToDefaults:n,getVisibleColumns:o,isColumnVisible:d,allColumns:_e,categories:Ce}),[r,l,i,n,o,d]);return t.jsx(Ve.Provider,{value:c,children:a})}function Le(){const t=e.useContext(Ve);if(!t)throw new Error("useColumnConfig must be used within ColumnConfigProvider");return t}const Oe=e.memo(({onColumnClick:e})=>{const{isColumnVisible:a}=Le(),{settings:r}=ve(),s=r.compactMode?"p-1.5":"p-2.5",l=`${s} text-center font-semibold text-sm uppercase text-gray-600 dark:text-gray-300 tracking-wide whitespace-nowrap border-b border-gray-200 dark:border-gray-700`,i=`${l} cursor-pointer hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 transition-colors`,n=`${s} text-center font-bold text-base tracking-wide sticky left-0 z-20 bg-gray-100 dark:bg-gray-800 border-x-2 border-gray-300 dark:border-gray-600 min-w-[100px]`,o=["ce_iv","ce_delta","ce_gamma","ce_theta","ce_vega","ce_oichng","ce_oi","ce_volume","ce_ltp","ce_chng","ce_buildup","ce_bid","ce_ask"].filter(e=>a(e)).length||1,d=["pe_ltp","pe_chng","pe_bid","pe_ask","pe_volume","pe_oi","pe_oichng","pe_delta","pe_iv","pe_gamma","pe_theta","pe_vega","pe_buildup"].filter(e=>a(e)).length||1;return t.jsxs("thead",{className:"bg-gray-50 dark:bg-gray-900 sticky top-0 z-20 shadow-sm",children:[t.jsxs("tr",{children:[t.jsxs("th",{colSpan:o,className:`${s} text-center font-bold text-base border-b border-rose-200 dark:border-rose-900/50 bg-white dark:bg-slate-900 group`,children:[t.jsx("span",{className:"text-rose-600 dark:text-rose-400",children:"CALLS"})," ",t.jsx("span",{className:"text-gray-400 text-xs font-normal ml-1",children:"(Resistance)"})]}),t.jsx("th",{className:`${s} bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-gray-700`}),t.jsxs("th",{colSpan:d,className:`${s} text-center font-bold text-base border-b border-emerald-200 dark:border-emerald-900/50 bg-white dark:bg-slate-900 group`,children:[t.jsx("span",{className:"text-emerald-600 dark:text-emerald-400",children:"PUTS"})," ",t.jsx("span",{className:"text-gray-400 text-xs font-normal ml-1",children:"(Support)"})]})]}),t.jsxs("tr",{className:"bg-gray-100 dark:bg-gray-800/50",children:[a("ce_iv")&&t.jsx("th",{className:`${l} cursor-help text-blue-600 dark:text-blue-400`,title:"Hover for all Greeks",children:"IV ‚ìò"}),a("ce_delta")&&t.jsx("th",{className:l,children:"Œî"}),a("ce_gamma")&&t.jsx("th",{className:l,children:"Œì"}),a("ce_theta")&&t.jsx("th",{className:`${l} text-red-500`,children:"Œò"}),a("ce_vega")&&t.jsx("th",{className:l,children:"ŒΩ"}),a("ce_oichng")&&t.jsx("th",{className:i,onClick:()=>e?.("oi_chng"),title:"Click for OI Change Distribution",children:"OI Chg üìä"}),a("ce_oi")&&t.jsx("th",{className:i,onClick:()=>e?.("oi"),title:"Click for OI Distribution",children:"OI üìä"}),a("ce_volume")&&t.jsx("th",{className:i,onClick:()=>e?.("volume"),title:"Click for Volume Distribution",children:"Vol üìä"}),a("ce_buildup")&&t.jsx("th",{className:l,children:"Buildup"}),a("ce_ltp")&&t.jsx("th",{className:`${l} font-bold`,children:"LTP / Chg"}),a("ce_chng")&&!a("ce_ltp")&&t.jsx("th",{className:l,children:"Chg"}),a("ce_bid")&&t.jsx("th",{className:l,children:"Bid"}),a("ce_ask")&&t.jsx("th",{className:l,children:"Ask"}),t.jsx("th",{className:n,children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("span",{children:"STRIKE"}),t.jsx("span",{className:"text-[9px] text-gray-500 font-normal",children:"PCR"})]})}),a("pe_bid")&&t.jsx("th",{className:`${l}`,children:"Bid"}),a("pe_ask")&&t.jsx("th",{className:`${l}`,children:"Ask"}),a("pe_ltp")&&t.jsx("th",{className:`${l} font-bold`,children:"LTP / Chg"}),a("pe_chng")&&!a("pe_ltp")&&t.jsx("th",{className:`${l}`,children:"Chg"}),a("pe_buildup")&&t.jsx("th",{className:`${l}`,children:"Buildup"}),a("pe_volume")&&t.jsx("th",{className:i,onClick:()=>e?.("volume"),title:"Click for Volume Distribution",children:"Vol üìä"}),a("pe_oi")&&t.jsx("th",{className:i,onClick:()=>e?.("oi"),title:"Click for OI Distribution",children:"OI üìä"}),a("pe_oichng")&&t.jsx("th",{className:i,onClick:()=>e?.("oi_chng"),title:"Click for OI Change Distribution",children:"OI Chg üìä"}),a("pe_delta")&&t.jsx("th",{className:`${l}`,children:"Œî"}),a("pe_iv")&&t.jsx("th",{className:`${l} cursor-help text-blue-600 dark:text-blue-400`,title:"Hover for all Greeks",children:"IV ‚ìò"}),a("pe_gamma")&&t.jsx("th",{className:`${l}`,children:"Œì"}),a("pe_theta")&&t.jsx("th",{className:`${l} text-red-500`,children:"Œò"}),a("pe_vega")&&t.jsx("th",{className:`${l}`,children:"ŒΩ"})]})]})});Oe.displayName="TableHeader";const Pe={LB:{code:"LB",name:"LONG BUILDUP",color:"success",description:"Bullish - Price up, OI up"},SB:{code:"SB",name:"SHORT BUILDUP",color:"danger",description:"Bearish - Price down, OI up"},SC:{code:"SC",name:"SHORT COVERING",color:"success",description:"Bullish - Price up, OI down"},LC:{code:"LC",name:"LONG UNWINDING",color:"danger",description:"Bearish - Price down, OI down"},NT:{code:"NT",name:"NEUTRAL",color:"default",description:"No significant change"}},Te=e=>{if(null==e)return"‚Äî";if(0===e)return"0";const t=Math.abs(e),a=e<0?"-":"";return t>=1e12?a+(t/1e12).toFixed(2)+"T":t>=1e9?a+(t/1e9).toFixed(2)+"B":t>=1e6?a+(t/1e6).toFixed(2)+"M":t>=1e3?a+(t/1e3).toFixed(1)+"K":a+t.toFixed(0)},Re=e.memo(({optgeeks:e,isVisible:a,position:r})=>{if(!a||!e)return null;return t.jsxs("div",{className:`\n        absolute z-50 bg-gray-900/95 dark:bg-gray-800/95 text-white\n        rounded-lg shadow-2xl p-3 min-w-[220px]\n        border border-gray-700\n        ${"left"===r?"right-full mr-2":"left-full ml-2"}\n      `,style:{top:"50%",transform:"translateY(-50%)"},children:[t.jsx("div",{className:"text-xs font-semibold text-gray-400 mb-2 uppercase tracking-wider",children:"Option Greeks"}),t.jsx("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5",children:[{key:"delta",label:"Œî Delta",color:"text-blue-500"},{key:"gamma",label:"Œì Gamma",color:"text-green-500"},{key:"theta",label:"Œò Theta",color:"text-red-500"},{key:"vega",label:"ŒΩ Vega",color:"text-purple-500"},{key:"rho",label:"œÅ Rho",color:"text-cyan-500"},{key:"vanna",label:"Vanna",color:"text-orange-400"},{key:"vomma",label:"Vomma",color:"text-pink-500"},{key:"charm",label:"Charm",color:"text-yellow-500"},{key:"speed",label:"Speed",color:"text-indigo-500"},{key:"zomma",label:"Zomma",color:"text-lime-500"},{key:"color",label:"Color",color:"text-amber-500"},{key:"ultima",label:"Ultima",color:"text-rose-500"}].map(({key:a,label:r,color:s})=>t.jsxs("div",{className:"flex justify-between items-center text-xs",children:[t.jsx("span",{className:`${s} font-medium`,children:r}),t.jsx("span",{className:"text-gray-300 font-mono",children:e[a]?.toFixed(4)??"‚Äî"})]},a))})]})});Re.displayName="GreeksTooltip";const Ee=e.memo(({data:e,strike:a,spotPrice:r,onClose:s})=>{if(!e)return null;const l=e.ce||{},i=e.pe||{},n=l.OI||l.oi||0,o=i.OI||i.oi||0,d=l.oichng||0,c=i.oichng||0,x=n>0?o/n:0,g=0!==d?c/d:0,m=e.reversal||0,h=e.wkly_reversal||0,u=e.fut_reversal||0,p=a>(r||0),b=e.pcr||x,y=e.trading_signals||{};e.price_range,e.market_regimes;const v=e=>e>1.5?"text-green-600 bg-green-50 dark:bg-green-900/30":e>1?"text-green-500 bg-green-50/50 dark:bg-green-900/20":e>.7?"text-amber-600 bg-amber-50 dark:bg-amber-900/30":"text-red-600 bg-red-50 dark:bg-red-900/30";return t.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:s,children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full p-6 max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{children:[t.jsxs("h3",{className:"text-2xl font-bold",children:["Strike ",a]}),t.jsx("span",{className:"text-sm "+(p?"text-red-500":"text-green-500"),children:p?"‚Üë Above Spot (Resistance Zone)":"‚Üì Below Spot (Support Zone)"})]}),t.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg",children:t.jsx(B,{className:"w-6 h-6"})})]}),t.jsxs("div",{className:"mb-5 p-4 rounded-xl bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20 border border-purple-200 dark:border-purple-700/50",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(A,{className:"w-5 h-5 text-purple-600"}),t.jsx("span",{className:"font-semibold text-purple-700 dark:text-purple-300",children:p?"Resistance Level":"Support Level"})]}),m&&t.jsx("button",{onClick:()=>navigator.clipboard.writeText(m.toFixed(2)),className:"px-2 py-1 text-xs bg-purple-100 dark:bg-purple-800 text-purple-700 dark:text-purple-200 rounded hover:bg-purple-200 dark:hover:bg-purple-700",title:"Copy to clipboard",children:"üìã Copy"})]}),t.jsx("div",{className:"text-3xl font-bold text-purple-800 dark:text-purple-200 mb-2 cursor-pointer select-all",onClick:()=>m&&navigator.clipboard.writeText(m.toFixed(2)),title:"Click to copy",children:m?m.toFixed(2):"N/A"}),t.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[t.jsxs("div",{className:"cursor-pointer hover:bg-purple-100 dark:hover:bg-purple-800/50 p-1 rounded",onClick:()=>h&&navigator.clipboard.writeText(h.toFixed(2)),children:[t.jsx("span",{className:"text-gray-500 text-xs",children:"Weekly:"}),t.jsx("span",{className:"ml-1 font-medium select-all",children:h?h.toFixed(2):"‚Äî"})]}),t.jsxs("div",{className:"cursor-pointer hover:bg-purple-100 dark:hover:bg-purple-800/50 p-1 rounded",onClick:()=>u&&navigator.clipboard.writeText(u.toFixed(2)),children:[t.jsx("span",{className:"text-gray-500 text-xs",children:"Futures:"}),t.jsx("span",{className:"ml-1 font-medium select-all",children:u?u.toFixed(2):"‚Äî"})]}),t.jsxs("div",{className:"cursor-pointer hover:bg-purple-100 dark:hover:bg-purple-800/50 p-1 rounded",onClick:()=>b&&navigator.clipboard.writeText(b.toFixed(2)),children:[t.jsx("span",{className:"text-gray-500 text-xs",children:"PCR:"}),t.jsx("span",{className:"ml-1 font-medium select-all",children:b?b.toFixed(2):"‚Äî"})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[t.jsxs("div",{className:`p-4 rounded-xl ${v(x)}`,children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"OI PCR (PE/CE)"}),t.jsx("div",{className:"text-2xl font-bold",children:x.toFixed(2)}),t.jsx("div",{className:"text-xs mt-1",children:x>1?"üü¢ Bullish":"üî¥ Bearish"})]}),t.jsxs("div",{className:`p-4 rounded-xl ${v(Math.abs(g))}`,children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"OI Chng PCR"}),t.jsx("div",{className:"text-2xl font-bold",children:g.toFixed(2)}),t.jsx("div",{className:"text-xs mt-1",children:g>1?"üìà Put Activity":"üìâ Call Activity"})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[t.jsxs("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-xl",children:[t.jsx("div",{className:"text-xs text-green-600 mb-1",children:"Call OI"}),t.jsx("div",{className:"text-xl font-bold text-green-700",children:Te(n)}),t.jsxs("div",{className:"text-sm "+(d>=0?"text-green-600":"text-red-600"),children:[d>=0?"+":"",Te(d)]})]}),t.jsxs("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-xl",children:[t.jsx("div",{className:"text-xs text-red-600 mb-1",children:"Put OI"}),t.jsx("div",{className:"text-xl font-bold text-red-700",children:Te(o)}),t.jsxs("div",{className:"text-sm "+(c>=0?"text-red-600":"text-green-600"),children:[c>=0?"+":"",Te(c)]})]})]}),t.jsxs("div",{className:"space-y-2 text-sm border-t pt-4 border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"CE LTP"}),t.jsxs("span",{className:"font-medium",children:["‚Çπ",l.ltp?.toFixed(2)||"‚Äî",t.jsxs("span",{className:"ml-1 text-xs "+(l.p_chng>=0?"text-green-600":"text-red-600"),children:["(",l.p_chng>=0?"+":"",l.p_chng?.toFixed(2)||0,")"]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"PE LTP"}),t.jsxs("span",{className:"font-medium",children:["‚Çπ",i.ltp?.toFixed(2)||"‚Äî",t.jsxs("span",{className:"ml-1 text-xs "+(i.p_chng>=0?"text-green-600":"text-red-600"),children:["(",i.p_chng>=0?"+":"",i.p_chng?.toFixed(2)||0,")"]})]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"CE IV / PE IV"}),t.jsxs("span",{className:"font-medium",children:[l.iv?.toFixed(1)||"‚Äî","% / ",i.iv?.toFixed(1)||"‚Äî","%"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Straddle"}),t.jsxs("span",{className:"font-bold text-purple-600",children:["‚Çπ",((l.ltp||0)+(i.ltp||0)).toFixed(2)]})]})]}),y.entry&&t.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl",children:[t.jsx("div",{className:"text-xs text-blue-600 font-medium mb-2",children:"Trading Signals"}),t.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"Entry:"})," ",t.jsx("span",{className:"font-bold",children:y.entry?.toFixed(2)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"SL:"})," ",t.jsx("span",{className:"font-bold text-red-600",children:y.stop_loss?.toFixed(2)})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-gray-500",children:"TP:"})," ",t.jsx("span",{className:"font-bold text-green-600",children:y.take_profit?.toFixed(2)})]})]})]})]})})});Ee.displayName="StrikeDetailPopup";const $e=e.memo(({children:e,onClick:a,className:r=""})=>t.jsx("div",{onClick:a,className:`\n      cursor-pointer transition-all duration-150\n      hover:bg-blue-100 dark:hover:bg-blue-900/40\n      hover:ring-1 hover:ring-blue-300 dark:hover:ring-blue-700\n      rounded px-1 -mx-1\n      ${r}\n    `,children:e}));$e.displayName="ClickableCell";const De=e.memo(({type:e})=>{const a=Pe[e]||Pe.NT;return t.jsx("span",{className:`px-1.5 py-0.5 text-[11px] rounded font-medium ${{success:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",danger:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",default:"bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400"}[a.color]}`,title:`${a.name}: ${a.description||""}`,children:e})});De.displayName="BuildupIndicator";const Be=e.memo(({oiPcr:e,oiChngPcr:a,volPcr:r,compact:s=!1})=>{const l=s?"text-[8px]":"text-[10px]",i=s?"px-0.5":"";return t.jsxs("div",{className:`flex items-center gap-0.5 ${l}`,children:[t.jsx("span",{className:`rounded font-medium ${i} bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400`,title:"OI PCR (PE/CE)",children:e>0?e.toFixed(1):"‚Äî"}),t.jsxs("span",{className:`rounded font-medium ${i} ${n=Math.abs(a),n&&0!==n?n>1.2?"text-green-700 bg-green-100 dark:bg-green-900/50 dark:text-green-300":n>.8?"text-amber-700 bg-amber-100 dark:bg-amber-900/50 dark:text-amber-300":"text-red-700 bg-red-100 dark:bg-red-900/50 dark:text-red-300":"text-gray-400 bg-gray-100 dark:bg-gray-700"}`,title:"OI Change PCR",children:["Œî",0!==a?Math.abs(a).toFixed(1):"‚Äî"]}),t.jsxs("span",{className:`rounded font-medium ${i} bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400`,title:"Volume PCR (PE/CE)",children:["V",r>0?r.toFixed(1):"‚Äî"]})]});var n});Be.displayName="PCRDisplay";const Ae=e.memo(({data:a,strike:r,atmStrike:s,spotPrice:l,onCellClick:i,onStrikeSelect:n,onStrikeClick:o,highlightData:d})=>{const{isColumnVisible:c}=Le(),{settings:x}=ve(),g=e=>d?.[e]?.color||"",m=e=>d?.[e]?.pct||0,h=e.useMemo(()=>a.ce||{},[a.ce]),u=e.useMemo(()=>a.pe||{},[a.pe]),[p,b]=e.useState(null),[y,v]=e.useState(!1),f=Math.abs(r-s)<.01,k="I"===h.mness,j="I"===u.mness,N=x.highlightITM,w=x.compactMode,_=h.OI||h.oi||0,C=u.OI||u.oi||0,S=h.oichng||0,I=u.oichng||0,F=h.volume||0,V=u.volume||0,M=_>0?C/_:0,L=0!==S?I/S:0,O=F>0?V/F:0,P=e.useCallback((e,t,s)=>{i&&i({strike:r,side:e,field:t,value:s,symbol:"ce"===e?h.sym:u.sym,sid:"ce"===e?h.sid:u.sid,fullData:a})},[r,h.sym,h.sid,u.sym,u.sid,i,a]),T=e.useCallback(()=>{o?o({strike:r,ce:h,pe:u,...a}):v(!0)},[o,r,h,u,a]),R=w?"py-1 px-1.5":"p-2",E=(e,t="")=>{const a=t||(e=>N&&e?"bg-yellow-50/50 dark:bg-yellow-900/10":"")(e);return`${R} text-sm text-center border-r border-gray-100 dark:border-gray-800 ${a}`};return t.jsxs(t.Fragment,{children:[t.jsxs("tr",{className:`\n          border-b border-gray-100 dark:border-gray-800\n          hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors\n          ${f?"bg-gradient-to-r from-yellow-50 via-amber-50 to-yellow-50 dark:from-yellow-900/30 dark:via-amber-900/20 dark:to-yellow-900/30 ring-2 ring-yellow-400 dark:ring-yellow-500 shadow-[0_0_15px_rgba(234,179,8,0.3)] relative z-10":""}\n        `,children:[c("ce_iv")&&t.jsxs("td",{className:`${E(k)} text-blue-600 dark:text-blue-400 relative`,onMouseEnter:()=>b("ce"),onMouseLeave:()=>b(null),children:[t.jsx($e,{onClick:()=>P("ce","iv",h.iv),children:t.jsx("span",{className:"cursor-help underline decoration-dotted decoration-blue-400/50 font-medium",children:h.iv?.toFixed(1)||"‚Äî"})}),t.jsx(Re,{optgeeks:h.optgeeks,isVisible:"ce"===p,position:"right"})]}),c("ce_delta")&&t.jsx("td",{className:E(k),children:t.jsx($e,{onClick:()=>P("ce","delta",h.optgeeks?.delta),children:h.optgeeks?.delta?.toFixed(3)||"‚Äî"})}),c("ce_gamma")&&t.jsx("td",{className:E(k),children:t.jsx($e,{onClick:()=>P("ce","gamma",h.optgeeks?.gamma),children:h.optgeeks?.gamma?.toFixed(5)||"‚Äî"})}),c("ce_theta")&&t.jsx("td",{className:`${E(k)} text-red-500`,children:t.jsx($e,{onClick:()=>P("ce","theta",h.optgeeks?.theta),children:h.optgeeks?.theta?.toFixed(2)||"‚Äî"})}),c("ce_vega")&&t.jsx("td",{className:E(k),children:t.jsx($e,{onClick:()=>P("ce","vega",h.optgeeks?.vega),children:h.optgeeks?.vega?.toFixed(3)||"‚Äî"})}),c("ce_oichng")&&t.jsx("td",{className:E(k,g("ce_oichng")),children:t.jsx($e,{onClick:()=>P("ce","oichng",h.oichng),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsxs("span",{className:"font-medium "+(h.oichng>0?"text-green-600":h.oichng<0?"text-red-600":""),children:[h.oichng>0?"+":"",Te(h.oichng)]}),m("ce_oichng")>0&&t.jsxs("span",{className:"text-xs text-gray-500",children:[m("ce_oichng").toFixed(0),"%"]})]})})}),c("ce_oi")&&t.jsx("td",{className:E(k,g("ce_oi")),children:t.jsx($e,{onClick:()=>P("ce","OI",h.OI),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:Te(h.OI)}),m("ce_oi")>0&&t.jsxs("span",{className:"text-xs text-gray-500",children:[m("ce_oi").toFixed(0),"%"]})]})})}),c("ce_volume")&&t.jsx("td",{className:`${E(k,g("ce_volume"))} text-gray-600 dark:text-gray-400`,children:t.jsx($e,{onClick:()=>P("ce","volume",h.volume),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("span",{children:Te(h.volume)}),m("ce_volume")>0&&t.jsxs("span",{className:"text-xs text-gray-500",children:[m("ce_volume").toFixed(0),"%"]})]})})}),c("ce_buildup")&&t.jsx("td",{className:E(k),children:t.jsx($e,{onClick:()=>P("ce","buildup",h.btyp),children:t.jsx(De,{type:h.btyp})})}),c("ce_ltp")&&t.jsx("td",{className:`${E(k)} font-semibold`,children:t.jsx($e,{onClick:()=>P("ce","ltp",h.ltp),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("span",{className:"text-gray-900 dark:text-white",children:h.ltp?.toFixed(2)||"‚Äî"}),t.jsxs("span",{className:"text-xs "+(h.p_chng>0?"text-green-600":h.p_chng<0?"text-red-600":"text-gray-400"),children:[h.p_chng>0?"+":"",h.p_chng?.toFixed(1)||"0"]})]})})}),c("ce_bid")&&t.jsx("td",{className:`${E(k)} text-xs text-gray-400`,children:t.jsx($e,{onClick:()=>P("ce","bid",h.bid),children:h.bid||"‚Äî"})}),c("ce_ask")&&t.jsx("td",{className:`${E(k)} text-xs text-gray-400`,children:t.jsx($e,{onClick:()=>P("ce","ask",h.ask),children:h.ask||"‚Äî"})}),t.jsx("td",{onClick:T,className:`\n            ${w?"py-0.5 px-1":R} text-center font-bold sticky left-0 z-10 cursor-pointer\n            ${f?"text-blue-600 dark:text-blue-400":"text-gray-800 dark:text-gray-200"}\n            ${w?"text-sm":"text-lg"}\n            bg-gray-100 dark:bg-gray-800 border-x-2 border-gray-300 dark:border-gray-600\n            hover:bg-blue-100 dark:hover:bg-blue-900/50 transition-colors\n            min-w-[60px]\n          `,children:t.jsxs("div",{className:"flex flex-col items-center "+(w?"gap-0 leading-tight":"gap-0.5"),children:[t.jsx("span",{className:f?"font-bold":"",children:r}),!w&&f&&t.jsx("span",{className:"text-[10px] text-blue-500 font-medium px-1.5 py-0.5 bg-blue-100 dark:bg-blue-900/50 rounded",children:"ATM"}),t.jsx(Be,{oiPcr:M,oiChngPcr:L,volPcr:O,compact:w})]})}),c("pe_bid")&&t.jsx("td",{className:`${E(j)} text-xs text-gray-400`,children:t.jsx($e,{onClick:()=>P("pe","bid",u.bid),children:u.bid||"‚Äî"})}),c("pe_ask")&&t.jsx("td",{className:`${E(j)} text-xs text-gray-400`,children:t.jsx($e,{onClick:()=>P("pe","ask",u.ask),children:u.ask||"‚Äî"})}),c("pe_ltp")&&t.jsx("td",{className:`${E(j)} font-semibold`,children:t.jsx($e,{onClick:()=>P("pe","ltp",u.ltp),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("span",{className:"text-gray-900 dark:text-white",children:u.ltp?.toFixed(2)||"‚Äî"}),t.jsxs("span",{className:"text-xs "+(u.p_chng>0?"text-green-600":u.p_chng<0?"text-red-600":"text-gray-400"),children:[u.p_chng>0?"+":"",u.p_chng?.toFixed(1)||"0"]})]})})}),c("pe_buildup")&&t.jsx("td",{className:E(j),children:t.jsx($e,{onClick:()=>P("pe","buildup",u.btyp),children:t.jsx(De,{type:u.btyp})})}),c("pe_volume")&&t.jsx("td",{className:`${E(j,g("pe_volume"))} text-gray-600 dark:text-gray-400`,children:t.jsx($e,{onClick:()=>P("pe","volume",u.volume),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("span",{children:Te(u.volume)}),m("pe_volume")>0&&t.jsxs("span",{className:"text-xs text-gray-500",children:[m("pe_volume").toFixed(0),"%"]})]})})}),c("pe_oi")&&t.jsx("td",{className:E(j,g("pe_oi")),children:t.jsx($e,{onClick:()=>P("pe","OI",u.OI),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:Te(u.OI)}),m("pe_oi")>0&&t.jsxs("span",{className:"text-xs text-gray-500",children:[m("pe_oi").toFixed(0),"%"]})]})})}),c("pe_oichng")&&t.jsx("td",{className:E(j,g("pe_oichng")),children:t.jsx($e,{onClick:()=>P("pe","oichng",u.oichng),children:t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsxs("span",{className:"font-medium "+(u.oichng>0?"text-green-600":u.oichng<0?"text-red-600":""),children:[u.oichng>0?"+":"",Te(u.oichng)]}),m("pe_oichng")>0&&t.jsxs("span",{className:"text-xs text-gray-500",children:[m("pe_oichng").toFixed(0),"%"]})]})})}),c("pe_delta")&&t.jsx("td",{className:E(j),children:t.jsx($e,{onClick:()=>P("pe","delta",u.optgeeks?.delta),children:u.optgeeks?.delta?.toFixed(3)||"‚Äî"})}),c("pe_iv")&&t.jsxs("td",{className:`${E(j)} text-blue-600 dark:text-blue-400 relative`,onMouseEnter:()=>b("pe"),onMouseLeave:()=>b(null),children:[t.jsx($e,{onClick:()=>P("pe","iv",u.iv),children:t.jsx("span",{className:"cursor-help underline decoration-dotted decoration-blue-400/50 font-medium",children:u.iv?.toFixed(1)||"‚Äî"})}),t.jsx(Re,{optgeeks:u.optgeeks,isVisible:"pe"===p,position:"left"})]}),c("pe_gamma")&&t.jsx("td",{className:E(j),children:t.jsx($e,{onClick:()=>P("pe","gamma",u.optgeeks?.gamma),children:u.optgeeks?.gamma?.toFixed(5)||"‚Äî"})}),c("pe_theta")&&t.jsx("td",{className:`${E(j)} text-red-500`,children:t.jsx($e,{onClick:()=>P("pe","theta",u.optgeeks?.theta),children:u.optgeeks?.theta?.toFixed(2)||"‚Äî"})}),c("pe_vega")&&t.jsx("td",{className:E(j),children:t.jsx($e,{onClick:()=>P("pe","vega",u.optgeeks?.vega),children:u.optgeeks?.vega?.toFixed(3)||"‚Äî"})})]}),y&&t.jsx(Ee,{data:a,strike:r,spotPrice:l,onClose:()=>v(!1)})]})});Ae.displayName="StrikeRow",Ae.propTypes={data:l.object.isRequired,strike:l.number.isRequired,atmStrike:l.number,spotPrice:l.number,onCellClick:l.func,onStrikeSelect:l.func};const Ge=e.memo(({label:e,value:a,change:r,highlight:s=!1})=>{const l=r>0,i=0===r||void 0===r;return t.jsxs("div",{className:`\n            flex items-center gap-2 px-3 py-1.5 rounded-full border shadow-sm transition-all duration-200\n            ${s?"bg-blue-50/50 dark:bg-blue-900/10 border-blue-200 dark:border-blue-700/50":"bg-white/50 dark:bg-gray-800/50 border-gray-200 dark:border-gray-700"}\n            backdrop-blur-md\n        `,children:[t.jsx("span",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:e}),t.jsxs("div",{className:"flex items-center gap-1.5",children:[t.jsx("span",{className:"text-sm font-bold tracking-tight "+(s?"text-blue-700 dark:text-blue-300":"text-gray-900 dark:text-gray-100"),children:a?.toLocaleString?.()||"‚Äî"}),!i&&t.jsxs("span",{className:`\n                        flex items-center text-xs font-bold px-1.5 py-0.5 rounded-full\n                        ${l?"bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400":"bg-rose-100 dark:bg-rose-900/30 text-rose-600 dark:text-rose-400"}\n                    `,children:[l?t.jsx(G,{className:"w-3 h-3 mr-0.5"}):t.jsx(W,{className:"w-3 h-3 mr-0.5"}),Math.abs(r).toFixed(2),"%"]})]})]})});Ge.displayName="Metric";const We=e.memo(({spotData:e,futuresData:a,pcr:r,maxPain:s})=>t.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto pb-1 no-scrollbar",children:[t.jsx(Ge,{label:"Spot",value:e?.ltp,change:e?.change_percent,highlight:!0}),a&&t.jsx(Ge,{label:"Fut",value:a.ltp,change:a.change_percent}),t.jsx(Ge,{label:"PCR",value:r?.toFixed(2)}),s&&t.jsx(Ge,{label:"Max Pain",value:s})]}));We.displayName="SpotBar",We.propTypes={spotData:l.object,futuresData:l.object,pcr:l.number,maxPain:l.number};const Ue=e=>null==e?"‚Äî":e.toLocaleString("en-IN",{maximumFractionDigits:2}),ze=e.memo(({spotData:a,futuresData:r,strikes:s,rowHeight:l=44,headerHeight:i=32})=>{const n=a?.ltp,o=a?.change,d=a?.change_percent,c=r?.ltp,x=r?.change,g=c&&n?c-n:null,m=g>0,h=e.useMemo(()=>{if(!n||!s||s.length<2)return null;for(let e=0;e<s.length-1;e++){const t=s[e],a=s[e+1],r=Math.min(t,a),l=Math.max(t,a);if(n>r&&n<l)return e}return null},[n,s]);if(!n||null===h)return null;const u=i+(h+1)*l;return t.jsx("div",{className:"absolute left-0 right-0 z-20 pointer-events-none",style:{top:`${u}px`,transform:"translateY(-50%)"},children:t.jsx("div",{className:"flex items-center justify-center",children:t.jsxs("div",{className:"flex items-center gap-2 bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 px-3 py-0.5 rounded-full shadow-lg border border-white/30 pointer-events-auto",children:[t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-[9px] font-medium text-white/70",children:"SPOT"}),t.jsx("span",{className:"text-xs font-bold text-white",children:Ue(n)}),void 0!==o&&t.jsxs("span",{className:"flex items-center text-[10px] font-semibold "+(o>=0?"text-green-300":"text-red-300"),children:[o>=0?t.jsx(G,{className:"w-2.5 h-2.5"}):t.jsx(W,{className:"w-2.5 h-2.5"}),o>=0?"+":"",o?.toFixed(1),"(",d?.toFixed(1),"%)"]})]}),t.jsx("div",{className:"w-px h-3 bg-white/40"}),c&&t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("span",{className:"text-[9px] font-medium text-white/70",children:"FUT"}),t.jsx("span",{className:"text-xs font-bold text-white",children:Ue(c)}),void 0!==x&&t.jsxs("span",{className:"flex items-center text-[10px] font-semibold "+(x>=0?"text-green-300":"text-red-300"),children:[x>=0?t.jsx(G,{className:"w-2.5 h-2.5"}):t.jsx(W,{className:"w-2.5 h-2.5"}),x>=0?"+":"",x?.toFixed(1)]})]}),null!==g&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"w-px h-3 bg-white/40"}),t.jsxs("span",{className:"text-[9px] font-bold "+(m?"text-amber-300":"text-cyan-300"),children:[m?"+":"",g.toFixed(0)]})]})]})})})});ze.displayName="SpotIndicatorRow";const He=({symbols:a,currentSymbol:r,onSelect:s,theme:l})=>{const[n,o]=e.useState(!1),[d,c]=e.useState(""),[x,g]=e.useState({top:0,left:0}),m=e.useRef(null),h=e.useRef(null),u=e.useRef(null),p=["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY","SENSEX","BANKEX","NIFTYNXT50"],b=a.filter(e=>e.symbol.toLowerCase().includes(d.toLowerCase())||(e.name||"").toLowerCase().includes(d.toLowerCase())),y=b.filter(e=>p.includes(e.symbol)),v=b.filter(e=>!p.includes(e.symbol));e.useEffect(()=>{n&&u.current&&u.current.focus()},[n]);const f=e=>{s(e.symbol),o(!1),c("")},k="dark"===l,j=p.includes(r);return t.jsxs("div",{ref:m,className:"relative",children:[t.jsxs("button",{ref:h,onClick:()=>n?o(!1):(()=>{if(h.current){const e=h.current.getBoundingClientRect();g({top:e.bottom+8,left:e.left})}o(!0)})(),className:`\n                    flex items-center gap-2 px-4 py-2 rounded-xl border shadow-md\n                    font-bold text-sm transition-all duration-200 min-w-[140px]\n                    ${k?"bg-gradient-to-r from-slate-800 to-slate-900 border-slate-600 text-white hover:border-slate-500":"bg-gradient-to-r from-white to-gray-50 border-gray-200 text-gray-900 hover:border-gray-300"}\n                    ${n?"ring-2 ring-emerald-500/50 shadow-lg":""}\n                `,children:[t.jsx("span",{className:"text-lg",children:j?"üìà":"üè¢"}),t.jsx("span",{className:"tracking-wide",children:r||"Select"}),t.jsx("svg",{className:`w-4 h-4 ml-auto transition-transform ${n?"rotate-180":""} ${k?"text-gray-400":"text-gray-500"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&i.createPortal(t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[2147483646]",onClick:()=>o(!1)}),t.jsxs("div",{className:"fixed w-80 max-h-[70vh] rounded-xl border shadow-2xl z-[2147483647] overflow-hidden "+(k?"bg-slate-900 border-slate-700":"bg-white border-gray-200"),style:{top:x.top,left:x.left},children:[t.jsx("div",{className:"p-3 border-b "+(k?"border-slate-700":"border-gray-100"),children:t.jsxs("div",{className:"relative",children:[t.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 "+(k?"text-gray-500":"text-gray-400"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),t.jsx("input",{ref:u,type:"text",placeholder:"Search symbols...",value:d,onChange:e=>c(e.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg text-sm focus:outline-none focus:ring-2 "+(k?"bg-slate-800 text-white placeholder-gray-500 focus:ring-emerald-500/50":"bg-gray-100 text-gray-900 placeholder-gray-400 focus:ring-emerald-400/50")})]})}),t.jsxs("div",{className:"overflow-y-auto max-h-80 p-2",children:[y.length>0&&t.jsxs("div",{className:"mb-3",children:[t.jsx("div",{className:"px-3 py-1.5 text-xs font-bold uppercase tracking-wider "+(k?"text-blue-400":"text-blue-600"),children:"üìä Indices"}),y.map(e=>t.jsxs("button",{onClick:()=>f(e),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left transition-all "+(r===e.symbol?k?"bg-emerald-600/20 text-emerald-400 font-bold":"bg-emerald-50 text-emerald-700 font-bold":k?"hover:bg-slate-700/50 text-gray-200":"hover:bg-gray-100 text-gray-800"),children:[t.jsx("span",{className:"text-lg",children:"üìà"}),t.jsx("span",{className:"font-semibold",children:e.symbol}),r===e.symbol&&t.jsx("svg",{className:"w-4 h-4 ml-auto text-emerald-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.symbol))]}),v.length>0&&t.jsxs("div",{children:[t.jsx("div",{className:"px-3 py-1.5 text-xs font-bold uppercase tracking-wider "+(k?"text-emerald-400":"text-emerald-600"),children:"üè¢ Equities"}),v.map(e=>t.jsxs("button",{onClick:()=>f(e),className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-left transition-all "+(r===e.symbol?k?"bg-emerald-600/20 text-emerald-400 font-bold":"bg-emerald-50 text-emerald-700 font-bold":k?"hover:bg-slate-700/50 text-gray-200":"hover:bg-gray-100 text-gray-800"),children:[t.jsx("span",{className:"text-lg",children:"üè¢"}),t.jsx("span",{className:"font-semibold",children:e.symbol}),r===e.symbol&&t.jsx("svg",{className:"w-4 h-4 ml-auto text-emerald-500",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},e.symbol))]}),0===b.length&&t.jsx("div",{className:"text-center py-8 text-sm "+(k?"text-gray-500":"text-gray-400"),children:"No symbols found"})]})]})]}),document.getElementById("dropdown-root")||document.body)]})},qe=e.memo(({showChart:a,onToggleChart:l})=>{const i=r(),n=s(C),o=s(p),d=s(f),c=s(e=>e.theme.theme),x=s(e=>e.chart.symbols),g=n||"NIFTY";e.useEffect(()=>{if(0===x.length){(async()=>{try{const e=await oe.getSymbols();e.success&&e.data&&i(S(e.data))}catch(e){}})()}},[x.length,i]);return t.jsxs("div",{className:"flex items-center gap-3 p-1",children:[t.jsx(He,{symbols:x.length>0?x:[{symbol:"NIFTY"},{symbol:"BANKNIFTY"},{symbol:"FINNIFTY"}],currentSymbol:g,onSelect:e=>{i(I({newSid:e}))},theme:c}),!a&&t.jsxs("div",{className:"relative group",children:[t.jsx("select",{value:o||"",onChange:e=>{i(F(Number(e.target.value)))},className:`\n                            appearance-none pl-4 pr-8 py-1.5 text-sm font-medium rounded-full \n                            border transition-all duration-200 cursor-pointer shadow-sm\n                            ${"dark"===c?"bg-gray-800 border-gray-700 text-gray-200 hover:border-gray-600 focus:ring-2 focus:ring-emerald-500/50":"bg-white border-gray-200 text-gray-700 hover:border-gray-300 focus:ring-2 focus:ring-emerald-500/50"}\n                        `,children:d?.map(e=>{return t.jsx("option",{value:e,children:(a=e,new Date(1e3*Number(a)).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"2-digit"}))},e);var a})}),t.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400",children:t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),l&&t.jsx("button",{onClick:l,className:`\n                        flex items-center gap-2 px-4 py-1.5 rounded-full text-sm font-semibold shadow-sm\n                        transition-all duration-200 border\n                        ${a?"dark"===c?"bg-emerald-600 text-white border-emerald-500 hover:bg-emerald-500 hover:shadow-emerald-500/20":"bg-emerald-500 text-white border-emerald-400 hover:bg-emerald-600 hover:shadow-emerald-500/20":"dark"===c?"bg-gray-800 text-gray-300 border-gray-700 hover:bg-gray-700 hover:text-white":"bg-white text-gray-600 border-gray-200 hover:bg-gray-50 hover:text-gray-900"}\n                    `,title:a?"View Option Chain Table":"View Chart",children:a?t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Table View"]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})}),"Chart View"]})})]})});qe.displayName="OptionControls";const Ke={price:{label:"Price Data",columns:["ltp","chng","bid","ask"]},oi:{label:"Open Interest",columns:["oi","oichng","buildup"]},greeks:{label:"Greeks",columns:["iv","delta","gamma","theta","vega"]},volume:{label:"Volume",columns:["volume"]}},Ye={ltp:"LTP",chng:"Change",bid:"Bid",ask:"Ask",oi:"OI",oichng:"OI Chg",buildup:"Buildup",iv:"IV",delta:"Delta",gamma:"Gamma",theta:"Theta",vega:"Vega",volume:"Volume"},Je={default:{name:"Default",icon:"‚öñÔ∏è",desc:"Balanced view"},buyer:{name:"Buyer",icon:"üìà",desc:"Premium & Greeks"},seller:{name:"Seller",icon:"üìâ",desc:"OI & Theta"},scalper:{name:"Scalper",icon:"‚ö°",desc:"Quick trades"},greeks:{name:"Greeks",icon:"üî¨",desc:"All Greeks"}},Ze=e.memo(({label:e,description:a,enabled:r,onChange:s,icon:l})=>t.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 dark:border-gray-800 last:border-0",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[l&&t.jsx(l,{className:"w-5 h-5 text-gray-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e}),a&&t.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a})]})]}),t.jsx(c,{checked:r,onChange:s,className:(r?"bg-blue-600":"bg-gray-200 dark:bg-gray-700")+"\n        relative inline-flex h-6 w-11 items-center rounded-full transition-colors",children:t.jsx("span",{className:(r?"translate-x-6":"translate-x-1")+"\n          inline-block h-4 w-4 transform rounded-full bg-white transition-transform"})})]}));Ze.displayName="SettingToggle";const Xe=e.memo(({label:e,value:a,onChange:r,min:s,max:l,step:i=1})=>t.jsxs("div",{className:"flex items-center justify-between py-3 border-b border-gray-100 dark:border-gray-800 last:border-0",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>r(Math.max(s,a-i)),className:"w-8 h-8 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600",children:"-"}),t.jsx("span",{className:"w-12 text-center font-medium",children:a}),t.jsx("button",{onClick:()=>r(Math.min(l,a+i)),className:"w-8 h-8 flex items-center justify-center rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600",children:"+"})]})]}));Xe.displayName="NumberSetting";const Qe=e.memo(({isOpen:a,onClose:r})=>{const{settings:s,toggleSortOrder:l,toggleITMHighlight:i,toggleCompactMode:c,setStrikesPerPage:x}=ve(),{visibleColumns:g,toggleColumn:m,applyPreset:h,isColumnVisible:u}=Le(),[p,b]=e.useState(0),y=[{name:"Display",icon:z},{name:"Columns",icon:H},{name:"Presets",icon:q}];return t.jsx(n,{appear:!0,show:a,as:e.Fragment,children:t.jsxs(o,{as:"div",className:"relative z-50",onClose:r,children:[t.jsx(n.Child,{as:e.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm"})}),t.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:t.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:t.jsx(n.Child,{as:e.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:t.jsxs(o.Panel,{className:"w-full max-w-lg transform overflow-hidden rounded-2xl bg-white dark:bg-gray-900 shadow-2xl transition-all",children:[t.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[t.jsxs(o.Title,{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[t.jsx(U,{className:"w-5 h-5"}),"Table Settings"]}),t.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:t.jsx(B,{className:"w-5 h-5"})})]}),t.jsxs(d.Group,{selectedIndex:p,onChange:b,children:[t.jsx(d.List,{className:"flex border-b border-gray-200 dark:border-gray-700",children:y.map(e=>t.jsxs(d,{className:({selected:e})=>"flex-1 flex items-center justify-center gap-2 py-3 text-sm font-medium transition-colors outline-none\n                          "+(e?"text-blue-600 border-b-2 border-blue-600 bg-blue-50/50 dark:bg-blue-900/20":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[t.jsx(e.icon,{className:"w-4 h-4"}),e.name]},e.name))}),t.jsxs(d.Panels,{className:"p-4",children:[t.jsx(d.Panel,{children:t.jsxs("div",{className:"space-y-1",children:[t.jsx(Ze,{label:"Compact Mode",description:"Reduce row height for more data",enabled:s.compactMode,onChange:c,icon:H}),t.jsx(Ze,{label:"ITM Highlight",description:"Highlight in-the-money strikes",enabled:s.highlightITM,onChange:i,icon:K}),t.jsx(Ze,{label:"Descending Order",description:"Show higher strikes first",enabled:"desc"===s.sortOrder,onChange:l,icon:Y}),t.jsx(Xe,{label:"Visible Strikes",value:s.strikesPerPage,onChange:x,min:11,max:51,step:2})]})}),t.jsx(d.Panel,{children:t.jsx("div",{className:"space-y-4 max-h-80 overflow-y-auto",children:Object.entries(Ke).map(([e,a])=>t.jsxs("div",{children:[t.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase mb-2",children:a.label}),t.jsx("div",{className:"grid grid-cols-2 gap-2",children:a.columns.map(e=>{const a=`ce_${e}`,r=`pe_${e}`,s=u(a),l=u(r),i=s&&l;return t.jsxs("button",{onClick:()=>{m(a),m(r)},className:"flex items-center justify-between px-3 py-2 rounded-lg border transition-colors "+(i?"bg-blue-50 border-blue-300 text-blue-700 dark:bg-blue-900/30 dark:border-blue-700 dark:text-blue-300":"bg-gray-50 border-gray-200 text-gray-600 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400"),children:[t.jsx("span",{className:"text-sm",children:Ye[e]}),i&&t.jsx(J,{className:"w-4 h-4"})]},e)})})]},e))})}),t.jsx(d.Panel,{children:t.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(Je).map(([e,a])=>t.jsxs("button",{onClick:()=>{h(e),r()},className:"flex flex-col items-center p-4 rounded-xl border border-gray-200 dark:border-gray-700 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:border-blue-300 dark:hover:border-blue-700 transition-colors group",children:[t.jsx("span",{className:"text-2xl mb-2",children:a.icon}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white group-hover:text-blue-600",children:a.name}),t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.desc})]},e))})})]})]})]})})})})]})})});Qe.displayName="TableSettingsModal";const et=e.memo(()=>{const[a,r]=e.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>r(!0),className:"flex items-center gap-1.5 px-2 py-1.5 rounded-lg text-xs font-medium transition-all duration-200 border bg-white text-gray-600 border-gray-200 hover:bg-gray-50 dark:bg-gray-800 dark:text-gray-400 dark:border-gray-700 dark:hover:bg-gray-700",title:"Table Settings",children:t.jsx(U,{className:"w-4 h-4"})}),t.jsx(Qe,{isOpen:a,onClose:()=>r(!1)})]})});et.displayName="SettingsButton";const tt=e.memo(({strikeData:e,onClose:a})=>{if(!e)return null;const{strike:r,reversal:s,wkly_reversal:l,fut_reversal:i,rs:n,rr:o,ss:d,sr_diff:c,ce_tv:x,pe_tv:g,pcr:m,price_range:h,trading_signals:u,market_regimes:p,recommended_strategy:b,alert:y,time_decay:v,ce:f,pe:k}=e,j={low:"text-green-500 bg-green-100 dark:bg-green-900/30",medium:"text-yellow-500 bg-yellow-100 dark:bg-yellow-900/30",high:"text-red-500 bg-red-100 dark:bg-red-900/30",bullish:"text-green-500 bg-green-100 dark:bg-green-900/30",bearish:"text-red-500 bg-red-100 dark:bg-red-900/30",sideways:"text-gray-500 bg-gray-100 dark:bg-gray-900/30"};return t.jsxs("div",{className:"bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 shadow-lg",children:[t.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["Strike ",r]}),b&&t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300",children:b}),y&&t.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${{low:"border-gray-300 bg-gray-50 dark:border-gray-700 dark:bg-gray-800",medium:"border-yellow-300 bg-yellow-50 dark:border-yellow-700 dark:bg-yellow-900/20",high:"border-red-300 bg-red-50 dark:border-red-700 dark:bg-red-900/20"}[y.level]}`,children:y.message})]}),t.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:t.jsx(B,{className:"w-5 h-5 text-gray-500"})})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 p-4",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Z,{className:"w-5 h-5 text-blue-500"}),t.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Reversal Levels"})]}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Daily"}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:s?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Weekly"}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:l?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Futures"}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:i?.toFixed(2)||"‚Äî"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(X,{className:"w-5 h-5 text-yellow-500"}),t.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Trading Signals"})]}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Entry"}),t.jsx("span",{className:"font-medium text-green-600",children:u?.entry?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Stop Loss"}),t.jsx("span",{className:"font-medium text-red-600",children:u?.stop_loss?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Take Profit"}),t.jsx("span",{className:"font-medium text-green-600",children:u?.take_profit?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Risk:Reward"}),t.jsxs("span",{className:"font-medium text-blue-600",children:["1:",u?.risk_reward||"‚Äî"]})]})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(A,{className:"w-5 h-5 text-purple-500"}),t.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"S/R Levels"})]}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Resistance"}),t.jsx("span",{className:"font-medium text-red-600",children:n?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Support"}),t.jsx("span",{className:"font-medium text-green-600",children:d?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"Range"}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:c?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-500",children:"PCR"}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:m?.toFixed(3)||"0.00"})]})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx(Q,{className:"w-5 h-5 text-cyan-500"}),t.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:"Market Regime"})]}),t.jsxs("div",{className:"space-y-2",children:[p&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Volatility"}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${j[p.volatility]}`,children:p.volatility?.toUpperCase()})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Trend"}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${j[p.trend]}`,children:p.trend?.toUpperCase()})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Liquidity"}),t.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${j[p.liquidity]}`,children:p.liquidity?.toUpperCase()})]})]}),t.jsxs("div",{className:"flex justify-between items-center pt-1 border-t border-gray-200 dark:border-gray-700",children:[t.jsx("span",{className:"text-sm text-gray-500",children:"Time Decay"}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:v?.toFixed(4)||"‚Äî"})]})]})]})]}),t.jsx("div",{className:"px-4 pb-4",children:t.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-red-50 dark:from-green-900/20 dark:to-red-900/20 rounded-xl p-4 flex items-center justify-between",children:[t.jsxs("div",{className:"text-center flex-1",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"CE Time Value"}),t.jsx("div",{className:"text-lg font-bold text-green-600",children:x?.toFixed(2)||"0.00"})]}),t.jsx("div",{className:"w-px h-12 bg-gray-300 dark:bg-gray-600"}),t.jsxs("div",{className:"text-center flex-1",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"Price Range"}),t.jsxs("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:[h?.low?.toFixed(0)," - ",h?.high?.toFixed(0),t.jsxs("span",{className:"text-xs text-gray-500 ml-1",children:["(",(100*h?.confidence)?.toFixed(0),"%)"]})]})]}),t.jsx("div",{className:"w-px h-12 bg-gray-300 dark:bg-gray-600"}),t.jsxs("div",{className:"text-center flex-1",children:[t.jsx("div",{className:"text-xs text-gray-500 mb-1",children:"PE Time Value"}),t.jsx("div",{className:"text-lg font-bold text-red-600",children:g>.01?g?.toFixed(2):"~0.00"})]})]})})]})});tt.displayName="StrikeDetailPanel",tt.propTypes={strikeData:l.object,onClose:l.func.isRequired};const at=e.memo(({isOpen:a,onClose:r,strikeData:s,symbol:l})=>{const[i,n]=e.useState("overview");if(!a||!s)return null;const{strike:o,ce:d={},pe:c={}}=s,x=d.optgeeks||{},g=c.optgeeks||{},m=[{id:"overview",label:"Overview",icon:A},{id:"greeks",label:"Greeks",icon:Q},{id:"signals",label:"Signals",icon:X},{id:"reversals",label:"Reversals",icon:Z},{id:"strategies",label:"Strategies",icon:ee}],h=(d.ltp||0)+(c.ltp||0),u=d.oi&&d.oi>0?(c.oi/d.oi).toFixed(2):"‚Äî";return t.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-modal":"true",children:[t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),t.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:t.jsxs("div",{className:"relative w-full max-w-4xl bg-white dark:bg-gray-900 rounded-2xl shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-indigo-600/20 via-purple-500/15 to-pink-500/20"}),t.jsxs("div",{className:"relative flex items-center justify-between p-4 border-b border-gray-200/50 dark:border-gray-700/50",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 text-white shadow-lg",children:t.jsx(A,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Strike Analysis ‚Äî ",l," ",o]}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"Comprehensive analysis with Greeks, Signals & Strategies"})]})]}),t.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:t.jsx(B,{className:"w-6 h-6 text-gray-500"})})]})]}),t.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700 px-4 overflow-x-auto",children:m.map(e=>{const a=e.icon;return t.jsxs("button",{onClick:()=>n(e.id),className:"px-4 py-3 text-sm font-medium border-b-2 transition-all flex items-center gap-2 whitespace-nowrap "+(i===e.id?"border-indigo-500 text-indigo-600 bg-indigo-50/50 dark:bg-indigo-900/20":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"),children:[t.jsx(a,{className:"w-4 h-4"}),e.label]},e.id)})}),t.jsx("div",{className:"p-5 max-h-[60vh] overflow-y-auto",children:(()=>{switch(i){case"overview":return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-4 border border-green-200 dark:border-green-800",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:"text-xs font-bold text-green-700 dark:text-green-400 uppercase tracking-wider",children:["Call (",o,"CE)"]}),t.jsxs("span",{className:"px-2 py-0.5 rounded text-xs font-bold "+((d.change||d.p_chng||0)>=0?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400"),children:[(d.change||d.p_chng||0)>=0?"+":"",(d.change||d.p_chng||0).toFixed(2)]})]}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"LTP"}),t.jsxs("span",{className:"font-bold text-green-700 dark:text-green-400",children:["‚Çπ",d.ltp?.toFixed(2)||"‚Äî"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"OI"}),t.jsxs("span",{className:"font-semibold",children:[((d.oi||d.OI||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"OI Chg"}),t.jsxs("span",{className:"font-semibold "+((d.oi_chng||d.oichng||0)>=0?"text-green-600":"text-red-600"),children:[(d.oi_chng||d.oichng||0)>=0?"+":"",((d.oi_chng||d.oichng||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Volume"}),t.jsxs("span",{className:"font-semibold",children:[((d.volume||d.vol||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"IV"}),t.jsxs("span",{className:"font-semibold",children:[d.iv?.toFixed(1)||"‚Äî","%"]})]})]})]}),t.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20 rounded-xl p-4 border border-red-200 dark:border-red-800",children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsxs("span",{className:"text-xs font-bold text-red-700 dark:text-red-400 uppercase tracking-wider",children:["Put (",o,"PE)"]}),t.jsxs("span",{className:"px-2 py-0.5 rounded text-xs font-bold "+((c.change||c.p_chng||0)>=0?"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400"),children:[(c.change||c.p_chng||0)>=0?"+":"",(c.change||c.p_chng||0).toFixed(2)]})]}),t.jsxs("div",{className:"space-y-2 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"LTP"}),t.jsxs("span",{className:"font-bold text-red-700 dark:text-red-400",children:["‚Çπ",c.ltp?.toFixed(2)||"‚Äî"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"OI"}),t.jsxs("span",{className:"font-semibold",children:[((c.oi||c.OI||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"OI Chg"}),t.jsxs("span",{className:"font-semibold "+((c.oi_chng||c.oichng||0)>=0?"text-green-600":"text-red-600"),children:[(c.oi_chng||c.oichng||0)>=0?"+":"",((c.oi_chng||c.oichng||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Volume"}),t.jsxs("span",{className:"font-semibold",children:[((c.volume||c.vol||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"IV"}),t.jsxs("span",{className:"font-semibold",children:[c.iv?.toFixed(1)||"‚Äî","%"]})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"Straddle"}),t.jsxs("div",{className:"text-lg font-bold text-purple-600",children:["‚Çπ",h.toFixed(2)]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"PCR"}),t.jsx("div",{className:"text-lg font-bold "+(parseFloat(u)>1?"text-green-600":"text-red-600"),children:u})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"IV Skew"}),t.jsxs("div",{className:"text-lg font-bold",children:[((d.iv||0)-(c.iv||0)).toFixed(1),"%"]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500 uppercase",children:"OI Ratio"}),t.jsx("div",{className:"text-lg font-bold",children:d.oi&&c.oi?(d.oi/c.oi).toFixed(2):"‚Äî"})]})]})]});case"greeks":{const e=[{key:"delta",label:"Œî Delta",desc:"Price sensitivity",format:e=>e?.toFixed(4)||"‚Äî"},{key:"gamma",label:"Œì Gamma",desc:"Delta sensitivity",format:e=>e?.toFixed(6)||"‚Äî"},{key:"theta",label:"Œò Theta",desc:"Time decay",format:e=>e?.toFixed(4)||"‚Äî"},{key:"vega",label:"ŒΩ Vega",desc:"Volatility sensitivity",format:e=>e?.toFixed(4)||"‚Äî"},{key:"rho",label:"œÅ Rho",desc:"Interest rate sensitivity",format:e=>e?.toFixed(4)||"‚Äî"},{key:"vanna",label:"Vanna",desc:"Delta-volatility",format:e=>e?.toFixed(6)||"‚Äî"},{key:"charm",label:"Charm",desc:"Delta decay",format:e=>e?.toFixed(6)||"‚Äî"},{key:"vomma",label:"Vomma",desc:"Vega convexity",format:e=>e?.toFixed(6)||"‚Äî"}];return t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[t.jsx("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-500 uppercase",children:"Greek"}),t.jsx("th",{className:"text-right py-2 px-3 text-xs font-semibold text-green-600 uppercase",children:"Call"}),t.jsx("th",{className:"text-right py-2 px-3 text-xs font-semibold text-red-600 uppercase",children:"Put"}),t.jsx("th",{className:"text-left py-2 px-3 text-xs font-semibold text-gray-500 uppercase",children:"Description"})]})}),t.jsx("tbody",{children:e.map((e,a)=>t.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 "+(a%2==0?"bg-gray-50/50 dark:bg-gray-800/50":""),children:[t.jsx("td",{className:"py-2.5 px-3 font-semibold",children:e.label}),t.jsx("td",{className:"py-2.5 px-3 text-right font-mono text-green-600",children:e.format(x[e.key])}),t.jsx("td",{className:"py-2.5 px-3 text-right font-mono text-red-600",children:e.format(g[e.key])}),t.jsx("td",{className:"py-2.5 px-3 text-gray-500 text-xs",children:e.desc})]},e.key))})]})})}case"signals":{const e=rt(d),a=rt(c);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"rounded-xl p-4 border-2 "+("bullish"===e.sentiment?"bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700":"bearish"===e.sentiment?"bg-red-50 border-red-300 dark:bg-red-900/20 dark:border-red-700":"bg-gray-50 border-gray-300 dark:bg-gray-800 dark:border-gray-700"),children:[t.jsx("div",{className:"text-xs font-bold uppercase tracking-wider mb-2 text-green-700 dark:text-green-400",children:"Call Signal"}),t.jsx("div",{className:"text-lg font-bold mb-1",children:e.buildUp}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.description})]}),t.jsxs("div",{className:"rounded-xl p-4 border-2 "+("bullish"===a.sentiment?"bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700":"bearish"===a.sentiment?"bg-red-50 border-red-300 dark:bg-red-900/20 dark:border-red-700":"bg-gray-50 border-gray-300 dark:bg-gray-800 dark:border-gray-700"),children:[t.jsx("div",{className:"text-xs font-bold uppercase tracking-wider mb-2 text-red-700 dark:text-red-400",children:"Put Signal"}),t.jsx("div",{className:"text-lg font-bold mb-1",children:a.buildUp}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:a.description})]})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 border border-blue-200 dark:border-blue-800",children:[t.jsx("div",{className:"text-xs font-bold uppercase tracking-wider mb-2 text-blue-700 dark:text-blue-400",children:"Combined Analysis"}),t.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:st(e,a,u)})]})]})}case"reversals":{const e=d.ltp||0,a=c.ltp||0,r=s.spot_price||s.spot||0,l=s.futures_price||s.fut_ltp||0,i=e+a,n=r+e,x=r-a,g=l>0?l:r,m=g+e,h=g-a,u=o+e,p=o-a,b=o+i,y=o-i;return s._reversalTab,t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"text-center py-2 bg-gradient-to-r from-indigo-50 via-purple-50 to-pink-50 dark:from-indigo-900/20 dark:via-purple-900/20 dark:to-pink-900/20 rounded-lg",children:[t.jsxs("h4",{className:"text-lg font-bold text-gray-900 dark:text-white",children:["Reversal For : ",o]}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Strike-Based Formula"})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-3 border border-blue-200 dark:border-blue-700",children:[t.jsx("div",{className:"text-xs font-bold text-blue-700 dark:text-blue-400 uppercase tracking-wider mb-2 flex items-center gap-1",children:"üìç SPOT"}),t.jsxs("div",{className:"space-y-1.5 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-red-600 dark:text-red-400",children:"R:"}),t.jsx("span",{className:"font-bold text-red-600",children:n.toFixed(2)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-green-600 dark:text-green-400",children:"S:"}),t.jsx("span",{className:"font-bold text-green-600",children:x.toFixed(2)})]})]})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-xl p-3 border border-purple-200 dark:border-purple-700",children:[t.jsx("div",{className:"text-xs font-bold text-purple-700 dark:text-purple-400 uppercase tracking-wider mb-2 flex items-center gap-1",children:"üìà FUTURE"}),t.jsxs("div",{className:"space-y-1.5 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-red-600 dark:text-red-400",children:"R:"}),t.jsx("span",{className:"font-bold text-red-600",children:m.toFixed(2)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-green-600 dark:text-green-400",children:"S:"}),t.jsx("span",{className:"font-bold text-green-600",children:h.toFixed(2)})]})]})]}),t.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-xl p-3 border border-amber-200 dark:border-amber-700",children:[t.jsx("div",{className:"text-xs font-bold text-amber-700 dark:text-amber-400 uppercase tracking-wider mb-2 flex items-center gap-1",children:"üíπ LTP Calc"}),t.jsxs("div",{className:"space-y-1.5 text-sm",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-red-600 dark:text-red-400",children:"R:"}),t.jsx("span",{className:"font-bold text-red-600",children:u.toFixed(2)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-green-600 dark:text-green-400",children:"S:"}),t.jsx("span",{className:"font-bold text-green-600",children:p.toFixed(2)})]})]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"bg-gradient-to-br from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20 rounded-xl p-4 border border-red-200 dark:border-red-800",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),t.jsx("span",{className:"text-sm font-bold text-red-700 dark:text-red-400 uppercase tracking-wider",children:"Resistance"})]}),t.jsx("div",{className:"text-3xl font-bold text-red-600 mb-2",children:n.toFixed(2)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Spot + CE Premium"})]}),t.jsxs("div",{className:"bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl p-4 border border-green-200 dark:border-green-800",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),t.jsx("span",{className:"text-sm font-bold text-green-700 dark:text-green-400 uppercase tracking-wider",children:"Support"})]}),t.jsx("div",{className:"text-3xl font-bold text-green-600 mb-2",children:x.toFixed(2)}),t.jsx("div",{className:"text-xs text-gray-500",children:"Spot - PE Premium"})]})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3",children:"Calculation Formula"}),t.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Base (Spot)"}),t.jsx("span",{className:"font-bold",children:r.toFixed(2)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"CE Premium"}),t.jsxs("span",{className:"font-bold text-red-600",children:["‚Çπ",e.toFixed(2)]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"PE Premium"}),t.jsxs("span",{className:"font-bold text-green-600",children:["‚Çπ",a.toFixed(2)]})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Straddle"}),t.jsxs("span",{className:"font-bold text-purple-600",children:["‚Çπ",i.toFixed(2)]})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Range Up"}),t.jsx("span",{className:"font-bold text-red-600",children:b.toFixed(2)})]}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Range Down"}),t.jsx("span",{className:"font-bold text-green-600",children:y.toFixed(2)})]})]})]})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 border border-blue-200 dark:border-blue-700",children:[t.jsx("div",{className:"text-xs font-semibold text-blue-600 uppercase tracking-wider mb-2",children:"Why 99% Accuracy?"}),t.jsxs("ul",{className:"text-xs text-gray-600 dark:text-gray-400 space-y-1",children:[t.jsx("li",{children:"‚Ä¢ Option writers defend ATM straddle levels"}),t.jsx("li",{children:"‚Ä¢ High OI creates walls of support/resistance"}),t.jsx("li",{children:"‚Ä¢ Delta hedging by market makers reinforces levels"})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 uppercase font-medium",children:"Daily Reversal"}),t.jsx("div",{className:"text-lg font-bold text-blue-700",children:s.reversal?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 uppercase font-medium",children:"Weekly Reversal"}),t.jsx("div",{className:"text-lg font-bold text-purple-700",children:s.wkly_reversal?.toFixed(2)||"‚Äî"})]}),t.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 rounded-xl p-3 text-center",children:[t.jsx("div",{className:"text-xs text-amber-600 dark:text-amber-400 uppercase font-medium",children:"Futures Reversal"}),t.jsx("div",{className:"text-lg font-bold text-amber-700",children:s.fut_reversal?.toFixed(2)||"‚Äî"})]})]})]})}case"strategies":return t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:lt(s,h,u).map((e,a)=>t.jsxs("div",{className:"rounded-xl p-4 border-2 "+("bullish"===e.type?"bg-green-50 border-green-300 dark:bg-green-900/20 dark:border-green-700":"bearish"===e.type?"bg-red-50 border-red-300 dark:bg-red-900/20 dark:border-red-700":"bg-gray-50 border-gray-300 dark:bg-gray-800 dark:border-gray-700"),children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx(te,{className:"w-5 h-5"}),t.jsx("span",{className:"font-bold",children:e.name})]}),t.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.description}),t.jsxs("div",{className:"flex gap-2 flex-wrap",children:[t.jsxs("span",{className:"px-2 py-0.5 rounded text-xs "+("Low"===e.risk?"bg-green-100 text-green-700":"Medium"===e.risk?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"),children:["Risk: ",e.risk]}),t.jsx("span",{className:"px-2 py-0.5 rounded text-xs bg-blue-100 text-blue-700",children:e.maxProfit})]})]},a))})});default:return null}})()}),t.jsx("div",{className:"px-5 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:t.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[t.jsx("span",{children:"Last updated: Just now"}),t.jsx("button",{onClick:r,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium",children:"Close"})]})})]})})]})});function rt(e){const t=e.oi_chng||e.oichng||0,a=e.change||e.p_chng||0;return t>0&&a>0?{buildUp:"Long Buildup",sentiment:"bullish",description:"Fresh buying with price up"}:t>0&&a<0?{buildUp:"Short Buildup",sentiment:"bearish",description:"Fresh selling with price down"}:t<0&&a>0?{buildUp:"Short Covering",sentiment:"bullish",description:"Shorts exiting, price rising"}:t<0&&a<0?{buildUp:"Long Unwinding",sentiment:"bearish",description:"Longs exiting, price falling"}:{buildUp:"Neutral",sentiment:"neutral",description:"No clear signal"}}function st(e,t,a){const r=parseFloat(a);let s="";return s=r>1.2?"High Put writing indicates strong support at this level. ":r<.8?"High Call writing indicates strong resistance at this level. ":"Balanced PCR suggests consolidation zone. ","bullish"===e.sentiment&&"bullish"===t.sentiment?s+="Both Call and Put sides show bullish signals - Strong upside expected.":"bearish"===e.sentiment&&"bearish"===t.sentiment?s+="Both sides show bearish signals - Downside risk elevated.":s+="Mixed signals - Wait for clarity before taking directional bets.",s}function lt(e,t,a){const r=[],s=parseFloat(a)||1;return r.push({name:"Long Straddle",description:`Buy ${e.strike}CE + ${e.strike}PE for ‚Çπ${t.toFixed(2)}`,type:"neutral",risk:"Limited",maxProfit:"Unlimited"}),s>1.2&&r.push({name:"Bull Put Spread",description:"Sell higher strike Put, buy lower strike Put",type:"bullish",risk:"Limited",maxProfit:"Limited"}),s<.8&&r.push({name:"Bear Call Spread",description:"Sell lower strike Call, buy higher strike Call",type:"bearish",risk:"Limited",maxProfit:"Limited"}),r.push({name:"Iron Condor",description:"Sell OTM Call & Put, buy further OTM for protection",type:"neutral",risk:"Limited",maxProfit:"Limited (Premium)"}),r}at.displayName="StrikeAnalysisModal",at.propTypes={isOpen:l.bool.isRequired,onClose:l.func.isRequired,strikeData:l.object,symbol:l.string};const it=e.memo(({data:e,width:a=620,height:r=220,field:s="Value"})=>{if(!e||0===e.length)return null;const l=e.map(e=>e.value),i=Math.min(...l),n=Math.max(...l),o=n-i||1,d=20,c=20,x=35,g=55,m=a-g-c,h=r-d-x,u=e.map((t,a)=>({x:g+a/(e.length-1)*m,y:d+(n-t.value)/o*h,data:t})),p=u.map((e,t)=>`${0===t?"M":"L"}${e.x},${e.y}`).join(" "),b=`M${g},${r-x} ${u.map(e=>`L${e.x},${e.y}`).join(" ")} L${a-c},${r-x} Z`,y=l[0],v=l[l.length-1],f=0!==y?((v-y)/y*100).toFixed(2):0,k=v>=y,j=k?"#10B981":"#EF4444",N=`chartGrad-${Math.random().toString(36).substr(2,9)}`,w=e=>{if(!e)return"";return new Date(e).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})},_=o/4;return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2 px-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:s}),t.jsx("span",{className:"text-lg font-bold "+(k?"text-emerald-500":"text-red-500"),children:v?.toLocaleString(void 0,{maximumFractionDigits:2})})]}),t.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-semibold "+(k?"bg-emerald-500/10 text-emerald-500":"bg-red-500/10 text-red-500"),children:[k?"‚ñ≤":"‚ñº"," ",Math.abs(f),"%"]})]}),t.jsxs("svg",{width:a,height:r,className:"mx-auto",children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:N,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[t.jsx("stop",{offset:"0%",stopColor:j,stopOpacity:"0.25"}),t.jsx("stop",{offset:"100%",stopColor:j,stopOpacity:"0.02"})]}),t.jsxs("filter",{id:"glow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[t.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),t.jsxs("feMerge",{children:[t.jsx("feMergeNode",{in:"coloredBlur"}),t.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),[...Array(5)].map((e,r)=>{const s=d+r/4*h,l=n-r*_;return t.jsxs("g",{children:[t.jsx("line",{x1:g,y1:s,x2:a-c,y2:s,stroke:"currentColor",strokeOpacity:"0.1",strokeDasharray:"4,2"}),t.jsx("text",{x:g-8,y:s+4,textAnchor:"end",className:"fill-gray-400 text-[10px]",children:l>=1e5?`${(l/1e5).toFixed(1)}L`:l.toFixed(0)})]},r)}),t.jsx("path",{d:b,fill:`url(#${N})`}),t.jsx("path",{d:p,fill:"none",stroke:j,strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",filter:"url(#glow)"}),u.filter((e,t)=>t%10==0||t===u.length-1).map((e,a)=>t.jsx("circle",{cx:e.x,cy:e.y,r:"3",fill:j,opacity:"0.7"},a)),t.jsx("circle",{cx:u[u.length-1].x,cy:u[u.length-1].y,r:"5",fill:j,className:"animate-pulse"}),e[0]?.timestamp&&t.jsxs(t.Fragment,{children:[t.jsx("text",{x:g,y:r-8,textAnchor:"start",className:"fill-gray-400 text-[10px]",children:w(e[0].timestamp)}),t.jsx("text",{x:a/2,y:r-8,textAnchor:"middle",className:"fill-gray-400 text-[10px]",children:w(e[Math.floor(e.length/2)]?.timestamp)}),t.jsx("text",{x:a-c,y:r-8,textAnchor:"end",className:"fill-gray-400 text-[10px]",children:w(e[e.length-1].timestamp)})]})]})]})});it.displayName="MiniLineChart";e.memo(({ceData:e,peData:a,dataField:r="value",width:s=600,height:l=300})=>{if(!e||!a||0===e.length)return null;const i=20,n=30,o=40,d=s-o-n,c=l-i-30,x=e=>e[r]||0,g=[...e.map(x),...a.map(x)],m=Math.min(...g),h=Math.max(...g),u=h-m||1,p=t=>t.map((t,a)=>{return`${0===a?"M":"L"} ${s=a,o+s/(e.length-1)*d} ${r=x(t),i+c-(r-m)/u*c}`;var r,s}).join(" "),b=p(e),y=p(a);return t.jsxs("svg",{width:s,height:l,className:"overflow-visible",children:[[0,.25,.5,.75,1].map(e=>{const a=i+c*e;return t.jsxs("g",{children:[t.jsx("line",{x1:o,y1:a,x2:s-n,y2:a,stroke:"#334155",strokeOpacity:"0.2",strokeDasharray:"3 3"}),t.jsx("text",{x:o-8,y:a+4,textAnchor:"end",className:"fill-gray-400 text-[10px]",children:(h-(h-m)*e).toLocaleString(void 0,{maximumFractionDigits:0})})]},e)}),t.jsx("path",{d:b,fill:"none",stroke:"#22C55E",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:y,fill:"none",stroke:"#EF4444",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsxs("g",{transform:`translate(${s-100}, 10)`,children:[t.jsx("rect",{width:"10",height:"10",fill:"#22C55E",rx:"2"}),t.jsx("text",{x:"15",y:"9",className:"text-[10px] fill-gray-500 font-medium",children:"CE"}),t.jsx("rect",{x:"40",width:"10",height:"10",fill:"#EF4444",rx:"2"}),t.jsx("text",{x:"55",y:"9",className:"text-[10px] fill-gray-500 font-medium",children:"PE"})]}),e[0]?.timestamp&&t.jsxs(t.Fragment,{children:[t.jsx("text",{x:o,y:l-5,textAnchor:"start",className:"fill-gray-400 text-[10px]",children:new Date(e[0].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.jsx("text",{x:s/2,y:l-5,textAnchor:"middle",className:"fill-gray-400 text-[10px]",children:new Date(e[Math.floor(e.length/2)].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),t.jsx("text",{x:s-n,y:l-5,textAnchor:"end",className:"fill-gray-400 text-[10px]",children:new Date(e[e.length-1].timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})}).displayName="ComparisonLineChart";const nt=e.memo(({data:e,viewType:a,width:r=620,height:s=400})=>{if(!e||0===e.length)return null;const l=[...e].sort((e,t)=>e.strike-t.strike),i=l.findIndex(e=>e.is_atm),n=l.slice(Math.max(0,i-12),Math.min(l.length,i+13));if(0===n.length)return null;const o=Math.min(14,(s-50)/n.length),d=Math.max(...n.map(e=>Math.abs(e.ce_coi||e.ce_oi||0)),1),c=Math.max(...n.map(e=>Math.abs(e.pe_coi||e.pe_oi||0)),1),x=Math.max(d,c),g=r/2,m=(r-80)/2;return t.jsxs("svg",{width:r,height:s,className:"mx-auto",children:[t.jsxs("text",{x:g-m/2,y:18,textAnchor:"middle",className:"fill-green-500 text-xs font-bold",children:["CALL ","coi"===a?"COI":"OI"]}),t.jsxs("text",{x:g+m/2,y:18,textAnchor:"middle",className:"fill-red-500 text-xs font-bold",children:["PUT ","coi"===a?"COI":"OI"]}),n.map((e,r)=>{const s=30+r*(o+3),l="coi"===a?e.ce_coi||0:e.ce_oi||0,i="coi"===a?e.pe_coi||0:e.pe_oi||0,n=Math.abs(l/x)*m,d=Math.abs(i/x)*m;return t.jsxs("g",{children:[t.jsx("rect",{x:g-25-n,y:s,width:n,height:o,fill:l>0?"#22C55E":"#166534",rx:"2",opacity:"0.85"}),t.jsx("text",{x:g,y:s+o/2+4,textAnchor:"middle",className:"text-[10px] font-bold "+(e.is_atm?"fill-yellow-400":"fill-gray-400"),children:e.strike}),t.jsx("rect",{x:g+25,y:s,width:d,height:o,fill:i>0?"#EF4444":"#991B1B",rx:"2",opacity:"0.85"}),e.is_atm&&t.jsx("rect",{x:g-20,y:s-2,width:40,height:o+4,fill:"none",stroke:"#FBBF24",strokeWidth:"1.5",rx:"4"})]},e.strike)})]})});nt.displayName="AggregateBarChart";const ot=e.memo(({data:e,width:a=600,height:r=200})=>{if(!e||0===e.length)return null;const s=[...e].sort((e,t)=>e.strike-t.strike),l=s.findIndex(e=>e.is_atm),i=s.slice(Math.max(0,l-15),Math.min(s.length,l+16));if(0===i.length)return null;const n=i.map(e=>e.pcr_oi||0),o=Math.min(...n,.5),d=Math.max(...n,2),c=d-o||1,x=30,g=30,m=50,h=a-m-g,u=r-x-40,p=x+(d-1)/c*u;return t.jsxs("svg",{width:a,height:r,className:"mx-auto",children:[t.jsx("rect",{x:m,y:x,width:h,height:p-x,fill:"#22C55E",fillOpacity:"0.1"}),t.jsx("rect",{x:m,y:p,width:h,height:u-(p-x),fill:"#EF4444",fillOpacity:"0.1"}),t.jsx("line",{x1:m,y1:p,x2:a-g,y2:p,stroke:"#6B7280",strokeDasharray:"4 4"}),t.jsx("text",{x:m-5,y:p+4,textAnchor:"end",className:"fill-gray-400 text-[10px]",children:"1.0"}),i.map((e,a)=>{const s=m+a/(i.length-1)*h,l=x+(d-(e.pcr_oi||1))/c*u,n=(e.pcr_oi||1)>1;return t.jsxs("g",{children:[t.jsx("circle",{cx:s,cy:l,r:e.is_atm?6:4,fill:n?"#22C55E":"#EF4444"}),e.is_atm&&t.jsx("text",{x:s,y:r-10,textAnchor:"middle",className:"fill-yellow-500 text-[9px] font-bold",children:"ATM"})]},e.strike)}),t.jsxs("text",{x:a-g,y:x/2,textAnchor:"end",className:"fill-green-500 text-[10px]",children:[">"," 1.0 = Bullish"]}),t.jsxs("text",{x:a-g,y:x/2+12,textAnchor:"end",className:"fill-red-500 text-[10px]",children:["<"," 1.0 = Bearish"]})]})});ot.displayName="PCRChart";const dt=[{id:"strike",label:"Strike",icon:A,description:"Time-series for selected strike"},{id:"coi",label:"COi",icon:Z,description:"Change in OI across strikes"},{id:"oi",label:"Oi",icon:A,description:"Total OI across strikes"},{id:"overall",label:"Overall",icon:A,description:"Cumulative OI/COI view"},{id:"pcr",label:"PCR",icon:Z,description:"Put-Call Ratio across strikes"},{id:"percentage",label:"%",icon:Z,description:"Percentage changes"}],ct=e.memo(({isOpen:a,onClose:r,cellData:l})=>{const[i,n]=e.useState("strike"),[o,d]=e.useState("oi"),[c,x]=e.useState(null),[g,m]=e.useState(null),[h,b]=e.useState(!1),[y,v]=e.useState(null),f=s(u),k=s(p),{strike:j,side:N,field:w,value:_,fullData:C}=l||{},S=e.useCallback(async()=>{if(f&&j&&N){b(!0),v(null);try{const e=await oe.getStrikeTimeSeries({symbol:f,strike:parseFloat(j),optionType:N.toUpperCase(),field:o,interval:"5m",limit:50});x(e)}catch(e){v(e.message||"Failed to load data"),b(!1)}}},[f,j,N,o]),I=e.useCallback(async e=>{if(f&&k){b(!0),v(null);try{let t;switch(e){case"coi":case"overall":t=await oe.getAggregateCOI({symbol:f,expiry:k});break;case"oi":t=await oe.getAggregateOI({symbol:f,expiry:k});break;case"pcr":t=await oe.getAggregatePCR({symbol:f,expiry:k});break;case"percentage":t=await oe.getAggregatePercentage({symbol:f,expiry:k});break;default:return}m(Array.isArray(t)?{data:t,summary:{}}:t)}catch(t){v(t.message||"Failed to load data")}finally{b(!1)}}},[f,k]);if(e.useEffect(()=>{a&&l&&("strike"===i?(w&&["OI","oi","oichng","ltp","iv","volume"].includes(w)&&d("OI"===w||"oichng"===w?"oi":w),S()):I(i))},[a,l,i,S,I,w]),!a||!l)return null;const F="ce"===N?"Call":"Put",V={oi:"Open Interest",ltp:"Last Traded Price",iv:"Implied Volatility",volume:"Volume",delta:"Delta",theta:"Theta"},M="ce"===N?C?.ce||{}:C?.pe||{};return t.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-modal":"true",children:[t.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:r}),t.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:t.jsxs("div",{className:"relative w-full max-w-3xl bg-white dark:bg-gray-900 rounded-2xl shadow-2xl transform transition-all overflow-hidden",children:[t.jsxs("div",{className:"relative overflow-hidden",children:[t.jsx("div",{className:"absolute inset-0 "+("ce"===N?"bg-gradient-to-r from-green-600/20 to-emerald-500/10":"bg-gradient-to-r from-red-600/20 to-rose-500/10")}),t.jsxs("div",{className:"relative flex items-center justify-between p-4 border-b border-gray-200/50 dark:border-gray-700/50",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("div",{className:"relative p-2.5 rounded-xl "+("ce"===N?"bg-green-500/20 text-green-500":"bg-red-500/20 text-red-500"),children:[t.jsx(A,{className:"w-5 h-5"}),t.jsx("div",{className:`absolute inset-0 rounded-xl ${"ce"===N?"bg-green-400":"bg-red-400"} blur-md opacity-30`})]}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[t.jsxs("span",{className:"ce"===N?"text-green-600":"text-red-600",children:[V[o]||"Data"," Pulse"]}),t.jsx("span",{className:"text-gray-400",children:"‚Äî"}),t.jsxs("span",{children:[f," ",j," ",F.toUpperCase()]})]}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:"5-minute time-series ‚Ä¢ Real-time updates"})]})]}),M.ltp&&t.jsxs("div",{className:"flex items-center gap-3 mr-8",children:[t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-xs text-gray-500",children:"LTP"}),t.jsxs("div",{className:"text-sm font-bold "+((M.change||0)>=0?"text-green-500":"text-red-500"),children:["‚Çπ",M.ltp?.toFixed(2)]})]}),t.jsxs("div",{className:"px-2 py-1 rounded text-xs font-bold "+((M.change||0)>=0?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400"),children:[(M.change||0)>=0?"+":"",M.change?.toFixed(2)||"0.00"]})]}),t.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:t.jsx(B,{className:"w-5 h-5 text-gray-500"})})]})]}),t.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700 px-2 overflow-x-auto",children:dt.map(e=>{const a=e.icon;return t.jsxs("button",{onClick:()=>n(e.id),className:"px-3 py-2.5 text-xs font-medium border-b-2 transition-colors whitespace-nowrap flex items-center gap-1 "+(i===e.id?"border-blue-500 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800"),title:e.description,children:[t.jsx(a,{className:"w-3.5 h-3.5"}),e.label]},e.id)})}),t.jsx("div",{className:"p-4",children:(()=>{if(h)return t.jsx("div",{className:"h-64 flex items-center justify-center",children:t.jsx(ae,{className:"w-8 h-8 animate-spin text-blue-500"})});if(y)return t.jsx("div",{className:"h-64 flex items-center justify-center text-red-500",children:t.jsxs("div",{className:"text-center",children:[t.jsx("p",{children:y}),t.jsx("button",{onClick:()=>"strike"===i?S():I(i),className:"mt-2 text-sm text-blue-500 hover:underline",children:"Retry"})]})});switch(i){case"strike":return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[Object.entries(V).map(([e,a])=>t.jsx("button",{onClick:()=>{d(e),S()},className:"px-3 py-1.5 rounded-lg text-xs font-medium transition-colors "+(o===e?"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300":"bg-gray-100 text-gray-600 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-400"),children:a},e)),t.jsx("button",{onClick:S,className:"p-1.5 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700",title:"Refresh",children:t.jsx(ae,{className:"w-4 h-4 text-gray-500 "+(h?"animate-spin":"")})})]}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:(()=>{const e=Array.isArray(c)?c:c?.data||[];return e&&e.length>0?t.jsx(it,{data:e,width:600,height:200}):t.jsx("div",{className:"h-52 flex items-center justify-center text-gray-400",children:"No data available"})})()}),c?.summary&&t.jsx("div",{className:"grid grid-cols-5 gap-2",children:["min","max","avg","current","change_from_start"].map(e=>t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-2 text-center",children:[t.jsx("div",{className:"text-[10px] text-gray-500 uppercase",children:"change_from_start"===e?"Change":e}),t.jsxs("div",{className:"text-sm font-semibold "+("change_from_start"===e?c.summary[e]>=0?"text-green-600":"text-red-600":""),children:["change_from_start"===e&&c.summary[e]>=0?"+":"",c.summary[e]?.toLocaleString()]})]},e))})]});case"coi":case"oi":{const e=g?.data||[],a=g?.summary||{};return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-2",children:t.jsx(nt,{data:e,viewType:i,width:620,height:400})}),t.jsxs("div",{className:"grid grid-cols-4 gap-2 text-center",children:[t.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-2",children:[t.jsx("div",{className:"text-[10px] text-green-600 uppercase",children:"Total CE"}),t.jsxs("div",{className:"text-sm font-semibold text-green-700 dark:text-green-400",children:[((a.total_ce_coi||a.total_ce_oi||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-lg p-2",children:[t.jsx("div",{className:"text-[10px] text-red-600 uppercase",children:"Total PE"}),t.jsxs("div",{className:"text-sm font-semibold text-red-700 dark:text-red-400",children:[((a.total_pe_coi||a.total_pe_oi||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-2",children:[t.jsx("div",{className:"text-[10px] text-blue-600 uppercase",children:"Net"}),t.jsxs("div",{className:"text-sm font-semibold text-blue-700 dark:text-blue-400",children:[((a.net_coi||a.net_oi||0)/1e5).toFixed(2),"L"]})]}),t.jsxs("div",{className:"rounded-lg p-2 "+("BULLISH"===a.signal?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"),children:[t.jsx("div",{className:"text-[10px] text-gray-600 uppercase",children:"Signal"}),t.jsx("div",{className:"text-sm font-bold "+("BULLISH"===a.signal?"text-green-700":"text-red-700"),children:a.signal||"NEUTRAL"})]})]})]})}case"overall":{const e=g?.data||[];return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[t.jsx(re,{className:"w-4 h-4"}),"Showing cumulative OI changes from lowest to highest strike"]}),t.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-2",children:t.jsx(nt,{data:e,viewType:"coi",width:620,height:400})})]})}case"pcr":{const e=g?.data||[],a=g?.summary||{};return t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-xl p-4",children:t.jsx(ot,{data:e,width:620,height:220})}),t.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Overall PCR (OI)"}),t.jsx("div",{className:"text-xl font-bold "+((a.overall_pcr_oi||1)>1?"text-green-600":"text-red-600"),children:a.overall_pcr_oi?.toFixed(3)||"N/A"})]}),t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 text-center",children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Overall PCR (Vol)"}),t.jsx("div",{className:"text-xl font-bold "+((a.overall_pcr_vol||1)>1?"text-green-600":"text-red-600"),children:a.overall_pcr_vol?.toFixed(3)||"N/A"})]}),t.jsxs("div",{className:"rounded-lg p-3 text-center "+("BULLISH"===a.market_sentiment?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"),children:[t.jsx("div",{className:"text-xs text-gray-500",children:"Market Sentiment"}),t.jsx("div",{className:"text-lg font-bold "+("BULLISH"===a.market_sentiment?"text-green-700":"text-red-700"),children:a.market_sentiment||"NEUTRAL"})]})]})]})}case"percentage":{const e=g?.data?.slice(0,20)||[];return t.jsx("div",{className:"space-y-4",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-xs",children:[t.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 text-left",children:"Strike"}),t.jsx("th",{className:"p-2 text-right text-green-600",children:"CE OI %"}),t.jsx("th",{className:"p-2 text-right text-red-600",children:"PE OI %"}),t.jsx("th",{className:"p-2 text-right text-green-600",children:"CE LTP %"}),t.jsx("th",{className:"p-2 text-right text-red-600",children:"PE LTP %"})]})}),t.jsx("tbody",{children:e.map(e=>t.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 "+(e.is_atm?"bg-yellow-50 dark:bg-yellow-900/20":""),children:[t.jsx("td",{className:"p-2 font-medium "+(e.is_atm?"text-yellow-600":""),children:e.strike}),t.jsxs("td",{className:"p-2 text-right "+((e.ce_oi_pct||0)>=0?"text-green-600":"text-red-600"),children:[(e.ce_oi_pct||0)>=0?"+":"",(e.ce_oi_pct||0).toFixed(1),"%"]}),t.jsxs("td",{className:"p-2 text-right "+((e.pe_oi_pct||0)>=0?"text-green-600":"text-red-600"),children:[(e.pe_oi_pct||0)>=0?"+":"",(e.pe_oi_pct||0).toFixed(1),"%"]}),t.jsxs("td",{className:"p-2 text-right "+((e.ce_ltp_pct||0)>=0?"text-green-600":"text-red-600"),children:[(e.ce_ltp_pct||0)>=0?"+":"",(e.ce_ltp_pct||0).toFixed(1),"%"]}),t.jsxs("td",{className:"p-2 text-right "+((e.pe_ltp_pct||0)>=0?"text-green-600":"text-red-600"),children:[(e.pe_ltp_pct||0)>=0?"+":"",(e.pe_ltp_pct||0).toFixed(1),"%"]})]},e.strike))})]})})})}default:return null}})()}),t.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[t.jsx("span",{className:"text-xs text-gray-400",children:dt.find(e=>e.id===i)?.description}),t.jsx("button",{onClick:r,className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors text-sm font-medium",children:"Close"})]})]})})]})});ct.displayName="CellDetailModal",ct.propTypes={isOpen:l.bool.isRequired,onClose:l.func.isRequired,cellData:l.shape({strike:l.number,side:l.string,field:l.string,value:l.any,symbol:l.string,sid:l.number,fullData:l.object})};const xt=e.memo(({isOpen:a,onClose:r,columnType:l,initialTab:i})=>{const n=()=>i||("oi_chng"===l?"coi":"oi"===l?"oi":"volume"===l?"volume":"coi"),[o,d]=e.useState(n()),[c,x]=e.useState(new Date),g=e.useMemo(()=>V(30),[]),m=s(g),h=s(b),y=s(M),v=s(u);s(p),e.useEffect(()=>{a&&x(new Date)},[a,h]);const{chartData:f,totals:k,config:j}=e.useMemo(()=>{if(!m||!h?.oc)return{chartData:[],totals:{},config:{}};const e={coi:{label:"Change in OI",ceKey:"oichng",peKey:"oichng",format:e=>Math.abs(e)>=1e7?`${(e/1e7).toFixed(2)}Cr`:Math.abs(e)>=1e5?`${(e/1e5).toFixed(2)}L`:Math.abs(e)>=1e3?`${(e/1e3).toFixed(1)}K`:e.toLocaleString("en-IN"),color:{ce:"#F97316",pe:"#22C55E"},showSign:!0},oi:{label:"Open Interest",ceKey:"OI",peKey:"OI",format:e=>e>=1e7?`${(e/1e7).toFixed(2)}Cr`:e>=1e5?`${(e/1e5).toFixed(2)}L`:`${(e/1e3).toFixed(1)}K`,color:{ce:"#EF4444",pe:"#10B981"}},volume:{label:"Volume",ceKey:"volume",peKey:"volume",format:e=>e>=1e7?`${(e/1e7).toFixed(2)}Cr`:e>=1e5?`${(e/1e5).toFixed(2)}L`:`${(e/1e3).toFixed(1)}K`,color:{ce:"#EC4899",pe:"#14B8A6"}},pcr:{label:"Put-Call Ratio",ceKey:"OI",peKey:"OI",format:e=>e?.toFixed(3)||"‚Äî",color:{ce:"#6366F1",pe:"#8B5CF6"}},percent:{label:"OI Change %",ceKey:"oichng",peKey:"oichng",format:e=>`${e?.toFixed(1)}%`,color:{ce:"#F59E0B",pe:"#84CC16"}}},t=e[o]||e.coi;let a=0,r=0;return{chartData:m.map(e=>{const s=e.toString(),l=h.oc[s]||h.oc[`${e}.000000`]||{},i=l.ce||{},n=l.pe||{};let d=i[t.ceKey]||i.oi||0,c=n[t.peKey]||n.oi||0;if("percent"===o){const e=i.OI||i.oi||1,t=n.OI||n.oi||1,a=i.oichng||0,r=n.oichng||0;d=a/(e-a)*100||0,c=r/(t-r)*100||0}return a+=Math.abs(d),r+=Math.abs(c),{strike:e,ceValue:d,peValue:c,ceOI:i.OI||i.oi||0,peOI:n.OI||n.oi||0,isATM:Math.abs(e-y)<.01}}).filter(e=>0!==e.ceValue||0!==e.peValue||"pcr"===o),totals:{ce:a,pe:r,net:r-a,pcr:a>0?r/a:0},config:t}},[m,h,y,o]),N=e.useMemo(()=>"pcr"===o?3:Math.max(...f.flatMap(e=>[Math.abs(e.ceValue),Math.abs(e.peValue)]),1),[f,o]);if(e.useEffect(()=>{d(n())},[l]),!a)return null;const w="pcr"===o?k.pcr>1.2?{text:"BULLISH",color:"text-green-600 bg-green-100"}:k.pcr<.8?{text:"BEARISH",color:"text-red-600 bg-red-100"}:{text:"NEUTRAL",color:"text-gray-600 bg-gray-100"}:k.pe>k.ce?{text:"BULLISH",color:"text-green-600 bg-green-100"}:{text:"BEARISH",color:"text-red-600 bg-red-100"};return t.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto","aria-modal":"true",children:[t.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm",onClick:r}),t.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:t.jsxs("div",{className:"relative w-full max-w-5xl bg-white dark:bg-gray-900 rounded-2xl shadow-2xl overflow-hidden",children:[t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/20 via-purple-500/15 to-indigo-500/20"}),t.jsxs("div",{className:"relative flex items-center justify-between p-4 border-b border-gray-200/50 dark:border-gray-700/50",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("div",{className:"p-2.5 rounded-xl bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg",children:t.jsx(A,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:[j.label||"Aggregate Data"," ‚Äî ",v]}),t.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:[t.jsx(se,{className:"w-3 h-3"}),t.jsxs("span",{children:["Updated: ",c.toLocaleTimeString("en-IN")]})]})]})]}),t.jsx("div",{className:`px-3 py-1.5 rounded-full text-sm font-bold ${w.color}`,children:w.text}),t.jsx("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:t.jsx(B,{className:"w-6 h-6 text-gray-500"})})]})]}),t.jsx("div",{className:"flex border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:[{id:"coi",label:"Total COi",icon:"üìà"},{id:"oi",label:"Total Oi",icon:"üìä"},{id:"volume",label:"Total Vol",icon:"üìâ"},{id:"pcr",label:"PCR",icon:"‚öñÔ∏è"},{id:"percent",label:"%",icon:"üìê"}].map(e=>t.jsxs("button",{onClick:()=>d(e.id),className:"flex-1 px-4 py-3 text-sm font-medium transition-all relative "+(o===e.id?"text-blue-600 dark:text-blue-400 bg-white dark:bg-gray-900":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700"),children:[t.jsx("span",{className:"mr-1.5",children:e.icon}),e.label,o===e.id&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 dark:bg-blue-400"})]},e.id))}),t.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-gray-50 dark:bg-gray-800/30",children:[t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"text-xs text-red-600 dark:text-red-400 font-medium mb-1",children:"Total CE"}),t.jsx("div",{className:"text-2xl font-bold text-red-600",children:j.format(k.ce)})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"text-xs text-green-600 dark:text-green-400 font-medium mb-1",children:"Total PE"}),t.jsx("div",{className:"text-2xl font-bold text-green-600",children:j.format(k.pe)})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 font-medium mb-1",children:"Net"}),t.jsxs("div",{className:"text-2xl font-bold "+(k.net>0?"text-green-600":"text-red-600"),children:[k.net>0?"+":"",j.format(k.net)]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-4 shadow-sm border border-gray-200 dark:border-gray-700",children:[t.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium mb-1",children:"PCR"}),t.jsx("div",{className:"text-2xl font-bold "+(k.pcr>1?"text-green-600":"text-red-600"),children:k.pcr.toFixed(3)})]})]}),t.jsxs("div",{className:"p-5 max-h-[50vh] overflow-y-auto",children:["pcr"===o?t.jsx("div",{className:"space-y-1",children:f.map(e=>{const a=e.ceOI>0?e.peOI/e.ceOI:0,r=Math.min(a/3*100,100),s=a>1.2?"#22C55E":a<.8?"#EF4444":"#6B7280";return t.jsxs("div",{className:"flex items-center gap-3 py-1.5 px-2 rounded "+(e.isATM?"bg-yellow-50 dark:bg-yellow-900/20 ring-1 ring-yellow-400":""),children:[t.jsx("div",{className:"w-20 text-sm font-bold "+(e.isATM?"text-yellow-600":"text-gray-700 dark:text-gray-300"),children:e.strike}),t.jsx("div",{className:"flex-1 h-6 bg-gray-100 dark:bg-gray-800 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all duration-300 flex items-center justify-end pr-2",style:{width:`${r}%`,backgroundColor:s},children:t.jsx("span",{className:"text-[10px] font-bold text-white",children:a.toFixed(2)})})}),t.jsx("div",{className:"w-16 text-xs font-medium text-right "+(a>1.2?"text-green-600":a<.8?"text-red-600":"text-gray-500"),children:a>1.2?"Bullish":a<.8?"Bearish":"Neutral"})]},e.strike)})}):t.jsx("div",{className:"space-y-1",children:f.map(e=>t.jsxs("div",{className:"flex items-center gap-2 py-1 rounded "+(e.isATM?"bg-yellow-50 dark:bg-yellow-900/20 ring-1 ring-yellow-400":""),children:[t.jsx("div",{className:"flex-1 flex justify-end",children:t.jsxs("div",{className:"relative w-full flex items-center justify-end",children:[t.jsx("div",{className:"h-5 rounded-l transition-all duration-300",style:{width:Math.abs(e.ceValue)/N*100+"%",backgroundColor:j.color?.ce||"#EF4444",minWidth:0!==e.ceValue?"4px":"0"}}),Math.abs(e.ceValue)>.1*N&&t.jsxs("span",{className:"absolute right-2 text-[10px] font-bold text-white",children:[j.showSign&&e.ceValue>0?"+":"",j.format(e.ceValue)]})]})}),t.jsxs("div",{className:"w-20 text-center text-sm font-bold "+(e.isATM?"text-yellow-600 dark:text-yellow-400":"text-gray-700 dark:text-gray-300"),children:[e.strike,e.isATM&&t.jsx("span",{className:"text-[8px] block",children:"ATM"})]}),t.jsx("div",{className:"flex-1 flex justify-start",children:t.jsxs("div",{className:"relative w-full flex items-center",children:[t.jsx("div",{className:"h-5 rounded-r transition-all duration-300",style:{width:Math.abs(e.peValue)/N*100+"%",backgroundColor:j.color?.pe||"#10B981",minWidth:0!==e.peValue?"4px":"0"}}),Math.abs(e.peValue)>.1*N&&t.jsxs("span",{className:"absolute left-2 text-[10px] font-bold text-white",children:[j.showSign&&e.peValue>0?"+":"",j.format(e.peValue)]})]})})]},e.strike))}),"pcr"!==o&&t.jsxs("div",{className:"flex justify-center gap-8 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:j.color?.ce||"#EF4444"}}),t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"CALL"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:j.color?.pe||"#10B981"}}),t.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"PUT"})]})]})]}),t.jsx("div",{className:"px-5 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:[f.length," strikes displayed"]}),t.jsx("button",{onClick:r,className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium text-sm",children:"Close"})]})})]})})]})});xt.displayName="AggregateChartModal",xt.propTypes={isOpen:l.bool.isRequired,onClose:l.func.isRequired,columnType:l.oneOf(["oi","oi_chng","volume","ltp"]),initialTab:l.oneOf(["coi","oi","volume","pcr","percent"])};const gt=e=>{if(null==e)return"‚Äî";if(0===e)return"0";const t=Math.abs(e),a=e<0?"-":"";return t>=1e12?a+(t/1e12).toFixed(2)+"T":t>=1e9?a+(t/1e9).toFixed(2)+"B":t>=1e6?a+(t/1e6).toFixed(2)+"M":t>=1e3?a+(t/1e3).toFixed(1)+"K":a+t.toFixed(0)},mt=(e,t)=>{if(!e?.oc||!t||0===t.length)return null;const a={ce:{oi:0,oiChg:0,volume:0,ltpSum:0,premiumSum:0,delta:0,gamma:0,theta:0,vega:0,iv:0,ivCount:0},pe:{oi:0,oiChg:0,volume:0,ltpSum:0,premiumSum:0,delta:0,gamma:0,theta:0,vega:0,iv:0,ivCount:0}};return t.forEach(t=>{const r=t.toString(),s=e.oc[r]||e.oc[`${t}.000000`]||{};if(s.ce){const e=s.ce;a.ce.oi+=e.OI||e.oi||0,a.ce.oiChg+=e.oichng||0,a.ce.volume+=e.volume||0,a.ce.ltpSum+=e.ltp||0,a.ce.premiumSum+=(e.ltp||0)*(e.OI||e.oi||0),e.optgeeks&&(a.ce.delta+=e.optgeeks.delta||0,a.ce.gamma+=e.optgeeks.gamma||0,a.ce.theta+=e.optgeeks.theta||0,a.ce.vega+=e.optgeeks.vega||0),e.iv>0&&(a.ce.iv+=e.iv,a.ce.ivCount++)}if(s.pe){const e=s.pe;a.pe.oi+=e.OI||e.oi||0,a.pe.oiChg+=e.oichng||0,a.pe.volume+=e.volume||0,a.pe.ltpSum+=e.ltp||0,a.pe.premiumSum+=(e.ltp||0)*(e.OI||e.oi||0),e.optgeeks&&(a.pe.delta+=e.optgeeks.delta||0,a.pe.gamma+=e.optgeeks.gamma||0,a.pe.theta+=e.optgeeks.theta||0,a.pe.vega+=e.optgeeks.vega||0),e.iv>0&&(a.pe.iv+=e.iv,a.pe.ivCount++)}}),a.ce.avgIv=a.ce.ivCount>0?a.ce.iv/a.ce.ivCount:0,a.pe.avgIv=a.pe.ivCount>0?a.pe.iv/a.pe.ivCount:0,a.pcr=a.ce.oi>0?a.pe.oi/a.ce.oi:0,a.pcrChg=0!==a.ce.oiChg?a.pe.oiChg/a.ce.oiChg:0,a.volPcr=a.ce.volume>0?a.pe.volume/a.ce.volume:0,a.netDelta=a.ce.delta+a.pe.delta,a.netGamma=a.ce.gamma+a.pe.gamma,a.netTheta=a.ce.theta+a.pe.theta,a.netVega=a.ce.vega+a.pe.vega,a},ht=e.memo(({label:e,ceValue:a,peValue:r,netValue:s,format:l="number",highlight:i=!1})=>{const n=e=>{return"currency"===l?null==(t=e)?"‚Äî":"‚Çπ"+gt(t):"decimal"===l?e?.toFixed(2)||"‚Äî":"greek"===l?e?.toFixed(4)||"‚Äî":gt(e);var t};return t.jsxs("div",{className:"p-2 rounded-lg "+(i?"bg-blue-50 dark:bg-blue-900/20":"bg-gray-50 dark:bg-gray-800/50"),children:[t.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-medium mb-1",children:e}),t.jsxs("div",{className:"flex items-center justify-between gap-2 text-sm",children:[t.jsx("span",{className:"text-red-600 dark:text-red-400 font-medium",title:"CALLS",children:n(a)}),t.jsx("span",{className:"text-gray-400",children:"|"}),t.jsx("span",{className:"text-green-600 dark:text-green-400 font-medium",title:"PUTS",children:n(r)})]}),void 0!==s&&t.jsxs("div",{className:"text-xs text-center text-gray-600 dark:text-gray-400 mt-0.5",children:["Net: ",n(s)]})]})});ht.displayName="MetricCard";const ut=e.memo(({value:e,label:a})=>{return t.jsxs("div",{className:"flex flex-col items-center p-2 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[t.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-medium",children:a}),t.jsx("div",{className:"mt-1 px-2 py-0.5 rounded font-bold text-sm "+(r=e,r&&0!==r?r>1.2?"bg-green-200 text-green-800 dark:bg-green-900/50 dark:text-green-300":r>.8?"bg-yellow-200 text-yellow-800 dark:bg-yellow-900/50 dark:text-yellow-300":"bg-red-200 text-red-800 dark:bg-red-900/50 dark:text-red-300":"bg-gray-200 text-gray-600"),children:e>0?e.toFixed(2):"‚Äî"})]});var r});ut.displayName="PCRBadge";const pt=e.memo(({visibleStrikes:a})=>{const[r,l]=e.useState(!1),[i,n]=e.useState("visible"),o=s(b),d=s(M),c=e.useMemo(()=>o?.oc?Object.keys(o.oc).map(e=>parseFloat(e)).filter(e=>!isNaN(e)).sort((e,t)=>e-t):[],[o]),x=e.useMemo(()=>mt(o,a),[o,a]),g=e.useMemo(()=>mt(o,c),[o,c]),m="visible"===i?x:g,h="visible"===i?a?.length||0:c.length;return m?t.jsxs("div",{className:"mt-2 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm",children:[t.jsxs("div",{className:"flex items-center justify-between px-4 py-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50",onClick:()=>l(!r),children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300",children:"üìä Aggregate Summary"}),t.jsxs("span",{className:"text-xs text-gray-500",children:["(",h," strikes)"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("div",{className:"flex items-center bg-gray-100 dark:bg-gray-800 rounded-lg p-0.5",children:[t.jsxs("button",{onClick:e=>{e.stopPropagation(),n("visible")},className:"px-2 py-1 text-xs rounded-md flex items-center gap-1 transition-colors "+("visible"===i?"bg-white dark:bg-gray-700 text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"),children:[t.jsx(q,{className:"w-3 h-3"}),"Visible"]}),t.jsxs("button",{onClick:e=>{e.stopPropagation(),n("all")},className:"px-2 py-1 text-xs rounded-md flex items-center gap-1 transition-colors "+("all"===i?"bg-white dark:bg-gray-700 text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"),children:[t.jsx(le,{className:"w-3 h-3"}),"All"]})]}),r?t.jsx(ie,{className:"w-4 h-4 text-gray-400"}):t.jsx(ne,{className:"w-4 h-4 text-gray-400"})]})]}),r&&t.jsxs("div",{className:"px-4 pb-3 border-t border-gray-100 dark:border-gray-800",children:[t.jsxs("div",{className:"grid grid-cols-3 gap-2 py-2",children:[t.jsx(ut,{value:m.pcr,label:"OI PCR"}),t.jsx(ut,{value:m.pcrChg,label:"OI Chg PCR"}),t.jsx(ut,{value:m.volPcr,label:"Vol PCR"})]}),t.jsxs("div",{className:"grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2 mt-2",children:[t.jsx(ht,{label:"Total OI",ceValue:m.ce.oi,peValue:m.pe.oi,highlight:!0}),t.jsx(ht,{label:"OI Change",ceValue:m.ce.oiChg,peValue:m.pe.oiChg}),t.jsx(ht,{label:"Volume",ceValue:m.ce.volume,peValue:m.pe.volume}),t.jsx(ht,{label:"LTP Sum",ceValue:m.ce.ltpSum,peValue:m.pe.ltpSum,format:"currency"}),t.jsx(ht,{label:"Avg IV",ceValue:m.ce.avgIv,peValue:m.pe.avgIv,format:"decimal"}),t.jsx(ht,{label:"Net Delta",ceValue:m.ce.delta,peValue:m.pe.delta,netValue:m.netDelta,format:"greek"}),t.jsx(ht,{label:"Net Theta",ceValue:m.ce.theta,peValue:m.pe.theta,netValue:m.netTheta,format:"greek"}),t.jsx(ht,{label:"Net Gamma",ceValue:m.ce.gamma,peValue:m.pe.gamma,netValue:m.netGamma,format:"greek"})]}),t.jsxs("div",{className:"grid grid-cols-4 gap-2 mt-2",children:[t.jsx(ht,{label:"Premium (CE)",ceValue:m.ce.premiumSum,peValue:null,format:"currency"}),t.jsx(ht,{label:"Premium (PE)",ceValue:null,peValue:m.pe.premiumSum,format:"currency"}),t.jsx(ht,{label:"Net Vega",ceValue:m.ce.vega,peValue:m.pe.vega,netValue:m.netVega,format:"greek"}),t.jsxs("div",{className:"p-2 rounded-lg bg-gray-50 dark:bg-gray-800/50",children:[t.jsx("div",{className:"text-[10px] text-gray-500 uppercase font-medium",children:"ATM Strike"}),t.jsx("div",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:d||"‚Äî"})]})]})]})]}):null});pt.displayName="AggregatePanel";const bt=({showControls:a=!0})=>{const{spotData:r,futuresData:l,data:i,isLoading:n,isInitialLoad:o,hasData:d}=ke(),{settings:c,selectStrike:x}=ve(),[g,m]=e.useState(c.strikesPerPage||21),[h,p]=e.useState(null),[y,v]=e.useState(null),[f,k]=e.useState(null),[j,N]=e.useState(null),w=s(u),_=e.useMemo(()=>V(g),[g]),C=s(_),S=s(M),I=s(b),F=e.useMemo(()=>{if(!C||0===C.length)return[];const e=[...C];return"asc"===c.sortOrder?e.sort((e,t)=>e-t):e.sort((e,t)=>t-e)},[C,c.sortOrder]),L=((t,a,r)=>e.useMemo(()=>{if(!t||0===t.length||!a?.oc)return{};const e={};return t.forEach(t=>{e[t]={}}),Ne.forEach(s=>{je.forEach(l=>{const i=we(t,a,r,l,s),n=`${s}_${l}`;Object.entries(i).forEach(([t,a])=>{e[t]&&(e[t][n]=a)})})}),e},[t,a,r]))(F,I,S),O=e.useCallback(e=>{p(e)},[]),P=e.useCallback(()=>{p(null)},[]),T=e.useCallback(e=>{v(e),x(e?.strike)},[x]),R=e.useCallback(()=>{v(null),x(null)},[x]),E=e.useCallback(e=>{k(e)},[]),$=e.useCallback(()=>{k(null)},[]),D=e.useCallback(e=>{N(e)},[]),B=e.useCallback(()=>{N(null)},[]),A=i?.pcr,G=i?.max_pain_strike,W=r?.ltp;return o&&!d?t.jsx("div",{className:"flex h-96 items-center justify-center",children:t.jsx(xe,{size:"xl",showLabel:!0,label:"Loading Option Chain..."})}):t.jsxs("div",{className:"w-full space-y-1",children:[a&&t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx(qe,{}),t.jsx(We,{spotData:r,futuresData:l,pcr:A,maxPain:G}),t.jsx("div",{className:"flex-1"}),t.jsx(et,{})]}),t.jsxs(de,{className:"overflow-hidden",padding:"none",children:[t.jsxs("div",{className:"relative overflow-auto scrollbar-hide",style:{maxHeight:"calc(100vh - 100px)"},children:[t.jsx(ze,{spotData:r,futuresData:l,strikes:F,rowHeight:c.compactMode?51:80,headerHeight:28}),t.jsxs("table",{className:"w-full text-sm text-left border-collapse min-w-max",children:[t.jsx(Oe,{onColumnClick:D}),t.jsxs("tbody",{className:"divide-y divide-gray-100 dark:divide-gray-800 bg-white dark:bg-gray-900",children:[F.map(e=>{const a=e.toString(),r=I?.oc?.[a]||I?.oc?.[`${e}.000000`]||{};return t.jsx(Ae,{strike:e,data:r,atmStrike:S,spotPrice:W,onCellClick:O,onStrikeSelect:T,onStrikeClick:E,highlightData:L[e]},e)}),0===F.length&&!n&&t.jsx("tr",{children:t.jsx("td",{colSpan:"20",className:"p-8 text-center text-gray-500",children:"No data available for selected expiration"})})]})]})]}),t.jsxs("div",{className:"p-2 border-t border-gray-100 dark:border-gray-800 flex items-center justify-between bg-gray-50 dark:bg-gray-800/50",children:[t.jsx("span",{className:"text-xs text-gray-400",children:n&&t.jsx("span",{className:"animate-pulse text-blue-500",children:"‚óè Live"})}),t.jsx(ce,{variant:"ghost",onClick:()=>{m(e=>e+20)},size:"sm",children:"+ More Strikes"})]})]}),t.jsx(pt,{visibleStrikes:F}),y&&t.jsx(tt,{strikeData:y,onClose:R}),t.jsx(ct,{isOpen:!!h,onClose:P,cellData:h}),t.jsx(at,{isOpen:!!f,onClose:$,strikeData:f,symbol:w}),t.jsx(xt,{isOpen:!!j,onClose:B,columnType:j})]})},yt=e=>new Date(1e3*e).toLocaleString("en-IN",{timeZone:"Asia/Kolkata",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}),vt=(e,t)=>{let a;return function(...r){a||(e.apply(this,r),a=!0,setTimeout(()=>a=!1,t))}},ft=({symbols:a,currentSymbol:r,onSelect:s,theme:l})=>{const[n,o]=e.useState(!1),[d,c]=e.useState(""),[x,g]=e.useState(0),[m,h]=e.useState({top:0,left:0}),u=e.useRef(null),p=e.useRef(null),b=e.useRef(null),y=e.useMemo(()=>{const e=[],t=[];return a.forEach(a=>{["NIFTY","BANKNIFTY","FINNIFTY","MIDCPNIFTY","SENSEX","BANKEX","NIFTYNXT50"].includes(a.symbol)?e.push(a):t.push(a)}),{indices:e,equities:t}},[a]),v=e.useMemo(()=>{const e=d.toLowerCase();return{indices:y.indices.filter(t=>t.symbol.toLowerCase().includes(e)||(t.name||"").toLowerCase().includes(e)),equities:y.equities.filter(t=>t.symbol.toLowerCase().includes(e)||(t.name||"").toLowerCase().includes(e))}},[y,d]),f=e.useMemo(()=>[...v.indices,...v.equities],[v]),k=()=>{if(p.current){const e=p.current.getBoundingClientRect();h({top:e.bottom+8,left:e.left})}o(!0)};e.useEffect(()=>{const e=e=>{u.current&&!u.current.contains(e.target)&&o(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),e.useEffect(()=>{n&&b.current&&b.current.focus()},[n]);const j=e=>{s(e),o(!1),c("")},N="dark"===l;return t.jsxs("div",{ref:u,className:"relative",onKeyDown:e=>{if(n)switch(e.key){case"ArrowDown":g(e=>Math.min(e+1,f.length-1)),e.preventDefault();break;case"ArrowUp":g(e=>Math.max(e-1,0)),e.preventDefault();break;case"Enter":f[x]&&(s(f[x]),o(!1),c("")),e.preventDefault();break;case"Escape":o(!1),c("")}else"Enter"!==e.key&&"ArrowDown"!==e.key||(k(),e.preventDefault())},children:[t.jsxs("button",{ref:p,onClick:()=>n?o(!1):k(),className:`\n          flex items-center gap-2 px-3 py-1.5 rounded-lg border\n          font-semibold text-xs transition-all duration-200 min-w-[120px]\n          ${N?"bg-gray-800 border-gray-700 text-white hover:bg-gray-700":"bg-white border-gray-200 text-gray-900 hover:bg-gray-50"}\n          ${n?N?"ring-1 ring-blue-500":"ring-1 ring-blue-400":""}\n        `,children:[t.jsx("span",{className:"font-bold",children:r?.symbol||"Select"}),t.jsx("svg",{className:`w-3 h-3 ml-auto transition-transform ${n?"rotate-180":""} ${N?"text-gray-400":"text-gray-500"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&i.createPortal(t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[2147483646]",onClick:()=>o(!1)}),t.jsxs("div",{className:`\n              fixed w-72 max-h-80 rounded-xl border shadow-2xl z-[2147483647]\n              overflow-hidden\n              ${N?"bg-gray-900 border-gray-700":"bg-white border-gray-200"}\n            `,style:{top:m.top,left:m.left},children:[t.jsx("div",{className:"p-2 border-b "+(N?"border-gray-700":"border-gray-100"),children:t.jsxs("div",{className:"relative",children:[t.jsx("svg",{className:"absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 "+(N?"text-gray-500":"text-gray-400"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),t.jsx("input",{ref:b,type:"text",placeholder:"Search...",value:d,onChange:e=>{c(e.target.value),g(0)},className:`\n                    w-full pl-8 pr-3 py-1.5 rounded-lg text-xs\n                    focus:outline-none focus:ring-1 transition-all\n                    ${N?"bg-gray-800 text-white placeholder-gray-500 focus:ring-blue-500":"bg-gray-100 text-gray-900 placeholder-gray-400 focus:ring-blue-400"}\n                  `})]})}),t.jsxs("div",{className:"overflow-y-auto max-h-64 p-1",children:[v.indices.length>0&&t.jsxs("div",{className:"mb-1",children:[t.jsx("div",{className:"px-2 py-1 text-[10px] font-semibold uppercase "+(N?"text-blue-400":"text-blue-600"),children:"Indices"}),v.indices.map((e,a)=>t.jsx(kt,{symbol:e,isSelected:r?.symbol===e.symbol,isHighlighted:x===a,onClick:()=>j(e),isDark:N},e.symbol))]}),v.equities.length>0&&t.jsxs("div",{children:[t.jsx("div",{className:"px-2 py-1 text-[10px] font-semibold uppercase "+(N?"text-emerald-400":"text-emerald-600"),children:"Equities"}),v.equities.map((e,a)=>t.jsx(kt,{symbol:e,isSelected:r?.symbol===e.symbol,isHighlighted:x===v.indices.length+a,onClick:()=>j(e),isDark:N},e.symbol))]}),0===f.length&&t.jsx("div",{className:"text-center py-4 text-xs "+(N?"text-gray-500":"text-gray-400"),children:"No symbols found"})]})]})]}),document.getElementById("dropdown-root")||document.body)]})},kt=({symbol:e,isSelected:a,isHighlighted:r,onClick:s,isDark:l})=>t.jsxs("button",{onClick:s,className:`\n        w-full flex items-center gap-2 px-2 py-1.5 rounded-lg text-left text-xs\n        transition-all duration-100\n        ${a?l?"bg-blue-600 text-white":"bg-blue-500 text-white":r?l?"bg-gray-800":"bg-gray-100":l?"hover:bg-gray-800":"hover:bg-gray-50"}\n      `,children:[t.jsx("div",{className:"flex-1 min-w-0",children:t.jsx("div",{className:"font-semibold "+(a?"text-white":l?"text-gray-200":"text-gray-800"),children:e.symbol})}),a&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]}),jt=x.memo(({embedded:a=!1})=>{const l=r(),i=s(e=>e.theme.theme),n=e.useMemo(()=>({background:"dark"===i?"bg-slate-900":"bg-white",text:"dark"===i?"#e2e8f0":"#334155",gridColor:"dark"===i?"rgba(255, 255, 255, 0.06)":"rgba(0, 0, 0, 0.06)",supportColor:"dark"===i?"#38bdf8":"#0ea5e9",resistanceColor:"dark"===i?"#fbbf24":"#f59e0b",nearersupportColor:"dark"===i?"#4ade80":"#22c55e",nearerresistanceColor:"dark"===i?"#f87171":"#ef4444"}),[i]),o=e.useMemo(()=>({layout:{background:{color:"dark"===i?"#0f172a":"#ffffff"},textColor:"dark"===i?"#94a3b8":"#475569"},grid:{vertLines:{color:n.gridColor},horzLines:{color:n.gridColor}},crosshair:{mode:1},rightPriceScale:{borderColor:"dark"===i?"#1e293b":"#e2e8f0",scaleMargins:{top:.1,bottom:.1}},timeScale:{borderColor:"dark"===i?"#1e293b":"#e2e8f0",timeVisible:!0,secondsVisible:!1,rightBarStaysOnScroll:!0,barSpacing:12,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!0,rightOffset:12,visible:!0}}),[i,n.gridColor]),d=e.useMemo(()=>({upColor:"#10b981",downColor:"#f43f5e",borderVisible:!1,wickUpColor:"#10b981",wickDownColor:"#f43f5e"}),[]),c=e.useRef(null),x=e.useRef(null),g=e.useRef(null),m=e.useRef(new Map),h=e.useRef(null),[u,p]=e.useState({open:0,high:0,low:0,close:0,time:""}),[b,y]=e.useState(!1),[v,f]=e.useState(!1),[k,j]=e.useState(""),[N,w]=e.useState(null),[_,C]=e.useState(!1),[I,F]=e.useState(null),[V,M]=e.useState([]),[D,B]=e.useState("reversal"),[A,G]=e.useState(!0),{symbols:W,currentSymbol:U,timeframe:z,connectionStatus:H,daily:q,weekly:K,avg:Y}=s(e=>e.chart),{sid:J}=s(e=>e.data),Z=s(e=>e.data?.data?.options?.data),X=Z?.oc,Q=u?.close,ee="CRUDEOIL"===J,te=e.useMemo(()=>[{value:"15S",label:"15s"},{value:"1",label:"1min"},{value:"2",label:"2min"},{value:"3",label:"3min"},{value:"5",label:"5min"},{value:"10",label:"10min"},{value:"15",label:"15min"},{value:"30",label:"30min"},{value:"60",label:"1H"},{value:"D",label:"Daily"}],[]),ae=e.useMemo(()=>X&&Q?((e,t)=>{if(!e||"object"!=typeof e)return{support_1:null,support_2:null,support_1_1:null,support_1_2:null,support_2_1:null,support_2_2:null,resistance_1:null,resistance_2:null,resistance_1_1:null,resistance_1_2:null,resistance_2_1:null,resistance_2_2:null};const a=Object.keys(e).filter(e=>/^\d+$/.test(e)).map(Number).sort((e,t)=>e-t);if(0===a.length)return{support_1:null,support_2:null,support_1_1:null,support_1_2:null,support_2_1:null,support_2_2:null,resistance_1:null,resistance_2:null,resistance_1_1:null,resistance_1_2:null,resistance_2_1:null,resistance_2_2:null};const r=a.filter(e=>e<=t),s=a.filter(e=>e>t),l=(t,a)=>{if(!t.length)return null;const r=a(t);if(r<0||r>=t.length)return null;const s=t[r];return e[s]||null};return{support_1:l(r,e=>e.length-1)?.reversal,support_2:l(r,e=>e.length-1)?.wkly_reversal,support_1_1:l(r,e=>e.length-2)?.reversal,support_1_2:l(r,e=>e.length-3)?.reversal,support_2_1:l(r,e=>e.length-2)?.wkly_reversal,support_2_2:l(r,e=>e.length-3)?.wkly_reversal,resistance_1:l(s,e=>0)?.reversal,resistance_2:l(s,e=>0)?.wkly_reversal,resistance_1_1:l(s,e=>1)?.reversal,resistance_1_2:l(s,e=>2)?.reversal,resistance_2_1:l(s,e=>1)?.wkly_reversal,resistance_2_2:l(s,e=>2)?.wkly_reversal,support_avg:((l(r,e=>e.length-1)?.reversal??0)+(l(r,e=>e.length-1)?.wkly_reversal??0))/2,support_1_1_avg:((l(r,e=>e.length-2)?.reversal??0)+(l(r,e=>e.length-2)?.wkly_reversal??0))/2,support_1_2_avg:((l(r,e=>e.length-3)?.reversal??0)+(l(r,e=>e.length-3)?.wkly_reversal??0))/2,resistance_avg:((l(s,e=>0)?.reversal??0)+(l(s,e=>0)?.wkly_reversal??0))/2,resistance_1_1_avg:((l(s,e=>1)?.reversal??0)+(l(s,e=>1)?.wkly_reversal??0))/2,resistance_1_2_avg:((l(s,e=>2)?.reversal??0)+(l(s,e=>2)?.wkly_reversal??0))/2}})(X,Q):null,[X,Q,ee]),re=e.useCallback(e=>{if(!g.current||!e)return;m.current.forEach(e=>{try{g.current.removePriceLine(e)}catch(t){}}),m.current.clear();((e,t,a,r)=>{const s=[{key:"support_1",title:"S1",color:r.nearersupportColor},{key:"support_1_1",title:"S1.1",color:r.supportColor},{key:"support_1_2",title:"S1.2",color:r.supportColor},{key:"resistance_1",title:"R1",color:r.nearerresistanceColor},{key:"resistance_1_1",title:"R1.1",color:r.resistanceColor},{key:"resistance_1_2",title:"R1.2",color:r.resistanceColor}],l=[{key:"support_2",title:"S2",color:r.nearersupportColor},{key:"support_2_1",title:"S2.1",color:r.supportColor},{key:"support_2_2",title:"S2.2",color:r.supportColor},{key:"resistance_2",title:"R2",color:r.nearerresistanceColor},{key:"resistance_2_1",title:"R2.1",color:r.resistanceColor},{key:"resistance_2_2",title:"R2.2",color:r.resistanceColor}];return[...e?s:[],...t?l:[],...a?[{key:"support_avg",title:"S-Avg",color:"#a855f7"},{key:"support_1_1_avg",title:"S1.1-Avg",color:"#c084fc"},{key:"support_1_2_avg",title:"S1.2-Avg",color:"#c084fc"},{key:"resistance_avg",title:"R-Avg",color:"#f97316"},{key:"resistance_1_1_avg",title:"R1.1-Avg",color:"#fb923c"},{key:"resistance_1_2_avg",title:"R1.2-Avg",color:"#fb923c"}]:[]]})(q,K,Y,n).forEach(t=>{const a=e[t.key];if(null!=a&&!isNaN(parseFloat(a)))try{const e=t.key.includes("support"),r=["support_1","support_2","resistance_1","resistance_2"].includes(t.key),s=g.current.createPriceLine({price:parseFloat(a),color:t.color,lineWidth:2,lineStyle:r?ge.Solid:ge.Dashed,axisLabelVisible:!0,axisLabelBackgroundColor:e?"#002B36":"#360000",axisLabelTextColor:"#FFFFFF",axisLabelBorderColor:t.color,title:t.title});m.current.set(t.key,s)}catch(r){}})},[q,K,Y,n]);e.useEffect(()=>{x.current&&x.current.applyOptions(o),g.current&&g.current.applyOptions(d)},[o,d]),e.useEffect(()=>{ae&&g.current&&"connected"===H&&re(ae)},[q,K,Y,ae,H,re]),e.useEffect(()=>{if(c.current&&!x.current)try{const e=me(c.current,{...o,width:c.current.clientWidth,height:window.innerHeight-180,handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:!0,mouseWheel:!0,pinch:!0},timeScale:{...o.timeScale},localization:{timeFormatter:e=>new Date(1e3*e).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit",hour12:!1,timeZone:"Asia/Kolkata"}),dateFormatter:e=>new Date(1e3*e).toLocaleDateString("en-IN",{day:"2-digit",month:"short",timeZone:"Asia/Kolkata"})}}),t=e.addSeries(he,d);x.current=e,g.current=t;const a=vt(e=>{if(e.time){const a=e.seriesData.get(t);a&&p({open:a.open?.toFixed(2)||0,high:a.high?.toFixed(2)||0,low:a.low?.toFixed(2)||0,close:a.close?.toFixed(2)||0,time:yt(e.time)})}},16);e.subscribeCrosshairMove(a);const r=new ResizeObserver(t=>{if(0===t.length||!t[0].target)return;const a=t[0].contentRect;e.applyOptions({width:a.width,height:a.height})});r.observe(c.current);const s=m.current;return()=>{r.disconnect(),x.current&&(x.current.remove(),x.current=null,g.current=null),s.clear()}}catch(e){l(L("error"))}},[]);const se=e.useCallback(async()=>{try{const e=(await oe.getSymbols()).data||[];l(S(e)),e.length>0&&!U&&l(O(e[0]))}catch{const e=[{symbol:"NIFTY",name:"NIFTY 50"}];l(S(e)),U||l(O(e[0]))}},[l,U]);e.useEffect(()=>{0===W.length&&se()},[W.length,se]);const le=J||U?.symbol||"NIFTY";e.useEffect(()=>{if(!g.current)return;const e=async()=>{l(L("loading"));try{const e=await oe.getChartData({symbol:le,interval:z,days:30});if(e.success&&e.candles?.length>0){const t=e.candles.map(e=>({time:e.time,open:e.open,high:e.high,low:e.low,close:e.close})).sort((e,t)=>e.time-t.time);if(g.current&&t.length>0){g.current.setData(t);const e=t[t.length-1];p({open:e.open.toFixed(2),high:e.high.toFixed(2),low:e.low.toFixed(2),close:e.close.toFixed(2),time:yt(e.time)}),w(e.close),l($(t)),l(L("connected"))}}else l(L("error"))}catch{l(L("error"))}};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[le,z,l]);const ie=e.useCallback(e=>l(P(e)),[l]),ne=e.useCallback(e=>l(T(e)),[l]),de=e.useCallback(e=>l(R(e)),[l]),ce=e.useCallback(()=>{k&&parseInt(k)>0&&(l(E(k)),y(!1),j(""))},[k,l]),xe=e.useMemo(()=>({container:"dark"===i?"bg-gray-900 text-white":"bg-white text-gray-900",toolbar:"dark"===i?"bg-gray-800 border-gray-700":"bg-gray-100 border-gray-300",select:"dark"===i?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900 border-gray-300",button:"dark"===i?"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300 hover:text-gray-900",activeButton:"dark"===i?"bg-blue-600 text-white":"bg-blue-500 text-white",modal:"dark"===i?"bg-gray-800 border-gray-700":"bg-white border-gray-300",input:"dark"===i?"bg-gray-700 text-white border-gray-600":"bg-white text-gray-900 border-gray-300",chart:"dark"===i?"bg-gray-900":"bg-white"}),[i]),ue={none:{title:"Select a Profile",formula:"‚Äî",logic:"Choose a profile from the dropdown to overlay market structure analysis on the chart.",visual:"No overlay active.",signal:"Start with 'OI' for positioning or 'Reversal' for key levels."},oi:{title:"Smart OI (Liquidity Weighted)",formula:"SmartOI = OI √ó (1 + Volume/MaxVolume)",logic:"Open Interest weighted by today's trading activity. Strikes with high OI but zero volume (ghost positions) are dimmed. Active battles are boosted.",visual:"üî¥ Red Bar = Call OI (Resistance). üü¢ Green Bar = Put OI (Support). SINGLE BAR = >60% dominance (strong level). SPLIT BARS = contested zone (weak).",signal:"Trade: Large single-color bars are hard walls. If price approaches, fade the move. Split bars indicate indecision‚Äîwait for clarity."},volume:{title:"Smart Volume (IV Weighted)",formula:"SmartVol = Volume √ó (IV/AvgIV)",logic:"Volume weighted by Implied Volatility. High IV trades indicate fear/greed (conviction). Low IV trades are often hedging/arbitrage (noise).",visual:"üî¥ Red = Call Volume (Bearish Pressure). üü¢ Green = Put Volume (Bullish Pressure). Taller bars = higher conviction.",signal:"Trade: Look for tall single-color bars at key levels. High conviction at resistance = potential breakout. Split bars = no clear directional bet."},oi_change:{title:"Smart Flow (Volume Weighted)",formula:"SmartFlow = OI_Change √ó (1 + Volume/MaxVolume)",logic:"Net change in positions, weighted by volume. Separates 'real money' moves from low-volume noise. Handles unwinding (negative values) correctly.",visual:"üî¥ Red = Calls building (bearish bets). üü¢ Green = Puts building (bullish bets). Negative values (unwinding) shown with dashed borders.",signal:"Trade: Follow the flow. Growing green bars = bullish accumulation. Growing red = bearish accumulation. Shrinking bars = profit-taking/trend exhaustion."},reversal:{title:"Smart Reversal Zones",formula:"Strength = (OI√ó0.7 + Vol√ó0.3) √ó GammaMult √ó IVMult",logic:"Auto-detects high-probability reversal points using weighted OI+Volume, boosted by Gamma (hedging pressure) and IV (market fear). Levels are clustered within 0.1% to reduce noise. Statistical filtering removes weak signals.",visual:"üî¥ Red = Resistance Zone. üü¢ Green = Support Zone. SOLID (Tier 1) = Statistical outlier (>1.5œÉ). FADED = Normal level. SINGLE BAR = >60% dominance.",signal:"Trade: At Tier 1 Red zones, look for puts/shorts. At Tier 1 Green zones, look for calls/longs. Fade the move when price touches these levels."},delta:{title:"Delta Exposure",formula:"Raw CE Delta vs PE Delta",logic:"Net directional risk at each strike. Shows how much the market moves with (+) or against (-) price movement. Uses raw delta values with dominance filtering.",visual:"üî¥ Red = Call Delta (bearish-leaning). üü¢ Green = Put Delta (bullish-leaning). SINGLE BAR = one side heavily dominant.",signal:"Trade: High delta levels indicate strong directional bias. If price goes against accumulated delta, expect violent mean reversion."},gamma:{title:"Gamma Exposure",formula:"Raw CE Gamma vs PE Gamma",logic:"Acceleration risk. High gamma = price magnet effect. Market makers must hedge aggressively as price approaches, creating pinning behavior.",visual:"üî¥ Red = Call Gamma. üü¢ Green = Put Gamma. Large bars = strong pinning zones.",signal:"Trade: High gamma strikes act as magnets. Price tends to stick here during expiry. Good for range-bound strategies (Iron Condors)."},gex:{title:"Smart Exposure (True Risk)",formula:"TrueRisk = (OI √ó |Delta|) + (OI √ó |Gamma| √ó Spot √ó 0.01)",logic:"Combined Delta + Gamma risk. Delta shows current exposure; Gamma shows acceleration if price moves 1%. This is the 'pain point' where Market Makers are most vulnerable.",visual:"üî¥ Red = Call-side risk (resistance). üü¢ Green = Put-side risk (support). SINGLE BAR = clear one-sided risk.",signal:"Trade: These are the 'breakout trigger' levels. If price crosses a large GEX bar, expect acceleration as MMs are forced to hedge."},iv_skew:{title:"Smart Skew (OI Weighted)",formula:"SmartSkew = (CE_IV - PE_IV) √ó (StrikeOI/MaxOI)",logic:"Difference between Call IV and Put IV, weighted by liquidity (OI). Removes noise from illiquid strikes. Positive skew = calls more expensive (bearish fear). Negative = puts more expensive (bullish FOMO).",visual:"üî¥ Red = Call Skew (bearish sentiment). üü¢ Green = Put Skew (bullish sentiment). Large bars = high conviction sentiment.",signal:"Trade: Extreme skew often precedes reversals. Heavy call skew at highs = potential top. Heavy put skew at lows = potential bottom."},pcr:{title:"PCR Sentiment",formula:"PCR = PE_OI / CE_OI (normalized 0.3-3.0)",logic:"Put-Call Ratio per strike. >1 = more put writing (support). <1 = more call writing (resistance). Visualizes the bull/bear balance at each level.",visual:"üî¥ Red = Bearish (PCR < 1, call-heavy). üü¢ Green = Bullish (PCR > 1, put-heavy).",signal:"Trade: Green bars are floors (puts written = support). Red bars are ceilings. Extreme readings often mark exhaustion."},oi_strength:{title:"OI Strength (Position + Momentum)",formula:"Strength = (OI √ó |Delta|) + (OI_Change √ó 2)",logic:"Combines position size (OI weighted by Delta) with recent momentum (OI Change with 2x multiplier). Highlights 'heavy' strikes with fresh activity.",visual:"üî¥ Red = Call strength. üü¢ Green = Put strength. Large bars = significant positioned + active strikes.",signal:"Trade: Use for trend confirmation. Increasing strength in trend direction = healthy trend. Divergence = potential reversal."},composite:{title:"Composite Score (Master Index)",formula:"Score = OI(30%) + OI_Chng(25%) + Vol(20%) + Delta(15%) + Gamma(10%)",logic:"Weighted combination of all major metrics. OI for positioning, OI Change for flow, Volume for activity, Delta for direction, Gamma for pinning. The 'God View' metric.",visual:"üî¥ Red = Bearish composite. üü¢ Green = Bullish composite. SINGLE BAR = strong consensus. SPLIT = conflicting signals.",signal:"Trade: Use as final filter. If composite aligns with your trade direction, confidence is higher. Divergence = wait for clarity."},vega:{title:"Vega Exposure",formula:"VegaExp = OI √ó |Vega|",logic:"Sensitivity to volatility changes. High Vega strikes will see large P&L swings when IV changes. Important before events (earnings, expiry).",visual:"üî¥ Red = Call Vega. üü¢ Green = Put Vega. Large bars = high volatility sensitivity.",signal:"Trade: Avoid buying options at high-vega strikes if you expect IV crush. Sellers can target these for premium decay."},theta:{title:"Theta Decay (Time Burn)",formula:"ThetaExp = |Theta| √ó OI",logic:"Daily premium decay at each strike. Shows where option sellers are harvesting time value. Price often gravitates here to 'burn' premium.",visual:"üî¥ Red = Call Theta decay. üü¢ Green = Put Theta decay. Large bars = heavy time decay zones.",signal:"Trade: The 'Burn Zone'. Price often drifts toward high-theta areas during low-volatility periods. Good reference for Iron Condors."},delta_oi:{title:"Delta-Weighted OI",formula:"Œî√óOI = OI √ó |Delta|",logic:"Position size weighted by probability of being ITM. Higher delta = higher probability. This shows where 'real' money exposure sits.",visual:"üî¥ Red = Call exposure. üü¢ Green = Put exposure. Large bars = significant directional bets.",signal:"Trade: These are the 'smart money' levels. Large delta-weighted OI indicates institutional positioning."}},pe=e=>ue[e]||ue.composite,be=e.useMemo(()=>{if(!X||"none"===D)return null;const e=Object.keys(X);let t=[],a=0,r=0,s=null,l=0;const i=e.map(e=>{const t=X[e],a=parseFloat(e),r=t.ce||{},s=t.pe||{};return{strikeStr:e,strike:a,ce_oi:r.OI||r.oi||0,pe_oi:s.OI||s.oi||0,ce_oi_chng:r.oichng||r.oi_change||0,pe_oi_chng:s.oichng||s.oi_change||0,ce_vol:r.volume||r.vol||0,pe_vol:s.volume||s.vol||0,ce_delta:r.optgeeks?.delta||r.delta||0,pe_delta:s.optgeeks?.delta||s.delta||0,ce_gamma:r.optgeeks?.gamma||r.gamma||0,pe_gamma:s.optgeeks?.gamma||s.gamma||0,ce_theta:r.optgeeks?.theta||r.theta||0,pe_theta:s.optgeeks?.theta||s.theta||0,ce_vega:r.optgeeks?.vega||r.vega||0,pe_vega:s.optgeeks?.vega||s.vega||0,ce_iv:r.iv||r.IV||r.impliedVolatility||0,pe_iv:s.iv||s.IV||s.impliedVolatility||0,ce_ltp:r.ltp||0,pe_ltp:s.ltp||0,reversal:t.reversal||0,wkly_reversal:t.wkly_reversal||0,fut_reversal:t.fut_reversal||0}}),n=(e,t)=>{const a=Math.abs(e),r=Math.abs(t),s=a+r;if(0===s)return{ceVal:0,peVal:0,total:0,opacity:.5};const l=Math.max(a,r)/s>.6;let i=a,n=r;l&&(a>r?(i=s,n=0):(i=0,n=s));return{ceVal:i,peVal:n,total:s,opacity:l?.9:.5}},o=Q||Math.min(...i.map(e=>e.ce_ltp+e.pe_ltp))>0?i.reduce((e,t)=>t.ce_ltp+t.pe_ltp<e?.ce_ltp+e?.pe_ltp&&t.ce_ltp+t.pe_ltp>0?t:e,i[0])?.strike:null,d=Math.max(...i.map(e=>Math.max(e.ce_vol,e.pe_vol,1))),c=i.reduce((e,t)=>e+t.ce_iv+t.pe_iv,0)/(2*i.length||1),x=c>0?c:1,g=Q||0;if(i.forEach(e=>{let c=0,m=0,h=0,u=null;switch(D){case"oi":{const t=e.ce_oi*(1+e.ce_vol/d),a=e.pe_oi*(1+e.pe_vol/d);({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(t,a));break}case"volume":{const t=e.ce_vol*(e.ce_iv/x),a=e.pe_vol*(e.pe_iv/x);({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(t,a));break}case"oi_change":{const t=e.ce_oi_chng*(1+e.ce_vol/d),a=e.pe_oi_chng*(1+e.pe_vol/d),{ceVal:r,peVal:s,total:l,opacity:i}=n(Math.abs(t),Math.abs(a));c=t<0?-r:r,m=a<0?-s:s,h=l,e.opacity=i;break}case"delta":({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(e.ce_delta,e.pe_delta));break;case"gamma":({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(e.ce_gamma,e.pe_gamma));break;case"gex":{const t=e.ce_oi*Math.abs(e.ce_delta)+e.ce_oi*Math.abs(e.ce_gamma)*g*.01,a=e.pe_oi*Math.abs(e.pe_delta)+e.pe_oi*Math.abs(e.pe_gamma)*g*.01;({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(t,a)),u=t-a;break}case"delta_oi":{const t=e.ce_oi*Math.abs(e.ce_delta),a=e.pe_oi*Math.abs(e.pe_delta);({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(t,a));break}case"iv_skew":{const t=(e.ce_oi+e.pe_oi)/(Math.max(...i.map(e=>e.ce_oi+e.pe_oi))||1),a=(e.ce_iv-e.pe_iv)*t,r=a>0?a:0,s=a<0?Math.abs(a):0;({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(r,s)),u=a;break}case"pcr":{const t=e.ce_oi>0?e.pe_oi/e.ce_oi:0,a=Math.min(Math.max(t,.3),3),r=a<1?1-a:0,s=a>1?a-1:0;({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(r,s)),u=t;break}case"oi_strength":{const t=e.ce_oi*Math.abs(e.ce_delta)+2*e.ce_oi_chng,a=e.pe_oi*Math.abs(e.pe_delta)+2*e.pe_oi_chng;({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(Math.max(0,t),Math.max(0,a)));break}case"composite":{const t=e.ce_oi,a=e.pe_oi,r=Math.abs(e.ce_oi_chng),s=Math.abs(e.pe_oi_chng),l=e.ce_vol,i=e.pe_vol,o=100*Math.abs(e.ce_delta),d=100*Math.abs(e.pe_delta),x=.3*t+.25*r+.2*l+.15*o+.1*(1e4*e.ce_gamma),g=.3*a+.25*s+.2*i+.15*d+.1*(1e4*e.pe_gamma);({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(x,g));break}case"reversal":{const a=1+50*Math.abs(e.ce_gamma||0),r=1+50*Math.abs(e.pe_gamma||0),s=1+(e.ce_iv||0)/100,l=1+(e.pe_iv||0)/100,i=(.7*e.ce_oi+.3*e.ce_vol)*a*s,n=(.7*e.pe_oi+.3*e.pe_vol)*r*l;return void[{val:parseFloat(e.reversal),label:"Intraday"},{val:parseFloat(e.wkly_reversal),label:"Weekly"},{val:parseFloat(e.fut_reversal),label:"Future"}].filter(e=>e.val&&e.val>0&&!isNaN(e.val)).forEach(a=>{const r=o?a.val>o:a.val>e.strike,s=r?i:n;t.push({strike:a.val,total:s,ceVal:r?s:0,peVal:r?0:s,singleVal:s,rawCeStrength:i,rawPeStrength:n,isResistanceRaw:r,isRawReversal:!0,reversalType:a.label,metrics:{gamma:r?e.ce_gamma:e.pe_gamma,iv:r?e.ce_iv:e.pe_iv}})})}case"vega":({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(e.ce_oi*Math.abs(e.ce_vega),e.pe_oi*Math.abs(e.pe_vega)));break;case"theta":({ceVal:c,peVal:m,total:h,opacity:e.opacity}=n(Math.abs(e.ce_theta*e.ce_oi),Math.abs(e.pe_theta*e.pe_oi)));break;default:return}const p=Math.max(Math.abs(c),Math.abs(m));r=Math.max(r,p),a+=h,h>l&&(l=h,s=e.strikeStr),t.push({strike:e.strikeStr,total:h,ceVal:c,peVal:m,singleVal:u,raw:e,opacity:e.opacity})}),"reversal"===D&&t.length>0){t.sort((e,t)=>e.strike-t.strike);const e=[],i=.001*(o||t[0].strike);let n=null;if(t.forEach(t=>{if(n){const a=n.weightedSum/n.totalStrength;Math.abs(t.strike-a)<i?(n.totalStrength+=t.total,n.ceSum+=t.rawCeStrength||t.ceVal,n.peSum+=t.rawPeStrength||t.peVal,n.weightedSum+=t.strike*t.total,n.points.push(t)):(e.push(n),n={totalStrength:t.total,ceSum:t.rawCeStrength||t.ceVal,peSum:t.rawPeStrength||t.peVal,weightedSum:t.strike*t.total,points:[t]})}else n={totalStrength:t.total,ceSum:t.rawCeStrength||t.ceVal,peSum:t.rawPeStrength||t.peVal,weightedSum:t.strike*t.total,points:[t]}}),n&&e.push(n),e.length>0){const a=e.map(e=>e.totalStrength),r=Math.max(...a),s=a.reduce((e,t)=>e+t,0)/a.length,l=a.reduce((e,t)=>e+Math.pow(t-s,2),0)/a.length,i=Math.sqrt(l),n=Z?.meta;let d;d=A&&n?.recommended_threshold?n.recommended_threshold:Math.max(.05*r,.5*s);const c=e.filter(e=>e.totalStrength>d);o&&o>100||t[0].strike,t=c.map(e=>{const t=e.weightedSum/e.totalStrength,a=e.ceSum>=e.peSum,l=Math.max(e.ceSum,e.peSum)/e.totalStrength>.6;let o;o=A&&n?.std_dev?e.totalStrength>n.noise_floor+2*n.std_dev:e.totalStrength>s+1.5*i||e.totalStrength>.8*r,l||(o=!1);const d=o?1:l?.65:.4;return{strike:t,total:e.totalStrength,ceVal:l?a?e.totalStrength:0:e.ceSum,peVal:l?a?0:e.totalStrength:e.peSum,singleVal:e.totalStrength,isCluster:!0,clusterCount:e.points.length,confidenceTier:o?1:2,opacity:d,isDominant:l}})}else t=[];if(t.length>0){r=Math.max(...t.map(e=>e.total)),a=t.reduce((e,t)=>e+t.total,0);const e=t.reduce((e,t)=>t.total>e.total?t:e,t[0]);s=e.strike.toString(),l=e.total}}if(0===r)return null;const m=[...t].sort((e,t)=>t.total-e.total),h=.7*a;let u=0;const p=new Set;for(const b of m)if(u+=b.total,p.add(b.strike),u>=h)break;return{dataPoints:t,maxVal:r,pocStrike:s,vaStrikes:p,meta:{oi:{name:"Smart OI (Liquidity)",ceLabel:"CE Liq",peLabel:"PE Liq"},volume:{name:"Smart Volume (Conviction)",ceLabel:"CE Conv",peLabel:"PE Conv"},oi_change:{name:"Smart Flow (Vol. Wgt)",ceLabel:"CE Flow",peLabel:"PE Flow",showSign:!0},delta:{name:"Delta",ceLabel:"CE Œî",peLabel:"PE Œî"},gamma:{name:"Gamma",ceLabel:"CE Œì",peLabel:"PE Œì"},gex:{name:"Smart Exposure (Risk)",ceLabel:"CE Risk",peLabel:"PE Risk",showNet:!0},delta_oi:{name:"Delta-Weighted OI",ceLabel:"CE Œî√óOI",peLabel:"PE Œî√óOI"},iv_skew:{name:"Smart Skew (OI Wgt)",ceLabel:"CE IV‚Üë",peLabel:"PE IV‚Üë",showNet:!0},pcr:{name:"PCR Sentiment",ceLabel:"Bearish",peLabel:"Bullish",showRatio:!0},oi_strength:{name:"OI Strength",ceLabel:"CE Str",peLabel:"PE Str"},composite:{name:"Composite",ceLabel:"CE Score",peLabel:"PE Score"},reversal:{name:"Reversal Zones",ceLabel:"Resist. Str",peLabel:"Support Str"},vega:{name:"Vega Exposure",ceLabel:"CE Vega",peLabel:"PE Vega"},theta:{name:"Theta Decay",ceLabel:"CE Œò",peLabel:"PE Œò"}}[D]}},[X,D,Q]);return e.useEffect(()=>{const e=h.current;if(!(e&&x.current&&g.current&&be)){if(e){e.getContext("2d").clearRect(0,0,e.width,e.height)}return}const t=e.getContext("2d",{alpha:!0}),a=g.current,{dataPoints:r,maxVal:s,pocStrike:l,vaStrikes:i}=be;let n=null,o=0;const d=c=>{if(c-o<16)return void(n=requestAnimationFrame(d));if(o=c,!e||!a)return;const x=e.parentElement.getBoundingClientRect(),g=window.devicePixelRatio||1,m=Math.floor(x.width*g),h=Math.floor(x.height*g);e.width===m&&e.height===h||(e.width=m,e.height=h,e.style.width=`${x.width}px`,e.style.height=`${x.height}px`),t.setTransform(g,0,0,g,0,0),t.clearRect(0,0,x.width,x.height);const u=x.width-65,p=.4*(x.width-65),b=239,y=68,v=68,f=34,k=197,j=94,N="#FACC15";t.lineCap="round",t.lineJoin="round";const w=[];r.forEach(e=>{const t=parseFloat(e.strike),r=a.priceToCoordinate(t);if(null===r||r<0||r>x.height)return;const n=i.has(e.strike),o=e.strike===l,d=Math.abs(e.ceVal)/s*p,c=Math.abs(e.peVal)/s*p;w.push({y:r,ceWidth:d,peWidth:c,isVA:n,isPOC:o,ceUnwinding:"oi_change"===D&&e.ceVal<0,peUnwinding:"oi_change"===D&&e.peVal<0,customColor:e.color,opacity:e.opacity})}),w.forEach(({y:e,ceWidth:a,peWidth:r,isVA:s,ceUnwinding:l,peUnwinding:i,customColor:n,opacity:o})=>{const d=s?.6:.25,c={opacity:o};if(a>.5){const r=c.opacity||d;if(n)t.fillStyle=n;else if(l)t.fillStyle=`rgba(${b}, ${y}, ${v}, ${.4*r})`;else{const e=t.createLinearGradient(u-a,0,u,0);e.addColorStop(0,`rgba(${b}, ${y}, ${v}, ${.3*r})`),e.addColorStop(1,`rgba(${b}, ${y}, ${v}, ${r})`),t.fillStyle=e}t.beginPath(),t.roundRect(u-a,e-5-1,a,5,2),t.fill()}if(r>.5){const a=c.opacity||d;if(n)t.fillStyle=n;else if(i)t.fillStyle=`rgba(${f}, ${k}, ${j}, ${.4*a})`;else{const e=t.createLinearGradient(u-r,0,u,0);e.addColorStop(0,`rgba(${f}, ${k}, ${j}, ${.3*a})`),e.addColorStop(1,`rgba(${f}, ${k}, ${j}, ${a})`),t.fillStyle=e}t.beginPath(),t.roundRect(u-r,e+1,r,5,2),t.fill()}}),t.lineWidth=1,w.forEach(({y:e,ceWidth:a,peWidth:r,isVA:s,ceUnwinding:l,peUnwinding:i})=>{const n=s?.8:.4;l&&a>.5&&(t.strokeStyle=`rgba(${b}, ${y}, ${v}, ${n})`,t.beginPath(),t.roundRect(u-a,e-5-1,a,5,2),t.stroke()),i&&r>.5&&(t.strokeStyle=`rgba(${f}, ${k}, ${j}, ${n})`,t.beginPath(),t.roundRect(u-r,e+1,r,5,2),t.stroke())}),t.lineWidth=2,t.strokeStyle=N,t.shadowColor=N,t.shadowBlur=6,w.filter(e=>e.isPOC).forEach(({y:e,ceWidth:a,peWidth:r})=>{t.beginPath(),t.moveTo(u-Math.max(a,r)-10,e),t.lineTo(u+5,e),t.stroke(),t.shadowBlur=0,t.font="bold 10px Inter, system-ui, sans-serif",t.fillStyle=N,t.textAlign="right",t.fillText("POC",u-Math.max(a,r)-14,e+3)}),t.shadowBlur=0};n=requestAnimationFrame(d);const c=x.current.timeScale(),m=vt(()=>{n&&cancelAnimationFrame(n),n=requestAnimationFrame(d)},32);c.subscribeVisibleLogicalRangeChange(m);const u=new ResizeObserver(((e,t)=>{let a;return function(...r){clearTimeout(a),a=setTimeout(()=>{clearTimeout(a),e(...r)},t)}})(()=>{n&&cancelAnimationFrame(n),n=requestAnimationFrame(d)},100));return e.parentElement&&u.observe(e.parentElement),()=>{n&&cancelAnimationFrame(n),c.unsubscribeVisibleLogicalRangeChange(m),u.disconnect()}},[be,D]),e.useEffect(()=>{if(!x.current||!g.current)return;const e=x.current,t=e=>{if("hline"!==I||!e.point)return;const t=g.current,a=t.coordinateToPrice(e.point.y);if(null!==a){const e=t.createPriceLine({price:a,color:"dark"===i?"#60a5fa":"#2563eb",lineWidth:2,lineStyle:ge.Solid,axisLabelVisible:!0,title:"Level",draggable:!0});M(t=>[...t,e])}};return e.subscribeClick(t),()=>{e.unsubscribeClick(t)}},[I,i]),t.jsxs("div",{className:`${a?"h-full":"h-screen"} font-sans flex flex-col relative ${xe.container} ${_?"fixed inset-0 z-50 bg-inherit":""}`,children:[t.jsxs("div",{className:`absolute ${a?"top-12":"top-20"} left-4 z-10 px-3 py-1 rounded-md shadow-sm border text-xs flex flex-wrap items-center gap-x-3 gap-y-1 ${"dark"===i?"bg-gray-800/90 border-gray-700 text-gray-300":"bg-white/90 border-gray-200 text-gray-700"}`,children:[t.jsxs("span",{className:"font-semibold",children:[U?.symbol||"Loading..."," (",te.find(e=>e.value===z)?.label||z,")"]}),N&&t.jsx("span",{className:"font-semibold "+("dark"===i?"text-green-400":"text-green-600"),children:N.toFixed(2)}),t.jsxs("span",{children:["O: ",t.jsx("span",{className:"dark"===i?"text-white":"text-gray-900",children:u.open})]}),t.jsxs("span",{children:["H: ",t.jsx("span",{className:"dark"===i?"text-green-400":"text-green-600",children:u.high})]}),t.jsxs("span",{children:["L: ",t.jsx("span",{className:"dark"===i?"text-red-400":"text-red-600",children:u.low})]}),t.jsxs("span",{children:["C: ",t.jsx("span",{className:"dark"===i?"text-white":"text-gray-900",children:u.close})]}),u.time&&t.jsxs("span",{className:"text-[10px] opacity-70 ml-1",children:["(",u.time," IST)"]})]}),b&&t.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20",children:t.jsxs("div",{className:`p-6 rounded-lg border ${xe.modal}`,children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Custom Timeframe"}),t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("input",{type:"number",placeholder:"Enter minutes",value:k,onChange:e=>j(e.target.value),className:`px-3 py-2 rounded border focus:outline-none focus:ring-2 focus:ring-blue-500 ${xe.input}`}),t.jsx("span",{className:"self-center "+("dark"===i?"text-gray-400":"text-gray-600"),children:"minutes"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:ce,className:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors",children:"Apply"}),t.jsx("button",{onClick:()=>{y(!1),j("")},className:"px-4 py-2 rounded transition-colors "+("dark"===i?"bg-gray-600 text-white hover:bg-gray-700":"bg-gray-300 text-gray-700 hover:bg-gray-400"),children:"Cancel"})]})]})}),t.jsxs("div",{className:"relative z-[100] flex items-center gap-1.5 px-2 py-1.5 border-b backdrop-blur-sm "+("dark"===i?"bg-gray-900/95 border-gray-800":"bg-white/95 border-gray-200"),children:[!a&&t.jsxs("div",{className:"flex items-center gap-2 pr-2 border-r border-gray-700/30",children:[t.jsx(ft,{symbols:W,currentSymbol:U,onSelect:e=>l(O(e)),theme:i}),N&&t.jsx("span",{className:"text-sm font-bold tabular-nums "+("dark"===i?"text-emerald-400":"text-emerald-600"),children:N.toFixed(2)})]}),t.jsxs("div",{className:"flex items-center gap-0.5 px-1",children:[te.slice(0,6).map(e=>t.jsx("button",{onClick:()=>l(E(e.value)),className:"px-2 py-1 text-[11px] font-medium rounded transition-all "+(z===e.value?"dark"===i?"bg-blue-600 text-white":"bg-blue-500 text-white":"dark"===i?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:e.label},e.value)),t.jsxs("div",{className:"relative",children:[t.jsx("button",{onClick:()=>f(!v),className:"px-2 py-1 text-[11px] font-medium rounded transition-all "+(te.slice(6).some(e=>e.value===z)?"dark"===i?"bg-blue-600 text-white":"bg-blue-500 text-white":"dark"===i?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-500 hover:text-gray-900 hover:bg-gray-100"),children:te.slice(6).some(e=>e.value===z)?te.find(e=>e.value===z)?.label:"+"}),v&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"fixed inset-0 z-[2147483646]",onClick:()=>f(!1)}),t.jsxs("div",{className:"absolute top-full right-0 mt-1 py-1 rounded-lg shadow-xl border z-[2147483647] min-w-[100px] "+("dark"===i?"bg-gray-900 border-gray-700":"bg-white border-gray-200"),children:[te.slice(6).map(e=>t.jsx("button",{onClick:()=>{l(E(e.value)),f(!1)},className:"block w-full px-3 py-1.5 text-xs text-left whitespace-nowrap "+(z===e.value?"dark"===i?"bg-blue-600 text-white":"bg-blue-500 text-white":"dark"===i?"text-gray-300 hover:bg-gray-800":"text-gray-700 hover:bg-gray-100"),children:e.label},e.value)),t.jsx("div",{className:"border-t my-1 "+("dark"===i?"border-gray-700":"border-gray-200")}),t.jsx("button",{onClick:()=>{y(!0),f(!1)},className:"block w-full px-3 py-1.5 text-xs text-left "+("dark"===i?"text-gray-400 hover:bg-gray-800":"text-gray-500 hover:bg-gray-100"),children:"Custom..."})]})]})]})]}),t.jsx("div",{className:"w-px h-5 "+("dark"===i?"bg-gray-700":"bg-gray-300")}),t.jsxs("div",{className:"flex items-center rounded-md overflow-hidden border "+("dark"===i?"border-gray-700 bg-gray-800/50":"border-gray-200 bg-gray-50"),children:[t.jsx("button",{onClick:()=>ie(!q),className:"px-2 py-1 text-[10px] font-semibold transition-all "+(q?"bg-blue-500 text-white":"dark"===i?"text-gray-400 hover:text-white":"text-gray-500 hover:text-gray-900"),title:"Daily S/R",children:"D"}),t.jsx("button",{onClick:()=>ne(!K),className:"px-2 py-1 text-[10px] font-semibold transition-all border-l "+(K?"bg-emerald-500 text-white":"dark"===i?"text-gray-400 hover:text-white border-gray-700":"text-gray-500 hover:text-gray-900 border-gray-200"),title:"Weekly S/R",children:"W"}),t.jsx("button",{onClick:()=>de(!Y),className:"px-2 py-1 text-[10px] font-semibold transition-all border-l "+(Y?"bg-purple-500 text-white":"dark"===i?"text-gray-400 hover:text-white border-gray-700":"text-gray-500 hover:text-gray-900 border-gray-200"),title:"Average S/R",children:"A"})]}),t.jsx("button",{onClick:()=>F("hline"===I?null:"hline"),className:"p-1.5 rounded transition-all "+("hline"===I?"bg-blue-500 text-white":"dark"===i?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-500 hover:text-gray-900 hover:bg-gray-100"),title:"Draw Line",children:t.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 12h16"})})}),t.jsx("div",{className:"w-px h-5 "+("dark"===i?"bg-gray-700":"bg-gray-300")}),t.jsxs("select",{className:"text-[11px] font-medium px-2 py-1 rounded border-0 outline-none cursor-pointer "+("dark"===i?"bg-gray-800 text-gray-300 focus:ring-1 focus:ring-blue-500":"bg-gray-100 text-gray-700 focus:ring-1 focus:ring-blue-500"),value:D,onChange:e=>B(e.target.value),children:[t.jsx("option",{value:"none",children:"Profile"}),t.jsx("option",{value:"oi",children:"OI"}),t.jsx("option",{value:"oi_change",children:"OI Œî"}),t.jsx("option",{value:"volume",children:"Vol"}),t.jsx("option",{value:"delta",children:"Delta"}),t.jsx("option",{value:"gamma",children:"Gamma"}),t.jsx("option",{value:"gex",children:"GEX"}),t.jsx("option",{value:"delta_oi",children:"Œî√óOI"}),t.jsx("option",{value:"composite",children:"Comp"}),t.jsx("option",{value:"pcr",children:"PCR"}),t.jsx("option",{value:"iv_skew",children:"IV Skew"}),t.jsx("option",{value:"vega",children:"Vega"}),t.jsx("option",{value:"theta",children:"Theta"}),t.jsx("option",{value:"reversal",children:"Reversal"})]}),"none"!==D&&t.jsxs("div",{className:"relative group ml-1.5 flex items-center",children:[t.jsx("div",{className:"cursor-help p-1 rounded-full border transition-colors "+("dark"===i?"border-gray-700 hover:border-blue-500 text-gray-400 hover:text-blue-400":"border-gray-200 hover:border-blue-500 text-gray-500 hover:text-blue-600"),children:t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),t.jsxs("div",{className:"absolute top-full left-0 mt-2 w-80 p-3 rounded-lg border shadow-xl backdrop-blur-xl z-[200] opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 "+("dark"===i?"bg-gray-900/95 border-gray-700 text-gray-200":"bg-white/95 border-blue-100 text-gray-800"),children:[t.jsx("div",{className:"absolute -top-1.5 left-2 w-3 h-3 rotate-45 border-l border-t "+("dark"===i?"bg-gray-900 border-gray-700":"bg-white border-blue-100")}),t.jsxs("div",{className:"relative z-10 flex flex-col gap-2.5",children:[t.jsxs("div",{className:"flex items-center gap-1.5 border-b pb-2 border-dashed border-opacity-30 border-gray-500",children:[t.jsx("span",{className:"text-base",children:"üí°"}),t.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-blue-500",children:pe(D).title})]}),pe(D).formula&&t.jsxs("div",{className:"p-1.5 rounded font-mono text-[9px] "+("dark"===i?"bg-gray-800 text-green-400":"bg-gray-100 text-green-700"),children:[t.jsx("span",{className:"opacity-50 mr-1",children:"∆í"})," ",pe(D).formula]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-[8px] uppercase font-bold block mb-0.5 "+("dark"===i?"text-gray-500":"text-gray-400"),children:"Logic"}),t.jsx("p",{className:"text-[10px] leading-snug opacity-90",children:pe(D).logic})]}),pe(D).visual&&t.jsxs("div",{className:"p-1.5 rounded border-l-2 "+("dark"===i?"bg-gray-800/50 border-yellow-500/50":"bg-yellow-50 border-yellow-400"),children:[t.jsx("span",{className:"text-[8px] uppercase font-bold block mb-0.5 "+("dark"===i?"text-yellow-500/70":"text-yellow-600"),children:"Visual Guide"}),t.jsx("p",{className:"text-[9px] leading-snug "+("dark"===i?"text-yellow-200/80":"text-yellow-800"),children:pe(D).visual})]}),t.jsxs("div",{className:"p-1.5 rounded border-l-2 "+("dark"===i?"bg-blue-500/10 border-blue-500":"bg-blue-50 border-blue-500"),children:[t.jsx("span",{className:"text-[8px] uppercase font-bold block mb-0.5 "+("dark"===i?"text-blue-400/70":"text-blue-600"),children:"Trade Signal"}),t.jsx("p",{className:"text-[9px] font-medium leading-snug text-blue-500",children:pe(D).signal})]})]})]})]}),"reversal"===D&&t.jsxs("button",{onClick:()=>G(!A),className:"ml-2 px-2 py-1 flex items-center gap-1.5 text-[10px] font-bold rounded border transition-all "+(A?"bg-gradient-to-r from-indigo-500 to-purple-600 text-white border-transparent shadow-sm":"dark"===i?"bg-gray-800 text-gray-400 border-gray-700":"bg-white text-gray-500 border-gray-200"),title:"Auto-Detect Thresholds based on Market Context",children:[t.jsx("span",{children:"‚ú® Auto"}),A&&Z?.meta&&t.jsx("span",{className:"bg-white/20 px-1 rounded text-[9px] font-mono",children:Z.meta.recommended_threshold>0?Math.round(Z.meta.recommended_threshold):"60"})]}),t.jsx("div",{className:"flex-grow"}),t.jsxs("div",{className:"flex items-center gap-0.5",children:[t.jsx("button",{onClick:()=>{if(x.current){const e=x.current.timeScale(),t=e.getVisibleLogicalRange();t&&e.setVisibleLogicalRange({from:t.from+.1*(t.to-t.from),to:t.to-.1*(t.to-t.from)})}},className:"p-1.5 rounded transition-all "+("dark"===i?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-500 hover:text-gray-900 hover:bg-gray-100"),title:"Zoom In",children:t.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v12M6 12h12"})})}),t.jsx("button",{onClick:()=>{if(x.current){const e=x.current.timeScale(),t=e.getVisibleLogicalRange();t&&e.setVisibleLogicalRange({from:t.from-.1*(t.to-t.from),to:t.to+.1*(t.to-t.from)})}},className:"p-1.5 rounded transition-all "+("dark"===i?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-500 hover:text-gray-900 hover:bg-gray-100"),title:"Zoom Out",children:t.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),t.jsx("button",{onClick:()=>{x.current&&x.current.timeScale().fitContent()},className:"p-1.5 rounded transition-all "+("dark"===i?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-500 hover:text-gray-900 hover:bg-gray-100"),title:"Fit All",children:t.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),t.jsx("div",{className:"w-px h-4 mx-1 "+("dark"===i?"bg-gray-700":"bg-gray-300")}),t.jsx("button",{onClick:()=>{const e=c.current?.parentElement?.parentElement;document.fullscreenElement?(document.exitFullscreen?.(),C(!1)):(e?.requestFullscreen?.(),C(!0))},className:"p-1.5 rounded transition-all "+("dark"===i?"text-gray-400 hover:text-white hover:bg-gray-800":"text-gray-500 hover:text-gray-900 hover:bg-gray-100"),title:_?"Exit Fullscreen":"Fullscreen",children:t.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:_?t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25"}):t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3.75 3.75v4.5m0-4.5h4.5m-4.5 0L9 9M3.75 20.25v-4.5m0 4.5h4.5m-4.5 0L9 15M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15"})})}),t.jsx("div",{className:"w-2 h-2 rounded-full ml-1 "+("connected"===H?"bg-emerald-500":"loading"===H?"bg-amber-500 animate-pulse":"bg-red-500"),title:H})]})]}),t.jsxs("div",{className:"relative w-full flex-grow",style:{height:_?"100vh":a?"calc(100vh - 120px)":"calc(100vh - 100px)"},children:[t.jsx("div",{ref:c,className:`w-full h-full ${xe.chart}`}),t.jsx("canvas",{ref:h,className:"absolute top-0 left-0 pointer-events-none z-20"})]})]})});jt.displayName="TradingChart";const Nt=()=>{const a=s(D),r=g(),[l,i]=e.useState(!1);s(e=>e.theme.theme);const{spotData:n,futuresData:o,data:d}=ke(),c=d?.pcr,x=d?.max_pain_strike;return a?t.jsxs(t.Fragment,{children:[t.jsxs(m,{children:[t.jsxs("title",{children:[l?"Chart":"Option Chain"," | Stockify"]}),t.jsx("meta",{name:"description",content:"Real-time NSE Option Chain with advanced Greeks and analysis"})]}),t.jsx(Me,{children:t.jsx(ye,{children:t.jsxs("div",{className:"w-full px-2 py-2 space-y-2",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-2 glass rounded-xl",children:[t.jsx(qe,{showChart:l,onToggleChart:()=>i(!l)}),t.jsx(We,{spotData:n,futuresData:o,pcr:c,maxPain:x}),t.jsx("div",{className:"flex-1"}),!l&&t.jsx(et,{})]}),l?t.jsx(de,{variant:"glass",className:"overflow-hidden",padding:"none",children:t.jsx(jt,{embedded:!0})}):t.jsx("div",{className:"glass-strong rounded-2xl overflow-hidden animate-fade-in",children:t.jsx(bt,{showControls:!1})})]})})})]}):t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[t.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Authentication Required"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view real-time option chain data."}),t.jsx(ce,{onClick:()=>r("/login"),children:"Login Now"})]})};export{Nt as default};
