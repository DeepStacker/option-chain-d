import{aa as e,a8 as s,r as a,j as t,at as r}from"./vendor-61R5RNdl.js";import{f as l}from"./index-DpMGw747.js";import{B as i,C as c}from"./Card-DOfmhbZR.js";import{a as n}from"./analyticsService-BzsekLUT.js";import{j as d,g as x,ak as o,a as m,ae as h,x as p}from"./ui-icons-BuGoXOaE.js";import"./charts-BVf48S-_.js";import"./firebase-Dm1Xd1Ru.js";import"./animations-9kslzpSP.js";const g=a.memo(({id:e,symbol:s,expiry:r,chartType:l,onChangeType:i,onRemove:d,isFullScreen:x=!1})=>{const[o,g]=a.useState(null),[y,j]=a.useState(!1),[u,f]=a.useState(null),b=a.useCallback(async()=>{if(s&&r){j(!0),f(null);try{let e;switch(l){case"coi":default:e=await n.getAggregateCOI({symbol:s,expiry:r});break;case"oi":e=await n.getAggregateOI({symbol:s,expiry:r});break;case"pcr":e=await n.getAggregatePCR({symbol:s,expiry:r});break;case"distribution":e=await n.getOIDistribution({symbol:s,expiry:r})}g(e)}catch(e){f(e.message||"Failed to load data")}finally{j(!1)}}},[s,r,l]);a.useEffect(()=>{b()},[b]);return t.jsxs(c,{variant:"glass",className:"flex flex-col h-full overflow-hidden",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-700",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(m,{className:"w-4 h-4 text-gray-400"}),t.jsx("select",{value:l,onChange:s=>i(e,s.target.value),className:"bg-transparent text-xs font-medium text-gray-300 border-0 focus:ring-0 cursor-pointer",children:[{id:"coi",label:"Change in OI",color:"blue"},{id:"oi",label:"Open Interest",color:"green"},{id:"pcr",label:"PCR",color:"purple"},{id:"distribution",label:"OI Distribution",color:"orange"}].map(e=>t.jsx("option",{value:e.id,className:"bg-gray-800",children:e.label},e.id))})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:b,disabled:y,className:"p-1 rounded hover:bg-gray-700 transition-colors",children:t.jsx(h,{className:"w-3.5 h-3.5 text-gray-400 "+(y?"animate-spin":"")})}),t.jsx("button",{onClick:()=>d(e),className:"p-1 rounded hover:bg-gray-700 transition-colors",children:t.jsx(p,{className:"w-3.5 h-3.5 text-gray-400"})})]})]}),t.jsx("div",{className:"flex-1 min-h-0",children:y?t.jsx("div",{className:"h-full flex items-center justify-center",children:t.jsx(h,{className:"w-6 h-6 animate-spin text-blue-500"})}):u?t.jsx("div",{className:"h-full flex items-center justify-center text-red-500 text-sm",children:u}):(()=>{if(!o?.data||0===o.data.length)return t.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No data available"});const e=o.data.slice(0,15),s=Math.max(...e.map(e=>Math.abs(e.ce_coi||e.ce_oi||e.pcr_oi||0)),...e.map(e=>Math.abs(e.pe_coi||e.pe_oi||0)),1);return t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsx("div",{className:"flex-1 flex flex-col justify-center gap-1 px-2",children:e.map((e,a)=>{const r=e.ce_coi||e.ce_oi||0,l=e.pe_coi||e.pe_oi||0,i=Math.min(90,90*Math.abs(r/s)),c=Math.min(90,90*Math.abs(l/s));return t.jsxs("div",{className:"flex items-center gap-1 h-4",children:[t.jsx("div",{className:"flex-1 flex justify-end",children:t.jsx("div",{className:"h-3 bg-green-500 rounded-l",style:{width:`${i}%`}})}),t.jsx("div",{className:"w-12 text-center text-[9px] font-medium "+(e.is_atm?"text-yellow-500":"text-gray-400"),children:e.strike}),t.jsx("div",{className:"flex-1",children:t.jsx("div",{className:"h-3 bg-red-500 rounded-r",style:{width:`${c}%`}})})]},a)})}),o.summary&&t.jsxs("div",{className:"flex justify-between text-[10px] px-2 py-1 border-t border-gray-700",children:[t.jsxs("span",{className:"text-green-500",children:["CE: ",((o.summary.total_ce_coi||o.summary.total_ce_oi||0)/1e5).toFixed(1),"L"]}),t.jsx("span",{className:"BULLISH"===o.summary.signal?"text-green-500":"text-red-500",children:o.summary.signal||(o.summary.pcr>1?"BULLISH":"BEARISH")}),t.jsxs("span",{className:"text-red-500",children:["PE: ",((o.summary.total_pe_coi||o.summary.total_pe_oi||0)/1e5).toFixed(1),"L"]})]})]})})()})]})});g.displayName="ChartPanel";const y=a.memo(({data:e})=>{if(!e||0===Object.keys(e).length)return t.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"Loading option chain..."});const s=Object.entries(e).sort((e,s)=>parseFloat(e[0])-parseFloat(s[0])).slice(0,20);return t.jsx("div",{className:"overflow-auto h-full",children:t.jsxs("table",{className:"w-full text-[10px]",children:[t.jsx("thead",{className:"bg-gray-800 sticky top-0",children:t.jsxs("tr",{children:[t.jsx("th",{className:"py-1 px-1 text-green-500",children:"OI"}),t.jsx("th",{className:"py-1 px-1 text-green-500",children:"LTP"}),t.jsx("th",{className:"py-1 px-1 text-yellow-500",children:"Strike"}),t.jsx("th",{className:"py-1 px-1 text-red-500",children:"LTP"}),t.jsx("th",{className:"py-1 px-1 text-red-500",children:"OI"})]})}),t.jsx("tbody",{children:s.map(([e,s])=>t.jsxs("tr",{className:"border-b border-gray-800 hover:bg-gray-800/50",children:[t.jsxs("td",{className:"py-0.5 px-1 text-center text-green-400",children:[((s.ce?.OI||s.ce?.oi||0)/1e3).toFixed(0),"K"]}),t.jsx("td",{className:"py-0.5 px-1 text-center",children:s.ce?.ltp?.toFixed(1)||"-"}),t.jsx("td",{className:"py-0.5 px-1 text-center font-medium text-gray-300",children:parseFloat(e).toFixed(0)}),t.jsx("td",{className:"py-0.5 px-1 text-center",children:s.pe?.ltp?.toFixed(1)||"-"}),t.jsxs("td",{className:"py-0.5 px-1 text-center text-red-400",children:[((s.pe?.OI||s.pe?.oi||0)/1e3).toFixed(0),"K"]})]},e))})]})})});y.displayName="MiniOptionChain";const j=()=>{const n=e(l),m=s(),h=e(e=>e.optionChain.selectedSymbol)||"NIFTY",p=e(e=>e.optionChain.selectedExpiry),j=e(e=>e.optionChain.data),[u,f]=a.useState([{id:1,chartType:"coi"},{id:2,chartType:"oi"},{id:3,chartType:"pcr"},{id:4,chartType:"distribution"}]),[b,N]=a.useState("2x2"),[v,w]=a.useState(!0),k=(e,s)=>{f(a=>a.map(a=>a.id===e?{...a,chartType:s}:a))},C=e=>{f(s=>s.filter(s=>s.id!==e))},S=()=>{const e=Math.max(...u.map(e=>e.id),0)+1;f(s=>[...s,{id:e,chartType:"coi"}])};if(!n)return t.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[t.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Authentication Required"}),t.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to use Split View."}),t.jsx(i,{onClick:()=>m("/login"),children:"Login Now"})]});const _={"2x2":"grid-cols-2 grid-rows-2","1x2":"grid-cols-1 grid-rows-2","3x1":"grid-cols-3 grid-rows-1"}[b]||"grid-cols-2 grid-rows-2";return t.jsxs(t.Fragment,{children:[t.jsxs(r,{children:[t.jsx("title",{children:"Split View | Stockify"}),t.jsx("meta",{name:"description",content:"Split view with option chain and multiple charts"})]}),t.jsxs("div",{className:"w-full h-[calc(100vh-64px)] flex flex-col p-2 gap-2",children:[t.jsxs("div",{className:"flex items-center justify-between px-2",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsxs("h1",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[t.jsx(d,{className:"w-5 h-5"}),"Split View"]}),t.jsxs("span",{className:"text-sm text-gray-500",children:[h," â€¢ ",p]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 rounded-lg p-0.5",children:["2x2","1x2","3x1"].map(e=>t.jsx("button",{onClick:()=>N(e),className:"px-2 py-1 text-xs font-medium rounded transition-colors "+(b===e?"bg-blue-500 text-white":"text-gray-500 hover:text-gray-700 dark:text-gray-400"),children:e},e))}),t.jsx("button",{onClick:()=>w(!v),className:"p-2 rounded-lg transition-colors "+(v?"bg-blue-100 text-blue-600 dark:bg-blue-900/30":"bg-gray-100 text-gray-500 dark:bg-gray-800"),title:"Toggle Option Chain Table",children:t.jsx(x,{className:"w-4 h-4"})}),t.jsx("button",{onClick:S,className:"p-2 rounded-lg bg-green-100 text-green-600 dark:bg-green-900/30 hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",title:"Add Chart Panel",children:t.jsx(o,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{className:"flex-1 flex gap-2 min-h-0",children:[v&&t.jsxs(c,{variant:"glass",className:"w-64 flex-shrink-0 flex flex-col",children:[t.jsxs("div",{className:"px-3 py-2 border-b border-gray-700 flex items-center gap-2",children:[t.jsx(x,{className:"w-4 h-4 text-gray-400"}),t.jsx("span",{className:"text-xs font-medium text-gray-300",children:"Option Chain"})]}),t.jsx("div",{className:"flex-1 min-h-0",children:t.jsx(y,{data:j?.oc})})]}),t.jsxs("div",{className:`flex-1 grid ${_} gap-2 min-h-0`,children:[u.slice(0,"3x1"===b?3:4).map(e=>t.jsx(g,{id:e.id,symbol:h,expiry:p,chartType:e.chartType,onChangeType:k,onRemove:C},e.id)),0===u.length&&t.jsx("div",{className:"col-span-full flex items-center justify-center",children:t.jsxs("button",{onClick:S,className:"flex flex-col items-center gap-2 p-8 rounded-xl border-2 border-dashed border-gray-600 hover:border-gray-500 transition-colors",children:[t.jsx(o,{className:"w-8 h-8 text-gray-500"}),t.jsx("span",{className:"text-sm text-gray-500",children:"Add Chart Panel"})]})})]})]})]})]})};export{j as default};
