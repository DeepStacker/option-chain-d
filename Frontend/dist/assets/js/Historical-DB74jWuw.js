import{aa as e,a8 as a,r as t,j as s,at as r}from"./vendor-61R5RNdl.js";import{e as l,f as i,b as d,o as c}from"./index-DpMGw747.js";import{B as n,C as x}from"./Card-DOfmhbZR.js";import{ae as o,K as m,i as h,an as g,ao as p,ap as y,aq as b,a as j}from"./ui-icons-BuGoXOaE.js";import"./charts-BVf48S-_.js";import"./firebase-Dm1Xd1Ru.js";import"./animations-9kslzpSP.js";const u="/historical",N=async e=>(await l.get(`${u}/dates/${e}`)).data,v=async({symbol:e,date:a})=>(await l.get(`${u}/times/${e}/${a}`)).data,f=async({symbol:e,expiry:a,date:t,time:s})=>(await l.get(`${u}/snapshot`,{params:{symbol:e,expiry:a,date:t,time:s}})).data,k=()=>{const l=e(i),u=a(),k=e(d),w=e(c),[S,F]=t.useState([]),[C,I]=t.useState([]),[O,L]=t.useState(""),[P,E]=t.useState(""),[T,K]=t.useState(null),[$,_]=t.useState(!1),[V,R]=t.useState(null),[A,D]=t.useState(!1),[H,q]=t.useState(1),[M,B]=t.useState(0);t.useEffect(()=>{(async()=>{try{const e=await N(k);F(e.dates||[]),e.dates?.length>0&&L(e.dates[0])}catch(e){R("Failed to load available dates")}})()},[k]),t.useEffect(()=>{if(!O)return;(async()=>{try{const e=await v({symbol:k,date:O});I(e.times||[]),e.times?.length>0&&(E(e.times[0]),B(0))}catch(e){}})()},[k,O]);const U=t.useCallback(async()=>{if(O&&P&&w){_(!0),R(null);try{const e=await f({symbol:k,expiry:w,date:O,time:P});K(e)}catch(e){R(e.message||"Failed to load historical data")}finally{_(!1)}}},[k,w,O,P]);t.useEffect(()=>{O&&P&&w&&U()},[O,P,w,U]),t.useEffect(()=>{if(!A||0===C.length)return;const e=setInterval(()=>{B(e=>{const a=e+1;return a>=C.length?(D(!1),e):(E(C[a]),a)})},1e3/H);return()=>clearInterval(e)},[A,H,C]);if(!l)return s.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[60vh] gap-4",children:[s.jsx("h2",{className:"text-2xl font-bold dark:text-white",children:"Authentication Required"}),s.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Please log in to view historical data."}),s.jsx(n,{onClick:()=>u("/login"),children:"Login Now"})]});const z=Object.values(T?.option_chain||{}).reduce((e,a)=>e+(a.ce?.OI||a.ce?.oi||0),0),G=Object.values(T?.option_chain||{}).reduce((e,a)=>e+(a.pe?.OI||a.pe?.oi||0),0);return s.jsxs(s.Fragment,{children:[s.jsxs(r,{children:[s.jsx("title",{children:"Historical Data | Stockify"}),s.jsx("meta",{name:"description",content:"View and replay historical option chain data"})]}),s.jsxs("div",{className:"w-full px-4 py-4 space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Historical Option Chain"}),s.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Replay historical option chain data for any date"})]}),s.jsx("button",{onClick:U,disabled:$,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:s.jsx(o,{className:"w-5 h-5 text-gray-600 dark:text-gray-400 "+($?"animate-spin":"")})})]}),s.jsxs(x,{variant:"glass",className:"p-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:"Symbol"}),s.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white font-medium",children:k})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:[s.jsx(m,{className:"w-4 h-4 inline mr-1"}),"Date"]}),s.jsx("select",{value:O,onChange:e=>L(e.target.value),className:"w-full bg-gray-100 dark:bg-gray-800 border-0 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:S.map(e=>s.jsx("option",{value:e,children:e},e))})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:[s.jsx(h,{className:"w-4 h-4 inline mr-1"}),"Time"]}),s.jsx("select",{value:P,onChange:e=>{E(e.target.value),B(C.indexOf(e.target.value))},className:"w-full bg-gray-100 dark:bg-gray-800 border-0 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:C.map(e=>s.jsx("option",{value:e,children:e},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-xs font-medium text-gray-500 mb-2",children:"Speed"}),s.jsxs("select",{value:H,onChange:e=>q(Number(e.target.value)),className:"w-full bg-gray-100 dark:bg-gray-800 border-0 rounded-lg px-4 py-2.5 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:.5,children:"0.5x"}),s.jsx("option",{value:1,children:"1x"}),s.jsx("option",{value:2,children:"2x"}),s.jsx("option",{value:5,children:"5x"}),s.jsx("option",{value:10,children:"10x"})]})]})]}),s.jsxs("div",{className:"flex items-center justify-center gap-2 mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[s.jsx("button",{onClick:()=>{if(M>0){const e=M-1;B(e),E(C[e])}},disabled:0===M,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors",children:s.jsx(g,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),s.jsx("button",{onClick:()=>D(!A),className:"p-3 rounded-xl transition-all "+(A?"bg-red-100 dark:bg-red-900/30 text-red-600":"bg-blue-100 dark:bg-blue-900/30 text-blue-600"),children:A?s.jsx(p,{className:"w-6 h-6"}):s.jsx(y,{className:"w-6 h-6"})}),s.jsx("button",{onClick:()=>{if(M<C.length-1){const e=M+1;B(e),E(C[e])}},disabled:M>=C.length-1,className:"p-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 disabled:opacity-50 transition-colors",children:s.jsx(b,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),s.jsxs("div",{className:"ml-4 text-sm text-gray-500",children:[M+1," / ",C.length," snapshots"]})]}),s.jsxs("div",{className:"mt-4",children:[s.jsx("div",{className:"h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:(C.length>0?(M+1)/C.length*100:0)+"%"}})}),s.jsxs("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[s.jsx("span",{children:C[0]||"09:15"}),s.jsx("span",{children:C[C.length-1]||"15:30"})]})]})]}),V&&s.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4 text-red-700 dark:text-red-400",children:V}),$&&s.jsxs("div",{className:"flex items-center justify-center py-12",children:[s.jsx(o,{className:"w-8 h-8 animate-spin text-blue-500"}),s.jsx("span",{className:"ml-2 text-gray-500",children:"Loading historical data..."})]}),T&&!$&&s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[s.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[s.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"Spot Price"}),s.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-white",children:T.spot?.toLocaleString()})]}),s.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[s.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"ATM Strike"}),s.jsx("div",{className:"text-xl font-bold text-yellow-600",children:T.atm_strike?.toLocaleString()})]}),s.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[s.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"PCR"}),s.jsx("div",{className:"text-xl font-bold "+(T.pcr>1?"text-green-600":"text-red-600"),children:T.pcr?.toFixed(3)})]}),s.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[s.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"Max Pain"}),s.jsx("div",{className:"text-xl font-bold text-purple-600",children:T.max_pain?.toLocaleString()})]}),s.jsxs(x,{variant:"glass",className:"p-4 text-center",children:[s.jsx("div",{className:"text-xs text-gray-500 uppercase mb-1",children:"Total OI"}),s.jsxs("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:[s.jsxs("span",{className:"text-green-600",children:[(z/1e5).toFixed(1),"L CE"]})," / ",s.jsxs("span",{className:"text-red-600",children:[(G/1e5).toFixed(1),"L PE"]})]})]})]}),s.jsx(x,{variant:"glass",className:"overflow-hidden",children:s.jsx("div",{className:"overflow-x-auto max-h-[500px]",children:s.jsxs("table",{className:"w-full text-sm",children:[s.jsxs("thead",{className:"bg-gray-100 dark:bg-gray-800 sticky top-0",children:[s.jsxs("tr",{children:[s.jsx("th",{colSpan:"4",className:"py-2 px-4 text-green-600 font-semibold border-r border-gray-200 dark:border-gray-700",children:"CALLS"}),s.jsx("th",{className:"py-2 px-4 text-yellow-600 font-semibold border-r border-gray-200 dark:border-gray-700",children:"STRIKE"}),s.jsx("th",{colSpan:"4",className:"py-2 px-4 text-red-600 font-semibold",children:"PUTS"})]}),s.jsxs("tr",{className:"text-xs text-gray-500",children:[s.jsx("th",{className:"py-2 px-2",children:"OI"}),s.jsx("th",{className:"py-2 px-2",children:"Volume"}),s.jsx("th",{className:"py-2 px-2",children:"IV"}),s.jsx("th",{className:"py-2 px-2 border-r border-gray-200 dark:border-gray-700",children:"LTP"}),s.jsx("th",{className:"py-2 px-2 border-r border-gray-200 dark:border-gray-700"}),s.jsx("th",{className:"py-2 px-2",children:"LTP"}),s.jsx("th",{className:"py-2 px-2",children:"IV"}),s.jsx("th",{className:"py-2 px-2",children:"Volume"}),s.jsx("th",{className:"py-2 px-2",children:"OI"})]})]}),s.jsx("tbody",{children:Object.entries(T.option_chain||{}).sort((e,a)=>parseFloat(e[0])-parseFloat(a[0])).slice(0,30).map(([e,a])=>{const t=parseFloat(e)===T.atm_strike;return s.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-800 "+(t?"bg-yellow-50 dark:bg-yellow-900/20":""),children:[s.jsxs("td",{className:"py-2 px-2 text-center text-green-600",children:[((a.ce?.OI||a.ce?.oi||0)/1e3).toFixed(0),"K"]}),s.jsxs("td",{className:"py-2 px-2 text-center text-gray-600 dark:text-gray-400",children:[((a.ce?.volume||a.ce?.vol||0)/1e3).toFixed(0),"K"]}),s.jsx("td",{className:"py-2 px-2 text-center text-blue-600",children:a.ce?.iv?.toFixed(1)||"-"}),s.jsx("td",{className:"py-2 px-2 text-center font-medium border-r border-gray-200 dark:border-gray-700",children:a.ce?.ltp?.toFixed(2)||"-"}),s.jsx("td",{className:"py-2 px-4 text-center font-bold border-r border-gray-200 dark:border-gray-700 "+(t?"text-yellow-600":"text-gray-900 dark:text-white"),children:parseFloat(e).toFixed(0)}),s.jsx("td",{className:"py-2 px-2 text-center font-medium",children:a.pe?.ltp?.toFixed(2)||"-"}),s.jsx("td",{className:"py-2 px-2 text-center text-blue-600",children:a.pe?.iv?.toFixed(1)||"-"}),s.jsxs("td",{className:"py-2 px-2 text-center text-gray-600 dark:text-gray-400",children:[((a.pe?.volume||a.pe?.vol||0)/1e3).toFixed(0),"K"]}),s.jsxs("td",{className:"py-2 px-2 text-center text-red-600",children:[((a.pe?.OI||a.pe?.oi||0)/1e3).toFixed(0),"K"]})]},e)})})]})})})]}),!T&&!$&&!V&&s.jsxs(x,{variant:"glass",className:"p-12 text-center",children:[s.jsx(j,{className:"w-16 h-16 mx-auto text-gray-300 dark:text-gray-600 mb-4"}),s.jsx("h3",{className:"text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"No Historical Data"}),s.jsx("p",{className:"text-gray-500",children:"Select a date and time to view historical option chain data"})]})]})]})};export{k as default};
